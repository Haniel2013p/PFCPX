
<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>PF - Sistema Integrado</title>
<style>
  * {
    box-sizing: border-box;
  }
  body {
    font-family: Arial, sans-serif;
    margin:0; padding:0;
    background: #f0f2f5;
  }
  .hidden { display:none; }
  header {
    background:#003366;
    color:#fff;
    padding:15px;
    text-align:center;
  }
  #loginScreen, #mainPanel {
    max-width: 960px;
    margin: 20px auto;
    background:#fff;
    box-shadow:0 0 8px rgba(0,0,0,0.2);
    border-radius:6px;
    padding:20px;
  }
  h2 {
    margin-top:0;
  }
  input[type=text], input[type=password], select, textarea {
    width: 100%;
    padding:8px;
    margin:6px 0 12px;
    border:1px solid #ccc;
    border-radius:4px;
    font-size: 14px;
  }
  button {
    background:#003366;
    color:#fff;
    border:none;
    padding:10px 18px;
    border-radius:4px;
    cursor:pointer;
    font-weight: bold;
    font-size: 14px;
  }
  button:hover {
    background:#0055a3;
  }
  nav {
    float:left;
    width:200px;
    border-right:1px solid #ccc;
    min-height:400px;
  }
  nav button {
    display:block;
    width:100%;
    margin:4px 0;
    text-align:left;
    background:#0055a3;
  }
  nav button.active {
    background:#003366;
  }
  section.content {
    margin-left:210px;
    min-height: 400px;
    padding-left: 20px;
  }
  table {
    border-collapse: collapse;
    width: 100%;
    margin-top:10px;
  }
  th, td {
    border:1px solid #ccc;
    padding:8px;
    text-align:left;
  }
  th {
    background:#003366;
    color:#fff;
  }
  .log {
    background:#e8e8e8;
    height: 150px;
    overflow-y: auto;
    padding: 8px;
    font-size: 12px;
    border-radius: 4px;
  }
  textarea {
    resize: vertical;
  }
  .status-em-servico {
    color: green;
    font-weight: bold;
  }
  .status-afastado {
    color: red;
    font-weight: bold;
  }
  .comunicado {
    background:#d9edf7;
    border:1px solid #bce8f1;
    padding:10px;
    margin-bottom:10px;
    border-radius: 4px;
  }
  #userInfo {
    margin-bottom: 15px;
    font-weight: bold;
  }
</style>
</head>
<body>

<header>
  <h1>Polícia Federal - Sistema Integrado</h1>
</header>

<div id="loginScreen">
  <h2>Login</h2>
  <label for="loginId">ID:</label>
  <input type="text" id="loginId" placeholder="Informe seu ID" />
  <label for="loginPassword">Senha:</label>
  <input type="password" id="loginPassword" placeholder="Informe sua senha" />
  <button id="btnLogin">Entrar</button>
  <hr />
  <h2>Cadastro</h2>
  <label for="regName">Nome Completo:</label>
  <input type="text" id="regName" placeholder="Nome completo" />
  <label for="regId">ID desejado:</label>
  <input type="text" id="regId" placeholder="ID único" />
  <label for="regPassword">Senha:</label>
  <input type="password" id="regPassword" placeholder="Senha" />
  <button id="btnRegister">Cadastrar</button>
</div>

<div id="mainPanel" class="hidden">
  <div id="userInfo"></div>
  <button id="btnLogout" style="float:right; background:#900;">Sair</button>
  <nav>
    <button data-section="dashboard" class="active">Dashboard</button>
    <button data-section="agentes">Agentes</button>
    <button data-section="escala">Escala e Ordens</button>
    <button data-section="registros">Banco Criminal</button>
    <button data-section="promocoes">Promoções/Rebaixamentos</button>
    <button data-section="denuncias">Denúncias</button>
    <button data-section="advertencias">Advertências/Punições</button>
    <button data-section="boletins">Gerador B.O.</button>
    <button data-section="comunicados">Comunicados Oficiais</button>
    <button data-section="logs">Logs</button>
  </nav>
  <section class="content">
    <div id="dashboard" class="section">
      <h2>Bem-vindo ao Sistema da Polícia Federal</h2>
      <p>Este sistema integra o controle interno, promoções, banco criminal, denúncias e comunicações oficiais da Polícia Federal. Utilize o menu lateral para navegar entre as funcionalidades.</p>
      <p><strong>Seu cargo atual:</strong> <span id="cargoAtual"></span></p>
    </div>

    <div id="agentes" class="section hidden">
      <h2>Gerenciamento de Agentes</h2>
      <p>Editar informações dos agentes cadastrados.</p>
      <table id="tableAgentes">
        <thead>
          <tr>
            <th>Nome</th>
            <th>ID</th>
            <th>Cargo</th>
            <th>Status</th>
            <th>Ações</th>
          </tr>
        </thead>
        <tbody>
          <!-- Agentes aqui -->
        </tbody>
      </table>
    </div>

    <div id="escala" class="section hidden">
      <h2>Escala e Ordens de Missão</h2>
      <p>Funcionalidade para visualização de escala e ordens (placeholder).</p>
    </div>

    <div id="registros" class="section hidden">
      <h2>Banco de Registros Criminais</h2>
      <form id="formAddRegistro">
        <h3>Adicionar Registro</h3>
        <label>Nome:</label>
        <input type="text" id="registroNome" required />
        <label>RG:</label>
        <input type="text" id="registroRG" required />
        <label>Histórico:</label>
        <textarea id="registroHistorico" rows="3" required></textarea>
        <label>Status:</label>
        <select id="registroStatus" required>
          <option value="Em investigação">Em investigação</option>
          <option value="Processo penal em andamento">Processo penal em andamento</option>
          <option value="Fugitivo">Fugitivo</option>
          <option value="Em liberdade">Em liberdade</option>
        </select>
        <label>Foi preso?</label>
        <select id="registroPreso" required>
          <option value="Sim">Sim</option>
          <option value="Não">Não</option>
        </select>
        <button type="submit">Adicionar Registro</button>
      </form>

      <hr />

      <h3>Pesquisar Registro</h3>
      <input type="text" id="pesqNome" placeholder="Nome para pesquisar" />
      <button id="btnPesqRegistro">Pesquisar</button>

      <table id="tableRegistros" class="hidden">
        <thead>
          <tr><th>Nome</th><th>RG</th><th>Histórico</th><th>Status</th><th>Total Prisões</th><th>Foi Preso?</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div id="promocoes" class="section hidden">
      <h2>Promoções e Rebaixamentos</h2>
      <p>Gerencie promoções e rebaixamentos de agentes respeitando a hierarquia.</p>
      <table id="tablePromocoes">
        <thead>
          <tr><th>Nome</th><th>ID</th><th>Cargo Atual</th><th>Nova Posição</th><th>Ação</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div id="denuncias" class="section hidden">
      <h2>Painel de Denúncias</h2>
      <form id="formDenuncia">
        <label>Denunciado (Nome ou ID):</label>
        <input type="text" id="denunciado" required />
        <label>Descrição da denúncia:</label>
        <textarea id="descDenuncia" rows="4" required></textarea>
        <button type="submit">Registrar Denúncia</button>
      </form>
      <hr />
      <h3>Lista de Denúncias</h3>
      <table id="tableDenuncias">
        <thead>
          <tr><th>ID</th><th>Denunciado</th><th>Descrição</th><th>Data</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div id="advertencias" class="section hidden">
      <h2>Advertências e Punições</h2>
      <form id="formAdvertencia">
        <label>Agente (Nome ou ID):</label>
        <input type="text" id="advAgente" required />
        <label>Tipo:</label>
        <select id="advTipo" required>
          <option value="Advertência">Advertência</option>
          <option value="Suspensão">Suspensão</option>
          <option value="Demissão">Demissão</option>
        </select>
        <label>Descrição:</label>
        <textarea id="advDescricao" rows="3" required></textarea>
        <button type="submit">Registrar</button>
      </form>
      <hr />
      <h3>Lista de Advertências/Punições</h3>
      <table id="tableAdvertencias">
        <thead>
          <tr><th>ID</th><th>Agente</th><th>Tipo</th><th>Descrição</th><th>Data</th></tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>

    <div id="boletins" class="section hidden">
      <h2>Gerador de Boletins de Ocorrência (B.O.)</h2>
      <form id="formBO">
        <label>Nome do Envolvido:</label>
        <input type="text" id="boNome" required />
        <label>Descrição do Ocorrido:</label>
        <textarea id="boDescricao" rows="4" required></textarea>
        <label>Data do Ocorrido:</label>
        <input type="date" id="boData" required />
        <button type="submit">Gerar B.O.</button>
      </form>
      <hr />
      <div id="boletimGerado" style="white-space: pre-wrap; background:#eef; padding:10px; border-radius:4px;"></div>
    </div>

    <div id="comunicados" class="section hidden">
      <h2>Comunicados Oficiais</h2>
      <form id="formComunicado">
        <label>Título:</label>
        <input type="text" id="comTitulo" required />
        <label>Mensagem:</label>
        <textarea id="comMensagem" rows="4" required></textarea>
        <button type="submit">Publicar Comunicado</button>
      </form>
      <hr />
      <div id="listaComunicados"></div>
    </div>

    <div id="logs" class="section hidden">
      <h2>Logs de Ações</h2>
      <div class="log" id="logContent"></div>
    </div>
  </section>
</div>
<script>
(() => {
  // Hierarquia da PF (do maior para o menor)
  const hierarchy = [
    "Dono da PF",
    "Diretor Geral",
    "Delegado Federal",
    "Superintendente",
    "Agente Especial",
    "Agente Federal",
    "Agente",
    "Recruta"
  ];

  // Estados globais
  let users = JSON.parse(localStorage.getItem("pf_users") || "[]"); 
  let registros = JSON.parse(localStorage.getItem("pf_registros") || "[]"); 
  let denuncias = JSON.parse(localStorage.getItem("pf_denuncias") || "[]"); 
  let advertencias = JSON.parse(localStorage.getItem("pf_advertencias") || "[]"); 
  let comunicados = JSON.parse(localStorage.getItem("pf_comunicados") || "[]"); 
  let logs = JSON.parse(localStorage.getItem("pf_logs") || "[]"); 

  let currentUser = null;

  // Helpers
  function saveAll() {
    localStorage.setItem("pf_users", JSON.stringify(users));
    localStorage.setItem("pf_registros", JSON.stringify(registros));
    localStorage.setItem("pf_denuncias", JSON.stringify(denuncias));
    localStorage.setItem("pf_advertencias", JSON.stringify(advertencias));
    localStorage.setItem("pf_comunicados", JSON.stringify(comunicados));
    localStorage.setItem("pf_logs", JSON.stringify(logs));
  }

  function addLog(text) {
    const now = new Date().toLocaleString();
    logs.push(`[${now}] ${text}`);
    if (logs.length > 100) logs.shift(); // manter logs limitados
    saveAll();
    renderLogs();
    // Simula envio ao webhook:
    console.log("LOG WEBHOOK:", text);
  }

  function findUserById(id) {
    return users.find(u => u.id === id);
  }

  function isLoggedIn() {
    return currentUser !== null;
  }

  function checkHierarchyHigher(userA, userB) {
    // Retorna true se userA tem cargo mais alto que userB
    return hierarchy.indexOf(userA.cargo) < hierarchy.indexOf(userB.cargo);
  }

  // UI Elementos
  const loginScreen = document.getElementById("loginScreen");
  const mainPanel = document.getElementById("mainPanel");
  const userInfo = document.getElementById("userInfo");
  const cargoAtualSpan = document.getElementById("cargoAtual");
  const logContent = document.getElementById("logContent");

  // Login inputs/buttons
  const loginId = document.getElementById("loginId");
  const loginPassword = document.getElementById("loginPassword");
  const btnLogin = document.getElementById("btnLogin");

  // Cadastro inputs/buttons
  const regName = document.getElementById("regName");
  const regId = document.getElementById("regId");
  const regPassword = document.getElementById("regPassword");
  const btnRegister = document.getElementById("btnRegister");

  // Logout
  const btnLogout = document.getElementById("btnLogout");

  // Navegação
  const navButtons = document.querySelectorAll("nav button");
  const sections = document.querySelectorAll("section.content > div.section");

  // Banco Criminal elementos
  const formAddRegistro = document.getElementById("formAddRegistro");
  const registroNome = document.getElementById("registroNome");
  const registroRG = document.getElementById("registroRG");
  const registroHistorico = document.getElementById("registroHistorico");
  const registroStatus = document.getElementById("registroStatus");
  const registroPreso = document.getElementById("registroPreso");

  const pesqNome = document.getElementById("pesqNome");
  const btnPesqRegistro = document.getElementById("btnPesqRegistro");
  const tableRegistros = document.getElementById("tableRegistros");
  const tbodyRegistros = tableRegistros.querySelector("tbody");

  // Promoções/Rebaixamentos
  const tablePromocoes = document.getElementById("tablePromocoes").querySelector("tbody");

  // Agentes
  const tableAgentes = document.getElementById("tableAgentes").querySelector("tbody");

  // Denúncias
  const formDenuncia = document.getElementById("formDenuncia");
  const denuciadoInput = document.getElementById("denunciado");
  const descDenunciaInput = document.getElementById("descDenuncia");
  const tableDenuncias = document.getElementById("tableDenuncias").querySelector("tbody");

  // Advertências
  const formAdvertencia = document.getElementById("formAdvertencia");
  const advAgenteInput = document.getElementById("advAgente");
  const advTipoInput = document.getElementById("advTipo");
  const advDescricaoInput = document.getElementById("advDescricao");
  const tableAdvertencias = document.getElementById("tableAdvertencias").querySelector("tbody");

  // Boletins de ocorrência
  const formBO = document.getElementById("formBO");
  const boNome = document.getElementById("boNome");
  const boDescricao = document.getElementById("boDescricao");
  const boData = document.getElementById("boData");
  const boletimGerado = document.getElementById("boletimGerado");

  // Comunicados oficiais
  const formComunicado = document.getElementById("formComunicado");
  const comTitulo = document.getElementById("comTitulo");
  const comMensagem = document.getElementById("comMensagem");
  const listaComunicados = document.getElementById("listaComunicados");

  // Funções UI e lógica

  function renderLogs() {
    logContent.textContent = logs.slice().reverse().join("\n");
  }

  function showSection(name) {
    sections.forEach(sec => {
      if (sec.id === name) sec.classList.remove("hidden");
      else sec.classList.add("hidden");
    });
    navButtons.forEach(btn => {
      btn.classList.toggle("active", btn.dataset.section === name);
    });
  }

  function refreshUserInfo() {
    userInfo.textContent = `Logado como: ${currentUser.nome} (ID: ${currentUser.id}) - Cargo: ${currentUser.cargo}`;
    cargoAtualSpan.textContent = currentUser.cargo;
  }

  function refreshTableAgentes() {
    tableAgentes.innerHTML = "";
    users.forEach(u => {
      let tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${u.nome}</td>
        <td>${u.id}</td>
        <td>${u.cargo}</td>
        <td>${u.status || "Em serviço"}</td>
        <td>
          <button data-id="${u.id}" class="btnEdit">Editar</button>
        </td>
      `;
      tableAgentes.appendChild(tr);
    });
    // Botões editar
    tableAgentes.querySelectorAll(".btnEdit").forEach(btn => {
      btn.onclick = () => openEditAgent(btn.dataset.id);
    });
  }

  function openEditAgent(id) {
    let user = findUserById(id);
    if (!user) return alert("Agente não encontrado.");

    // Prompt para editar cargo e status e senha
    let newCargo = prompt("Alterar Cargo de "+user.nome, user.cargo);
    if (newCargo && hierarchy.includes(newCargo)) {
      // Apenas usuários com cargo superior podem alterar cargo de outros
      if (checkHierarchyHigher(currentUser, user)) {
        user.cargo = newCargo;
      } else {
        alert("Você não tem permissão para alterar o cargo deste agente.");
        return;
      }
    } else if(newCargo) {
      alert("Cargo inválido.");
      return;
    }

    let newStatus = prompt("Alterar Status (Ex: Em serviço, Afastado)", user.status || "Em serviço");
    if (newStatus !== null) {
      user.status = newStatus.trim() || "Em serviço";
    }

    let newSenha = prompt("Alterar senha (deixe vazio para manter)");
    if (newSenha) {
      user.senha = newSenha;
    }
    saveAll();
    addLog(`Usuário ${currentUser.nome} alterou dados do agente ${user.nome}.`);
    refreshTableAgentes();
  }

  function refreshTablePromocoes() {
    tablePromocoes.innerHTML = "";
    users.forEach(u => {
      if(u.id === currentUser.id) return; // não promover a si mesmo
      let tr = document.createElement("tr");

      let currentIdx = hierarchy.indexOf(u.cargo);
      let nextIdx = currentIdx - 1; // promoções = cargos mais altos (índice menor)
      let prevIdx = currentIdx + 1; // rebaixamentos = cargos mais baixos

      let btnPromover = `<button data-id="${u.id}" data-action="promover">Promover</button>`;
      let btnRebaixar = `<button data-id="${u.id}" data-action="rebaixar">Rebaixar</button>`;

         // Só mostra promoção se cargo não for o topo
      if (nextIdx < 0) btnPromover = "";

      // Só mostra rebaixamento se cargo não for o último
      if (prevIdx >= hierarchy.length) btnRebaixar = "";

      tr.innerHTML = `
        <td>${u.nome}</td>
        <td>${u.cargo}</td>
        <td>${btnPromover} ${btnRebaixar}</td>
      `;
      tablePromocoes.appendChild(tr);
    });

    // Eventos dos botões promover/rebaixar
    tablePromocoes.querySelectorAll("button").forEach(btn => {
      btn.onclick = () => {
        let userId = btn.dataset.id;
        let action = btn.dataset.action;
        let user = findUserById(userId);
        if (!user) return alert("Usuário não encontrado");

        // Só pode promover/rebaixar se currentUser tem cargo superior ao user
        if (!checkHierarchyHigher(currentUser, user)) {
          return alert("Você não tem permissão para essa ação.");
        }

        let idx = hierarchy.indexOf(user.cargo);
        if (action === "promover") {
          if (idx <= 0) return alert("Este usuário já está no cargo mais alto.");
          user.cargo = hierarchy[idx - 1];
          addLog(`${currentUser.nome} promoveu ${user.nome} para ${user.cargo}.`);
          alert(`${user.nome} foi promovido para ${user.cargo}.`);
        } else if (action === "rebaixar") {
          if (idx >= hierarchy.length - 1) return alert("Este usuário já está no cargo mais baixo.");
          user.cargo = hierarchy[idx + 1];
          addLog(`${currentUser.nome} rebaixou ${user.nome} para ${user.cargo}.`);
          alert(`${user.nome} foi rebaixado para ${user.cargo}.`);
        }
        saveAll();
        refreshTablePromocoes();
        refreshTableAgentes();
        refreshUserInfo();
      };
    });
  }

  // Função para adicionar um registro criminal
  function addRegistroCriminal() {
    const nome = registroNome.value.trim();
    const rg = registroRG.value.trim();
    const historico = registroHistorico.value.trim();
    const status = registroStatus.value;
    const foiPreso = registroPreso.value;

    if (!nome || !rg) return alert("Nome e RG são obrigatórios.");
    if (!historico) return alert("Histórico é obrigatório.");

    // Calcula total de prisões: só conta se status = "Em liberdade" e foiPreso = "Sim"
    let totalPris = 0;
    if (status === "Em liberdade" && foiPreso === "Sim") {
      totalPris = 1;
    }

    registros.push({
      nome,
      rg,
      historico,
      status,
      foiPreso,
      totalPris
    });

    saveAll();
    alert("Registro criminal adicionado.");
    registroNome.value = "";
    registroRG.value = "";
    registroHistorico.value = "";
    registroStatus.value = "Em investigação";
    registroPreso.value = "Não";

    addLog(`${currentUser.nome} adicionou registro criminal de ${nome}.`);
  }

  // Pesquisa registros criminais
  function pesquisarRegistro() {
    const nomeBusca = pesqNome.value.trim().toLowerCase();
    tbodyRegistros.innerHTML = "";

    const resultados = registros.filter(r => r.nome.toLowerCase().includes(nomeBusca));
    if (resultados.length === 0) {
      tbodyRegistros.innerHTML = `<tr><td colspan="6">Nenhum registro encontrado.</td></tr>`;
      tableRegistros.classList.remove("hidden");
      return;
    }

    resultados.forEach(r => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${r.nome}</td>
        <td>${r.rg}</td>
        <td>${r.historico}</td>
        <td>${r.status}</td>
        <td>${r.foiPreso}</td>
        <td>${r.totalPris}</td>
      `;
      tbodyRegistros.appendChild(tr);
    });
    tableRegistros.classList.remove("hidden");
  }

  // Denunciar agente
  function adicionarDenuncia() {
    const denunciado = denuciadoInput.value.trim();
    const descricao = descDenunciaInput.value.trim();

    if (!denunciado || !descricao) return alert("Preencha todos os campos da denúncia.");

    denuncias.push({
      denunciante: currentUser.nome,
      denunciado,
      descricao,
      data: new Date().toLocaleString()
    });

    saveAll();
    alert("Denúncia registrada com sucesso.");
    denuciadoInput.value = "";
    descDenunciaInput.value = "";
    renderDenuncias();

    addLog(`${currentUser.nome} registrou denúncia contra ${denunciado}.`);
  }

  function renderDenuncias() {
    tableDenuncias.innerHTML = "";
    if (denuncias.length === 0) {
      tableDenuncias.innerHTML = `<tr><td colspan="4">Nenhuma denúncia registrada.</td></tr>`;
      return;
    }
    denuncias.forEach((d, i) => {
      let tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${i + 1}</td>
        <td>${d.denunciante}</td>
        <td>${d.denunciado}</td>
        <td>${d.descricao}</td>
        <td>${d.data}</td>
      `;
      tableDenuncias.appendChild(tr);
    });
  }

  // Advertências
  function adicionarAdvertencia() {
    const agente = advAgenteInput.value.trim();
    const tipo = advTipoInput.value.trim();
    const descricao = advDescricaoInput.value.trim();

    if (!agente || !tipo || !descricao) return alert("Preencha todos os campos da advertência.");

    advertencias.push({
      agente,
      tipo,
      descricao,
      data: new Date().toLocaleString(),
      aplicadaPor: currentUser.nome
    });

    saveAll();
    alert("Advertência registrada.");
    advAgenteInput.value = "";
    advTipoInput.value = "";
    advDescricaoInput.value = "";
    renderAdvertencias();

    addLog(`${currentUser.nome} aplicou advertência a ${agente} do tipo ${tipo}.`);
  }

  function renderAdvertencias() {
    tableAdvertencias.innerHTML = "";
    if (advertencias.length === 0) {
      tableAdvertencias.innerHTML = `<tr><td colspan="5">Nenhuma advertência registrada.</td></tr>`;
      return;
    }
    advertencias.forEach((a, i) => {
      let tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${i + 1}</td>
        <td>${a.agente}</td>
        <td>${a.tipo}</td>
        <td>${a.descricao}</td>
        <td>${a.data}</td>
        <td>${a.aplicadaPor}</td>
      `;
      tableAdvertencias.appendChild(tr);
    });
  }

  // Gerar boletim de ocorrência
  function gerarBoletim() {
    const nome = boNome.value.trim();
    const descricao = boDescricao.value.trim();
    const data = boData.value;

    if (!nome || !descricao || !data) return alert("Preencha todos os campos do boletim.");

    const boletim = `--- BOLETIM DE OCORRÊNCIA ---
Nome: ${nome}
Data: ${data}
Descrição: ${descricao}
Registrado por: ${currentUser.nome}
------------------------------`;

    boletimGerado.textContent = boletim;

    addLog(`${currentUser.nome} gerou boletim de ocorrência para ${nome}.`);
  }

  // Comunicados oficiais
  function adicionarComunicado() {
    const titulo = comTitulo.value.trim();
    const mensagem = comMensagem.value.trim();

    if (!titulo || !mensagem) return alert("Preencha título e mensagem do comunicado.");

    comunicados.push({
      titulo,
      mensagem,
      data: new Date().toLocaleString(),
      autor: currentUser.nome
    });

    saveAll();
    alert("Comunicado adicionado.");
    comTitulo.value = "";
    comMensagem.value = "";
    renderComunicados();

    addLog(`${currentUser.nome} publicou comunicado: ${titulo}.`);
  }

  function renderComunicados() {
    listaComunicados.innerHTML = "";
    if (comunicados.length === 0) {
      listaComunicados.innerHTML = "<p>Não há comunicados oficiais.</p>";
      return;
    }
    comunicados.forEach(c => {
      let div = document.createElement("div");
      div.className = "comunicado";
      div.innerHTML = `<h3>${c.titulo} <small>(${c.data} por ${c.autor})</small></h3><p>${c.mensagem}</p><hr>`;
      listaComunicados.appendChild(div);
    });
  }

  // Login e logout
  btnLogin.onclick = () => {
    const id = loginId.value.trim();
    const senha = loginPassword.value;

    if (!id || !senha) return alert("Preencha ID e senha.");

    let user = findUserById(id);
    if (!user) return alert("Usuário não encontrado.");
    if (user.senha !== senha) return alert("Senha incorreta.");

    currentUser = user;
    loginScreen.classList.add("hidden");
    mainPanel.classList.remove("hidden");
    refreshUserInfo();
    refreshTableAgentes();
    refreshTablePromocoes();
    renderDenuncias();
    renderAdvertencias();
    renderComunicados();
    renderLogs();
    showSection("home");

    addLog(`${currentUser.nome} fez login.`);
  };

  btnLogout.onclick = () => {
    addLog(`${currentUser.nome} saiu.`);
    currentUser = null;
    loginScreen.classList.remove("hidden");
    mainPanel.classList.add("hidden");
    loginId.value = "";
    loginPassword.value = "";
  };

  // Cadastro
  btnRegister.onclick = () => {
    const nome = regName.value.trim();
    const id = regId.value.trim();
    const senha = regPassword.value;

    if (!nome || !id || !senha) return alert("Preencha todos os campos do cadastro.");

    if (users.some(u => u.id === id)) {
      return alert("ID já cadastrado.");
    }

    users.push({
      nome,
      id,
      senha,
      cargo: "Recruta",
      status: "Em serviço"
    });

    saveAll();

    alert("Cadastro realizado com sucesso. Faça login.");
    regName.value = "";
    regId.value = "";
    regPassword.value = "";
  };

  // Navegação entre seções
  navButtons.forEach(btn => {
    btn.onclick = () => {
      if (!isLoggedIn()) return alert("Faça login para navegar.");
      showSection(btn.dataset.section);
    };
  });

  // Eventos banco criminal
  formAddRegistro.onsubmit = e => {
    e.preventDefault();
    addRegistroCriminal();
  };

  btnPesqRegistro.onclick = () => {
    pesquisarRegistro();
  };

  // Eventos denúncias
  formDenuncia.onsubmit = e => {
    e.preventDefault();
    adicionarDenuncia();
  };

  // Eventos advertências
  formAdvertencia.onsubmit = e => {
    e.preventDefault();
    adicionarAdvertencia();
  };

  // Evento boletim
  formBO.onsubmit = e => {
    e.preventDefault();
    gerarBoletim();
  };

  // Evento comunicados
  formComunicado.onsubmit = e => {
    e.preventDefault();
    adicionarComunicado();
  };

  // Inicialização
  if (isLoggedIn()) {
    loginScreen.classList.add("hidden");
    mainPanel.classList.remove("hidden");
    refreshUserInfo();
    refreshTableAgentes();
    refreshTablePromocoes();
    renderDenuncias();
    renderAdvertencias();
    renderComunicados();
    renderLogs();
    showSection("home");
  } else {
    loginScreen.classList.remove("hidden");
    mainPanel.classList.add("hidden");
  }
})();
</script>
</body>
</html>
