<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Painel Serviço Secreto Municipal</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f0f2f5;
      color: #333;
      margin: 0;
      padding: 0;
    }

    h2, h3 {
      color: #2c3e50;
    }

    input, select, textarea, button {
      border: 1px solid #ccc;
      border-radius: 3px;
      font-size: 14px;
      box-sizing: border-box;
    }

    button:hover {
      background-color: #2980b9;
      color: #fff;
      border-color: #2980b9;
    }

    table th, table td {
      text-align: left;
      border: 1px solid #aaa;
      padding: 8px;
    }

    label {
      font-size: 14px;
    }
  </style>
</head>
<body>

  <!-- Mensagem explicativa após login -->
  <div id="mensagemExplicativa" style="display:none; text-align:center; margin: 20px;">
    <h2>Bem-vindo ao Serviço Secreto Municipal</h2>
    <p>Este painel é restrito para membros autorizados. Utilize com responsabilidade.</p>
  </div>

  <!-- Login -->
  <section id="loginSection" style="max-width: 300px; margin: 30px auto; text-align:center;">
    <h3>Login</h3>
    <input type="text" id="inputIdLogin" placeholder="Digite seu ID" style="width:100%; padding:8px; margin: 5px 0;">
    <button id="btnLogin" style="width:100%; padding:10px; margin-top: 10px; cursor:pointer;">Entrar</button>
  </section>

  <!-- Cadastro -->
  <section id="cadastroSection" style="max-width: 350px; margin: 30px auto; border-top: 1px solid #ccc; padding-top: 20px; text-align:center;">
    <h3>Cadastro</h3>
    <input type="text" id="inputIdCadastro" placeholder="ID (numérico)" style="width:100%; padding:8px; margin: 5px 0;">
    <input type="text" id="inputNomeCadastro" placeholder="Nome completo" style="width:100%; padding:8px; margin: 5px 0;">
    <select id="selectDivisaoCadastro" style="width:100%; padding:8px; margin: 5px 0;">
      <option value="" disabled selected>Escolha a Divisão</option>
      <!-- Opções preenchidas via JS -->
    </select>
    <button id="btnCadastrar" style="width:100%; padding:10px; margin-top: 10px; cursor:pointer;">Cadastrar</button>
  </section>

  <!-- Painel principal - só aparece após login -->
  <section id="painel" style="display:none; max-width: 900px; margin: 30px auto;">
    
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 15px;">
      <h2>Painel de Controle</h2>
      <button id="btnBancoCriminais" style="padding: 8px 12px; cursor:pointer;">Banco criminais</button>
    </div>

    <!-- Formulário Banco de Dados Criminais -->
    <div id="bancoCriminais" style="display:none; border: 1px solid #ccc; padding: 20px; margin-top: 20px; border-radius: 5px; background:#f9f9f9;">
      <h3>Adicionar Registro Criminal</h3>
      <input type="text" id="inputNomeCriminal" placeholder="Nome do criminoso" style="width:100%; padding:8px; margin: 5px 0;">
      <input type="text" id="inputRgCriminal" placeholder="RG" style="width:100%; padding:8px; margin: 5px 0;">
      <textarea id="inputHistoricoCriminal" placeholder="Histórico criminal" style="width:100%; padding:8px; margin: 5px 0;" rows="4"></textarea>
      
      <div style="margin: 10px 0;">
        <label><strong>Foi preso?</strong></label><br>
        <label><input type="radio" name="foiPreso" value="Sim"> Sim</label>
        <label style="margin-left: 15px;"><input type="radio" name="foiPreso" value="Não"> Não</label>
      </div>
      
      <select id="selectStatusCriminal" style="width:100%; padding:8px; margin: 5px 0;">
        <option value="" disabled selected>Status</option>
        <option value="Em investigação">Em investigação</option>
        <option value="Processo penal em andamento">Processo penal em andamento</option>
        <option value="Fugitivo">Fugitivo</option>
        <option value="Em liberdade">Em liberdade</option>
      </select>
      <button id="btnAdicionarCriminal" style="width:100%; padding:10px; margin-top: 10px; cursor:pointer;">Adicionar</button>

      <hr style="margin: 20px 0;">

      <h3>Pesquisar Registros Criminais</h3>
      <input type="text" id="inputNomeBusca" placeholder="Nome" style="width:100%; padding:8px; margin: 5px 0;">
      <input type="text" id="inputRgBusca" placeholder="RG" style="width:100%; padding:8px; margin: 5px 0;">
      <button id="btnPesquisarCriminal" style="width:100%; padding:10px; margin-top: 10px; cursor:pointer;">Pesquisar</button>

      <!-- Tabela resultados - só aparece após pesquisa -->
      <table id="tabelaCriminais" style="width: 100%; border-collapse: collapse; margin-top: 20px; display:none;">
        <thead>
          <tr style="background:#ddd;">
            <th>Nome</th>
            <th>RG</th>
            <th>Histórico</th>
            <th>Total de prisões</th>
            <th>Status</th>
            <th>Foi preso?</th>
          </tr>
        </thead>
        <tbody id="tbodyCriminais">
          <!-- Linhas preenchidas via JS -->
        </tbody>
      </table>
    </div>

  </section>

  <script>

const divisoes = {
  "Inteligência e Investigações": [
    "Estagiário",
    "Investigador Operacional",
    "Agente de Inteligência",
    "Agente Especializado",
    "Inspetor",
    "Inspetor Chefe",
    "Chefe de Inteligência"
  ],
  "Operações Táticas": [
    "Agente de Operações Especiais",
    "Agente de Intervenção",
    "Capitão",
    "Coordenador de Operações Táticas"
  ],
  "Proteção Executiva": [
    "Agente de Segurança Municipal",
    "Agente de Proteção Avançada",
    "Sub Comandante de Segurança",
    "Comandante de Segurança"
  ],
  "Divisão Comando": [
    "Inspetor Geral",
    "Chefe de Operações",
    "Sub Diretor do Serviço Secreto",
    "Diretor do Serviço Secreto"
  ]
};

const cargosEspeciais = ["VSSP", "SSP", "ADMINISTRADOR"];

// --- VARIÁVEIS DE ARMAZENAMENTO ---
let membros = JSON.parse(localStorage.getItem("membrosSSM")) || [];
let criminais = JSON.parse(localStorage.getItem("criminaisSSM")) || [];
let usuarioLogado = null;

// --- FUNÇÕES AUXILIARES ---
function salvarMembros() {
  localStorage.setItem("membrosSSM", JSON.stringify(membros));
}

function salvarCriminais() {
  localStorage.setItem("criminaisSSM", JSON.stringify(criminais));
}

function buscarMembroPorId(id) {
  return membros.find(m => m.id === id);
}

function indiceCargo(divisao, cargo) {
  if (cargosEspeciais.includes(cargo)) return -1;
  if (!divisoes[divisao]) return -1;
  return divisoes[divisao].indexOf(cargo);
}

function podeAgir(usuario, alvo) {
  if (!usuario || !alvo) return false;

  // Cargos especiais: hierarquia VSSP > SSP > ADMINISTRADOR
  if (cargosEspeciais.includes(usuario.cargo)) {
    if (usuario.cargo === "VSSP" && (alvo.cargo === "SSP" || alvo.cargo === "ADMINISTRADOR")) return false;
    if (usuario.cargo === "SSP" && alvo.cargo === "ADMINISTRADOR") return false;
    return true;
  }

  // Divisão Comando pode agir em qualquer divisão, exceto cargos especiais
  if (usuario.divisao === "Divisão Comando") {
    if (cargosEspeciais.includes(alvo.cargo)) return false;
    const idxUsuario = indiceCargo("Divisão Comando", usuario.cargo);
    if (alvo.divisao === "Divisão Comando") {
      const idxAlvo = indiceCargo("Divisão Comando", alvo.cargo);
      return idxUsuario > idxAlvo;
    }
    return true;
  }

  // Chefes só podem agir na própria divisão e só se cargo for superior
  if (usuario.divisao === alvo.divisao) {
    const idxUsuario = indiceCargo(usuario.divisao, usuario.cargo);
    const idxAlvo = indiceCargo(alvo.divisao, alvo.cargo);
    if (idxUsuario === -1 || idxAlvo === -1) return false;
    return idxUsuario > idxAlvo;
  }

  return false;
}

// --- GESTÃO DE MEMBROS ---
function promoverMembro(id) {
  const membro = buscarMembroPorId(id);
  if (!membro) return alert("Membro não encontrado.");

  if (cargosEspeciais.includes(membro.cargo)) {
    alert("Cargos especiais não podem ser promovidos via painel.");
    return;
  }

  let div = membro.divisao;
  let cargos = divisoes[div];
  let idx = indiceCargo(div, membro.cargo);
  if (idx === -1) return alert("Cargo inválido.");

  if (idx < cargos.length - 1) {
    membro.cargo = cargos[idx + 1];
  } else {
    // Promove para Divisão Comando, primeiro cargo
    membro.divisao = "Divisão Comando";
    membro.cargo = divisoes["Divisão Comando"][0];
  }

  salvarMembros();
  atualizarTabelaMembros();
  alert(`Membro ${membro.nome} promovido para ${membro.cargo} (${membro.divisao}).`);
}

function rebaixarMembro(id) {
  const membro = buscarMembroPorId(id);
  if (!membro) return alert("Membro não encontrado.");

  if (cargosEspeciais.includes(membro.cargo)) {
    alert("Cargos especiais não podem ser rebaixados via painel.");
    return;
  }

  let div = membro.divisao;
  let cargos = divisoes[div];
  let idx = indiceCargo(div, membro.cargo);
  if (idx === -1) return alert("Cargo inválido.");

  if (idx > 0) {
    membro.cargo = cargos[idx - 1];
  } else {
    alert("Membro já está na menor patente dessa divisão.");
  }

  salvarMembros();
  atualizarTabelaMembros();
  alert(`Membro ${membro.nome} rebaixado para ${membro.cargo} (${membro.divisao}).`);
}

function expulsarMembro(id) {
  if (!confirm("Tem certeza que deseja expulsar este membro?")) return;

  const idx = membros.findIndex(m => m.id === id);
  if (idx === -1) return alert("Membro não encontrado.");

  membros.splice(idx, 1);
  salvarMembros();
  atualizarTabelaMembros();
  alert("Membro expulso com sucesso.");
}

function atualizarTabelaMembros() {
  const tbody = document.querySelector("#tabelaMembros tbody");
  tbody.innerHTML = "";
  membros.forEach(m => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${m.id}</td>
      <td>${m.nome}</td>
      <td>${m.divisao || "-"}</td>
      <td>${m.cargo}</td>
      <td></td>
    `;
    const tdAcoes = tr.querySelector("td:last-child");
    if (usuarioLogado && podeAgir(usuarioLogado, m) && m.id !== usuarioLogado.id) {
      const btnP = document.createElement("button");
      btnP.textContent = "Promover";
      btnP.className = "btnAcao btnPromover";
      btnP.onclick = () => promoverMembro(m.id);

      const btnR = document.createElement("button");
      btnR.textContent = "Rebaixar";
      btnR.className = "btnAcao btnRebaixar";
      btnR.onclick = () => rebaixarMembro(m.id);

      const btnE = document.createElement("button");
      btnE.textContent = "Expulsar";
      btnE.className = "btnAcao btnExpulsar";
      btnE.onclick = () => expulsarMembro(m.id);

      tdAcoes.append(btnP, btnR, btnE);
    } else {
      tdAcoes.textContent = "-";
    }
    tbody.appendChild(tr);
  });
}

// --- LOGIN E CADASTRO ---
function login(id) {
  const user = buscarMembroPorId(id);
  if (!user) return false;
  usuarioLogado = user;
  mostrarMensagemServico();
  atualizarTabelaMembros();
  atualizarInterfacePosLogin();
  return true;
}

function cadastrarMembro(id, nome, divisao) {
  if (buscarMembroPorId(id)) return false;
  if (!divisoes[divisao]) return false;

  membros.push({
    id,
    nome,
    divisao,
    cargo: divisoes[divisao][0]
  });
  salvarMembros();
  return true;
}

// --- MENSAGEM APÓS LOGIN ---
function mostrarMensagemServico() {
  const painelMsg = document.getElementById("painelMensagem");
  if (!painelMsg) return;
  painelMsg.textContent = "Bem-vindo ao Serviço Secreto Municipal. Use o painel para gerenciar os membros e os registros criminais.";
}

// --- ATUALIZA INTERFACE PÓS LOGIN ---
function atualizarInterfacePosLogin() {
  document.getElementById("login").style.display = "none";
  document.getElementById("cadastro").style.display = "none";
  document.getElementById("painel").style.display = "block";

  // Mostrar botão banco criminais só para logados
  document.getElementById("btnBancoCriminais").style.display = "inline-block";
}

// --- BANCO DE DADOS CRIMINAIS ---

function adicionarRegistroCriminal(nome, rg, historico, foiPreso, status) {
  // Total de prisões = contar ocorrências no histórico apenas se status == 'Em liberdade' e foiPreso == 'Sim'
  let totalPris = 0;
  if (status === "Em liberdade" && foiPreso === "Sim") {
    totalPris = contarPrisaoNoHistorico(historico);
  }

  criminais.push({
    nome,
    rg,
    historico,
    totalPris,
    status,
    foiPreso
  });

  salvarCriminais();
}

function contarPrisaoNoHistorico(historico) {
  // Vamos considerar que cada "prisão" no histórico seja uma palavra-chave "prisão" ou "preso" (exemplo)
  // Ou simplesmente contar quantas vezes "prisão" aparece (simples)
  const regex = /pris[aã]o|preso/gi;
  const matches = historico.match(regex);
  return matches ? matches.length : 0;
}

function pesquisarRegistrosCriminais(nomeBusca, rgBusca) {
  return criminais.filter(c => {
    const nomeOk = nomeBusca ? c.nome.toLowerCase().includes(nomeBusca.toLowerCase()) : true;
    const rgOk = rgBusca ? c.rg.toLowerCase().includes(rgBusca.toLowerCase()) : true;
    return nomeOk && rgOk;
  });
}

function mostrarTabelaCriminais(registros) {
  const tbody = document.querySelector("#tabelaCriminais tbody");
  tbody.innerHTML = "";
  registros.forEach(r => {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${r.nome}</td>
      <td>${r.rg}</td>
      <td>${r.historico}</td>
      <td>${r.totalPris}</td>
      <td>${r.status}</td>
      <td>${r.foiPreso}</td>
    `;
    tbody.appendChild(tr);
  });
}
// --- EVENTOS DOM ---

// Login
document.getElementById("btnLogin").onclick = () => {
  const id = document.getElementById("inputIdLogin").value.trim();
  if (!id) {
    alert("Digite seu ID para entrar.");
    return;
  }
  if (!login(id)) {
    alert("ID não encontrado.");
  }
};

// Cadastro
document.getElementById("btnCadastrar").onclick = () => {
  const id = document.getElementById("inputIdCadastro").value.trim();
  const nome = document.getElementById("inputNomeCadastro").value.trim();
  const divisao = document.getElementById("selectDivisaoCadastro").value;

  if (!id || !nome || !divisao) {
    alert("Preencha todos os campos para cadastro.");
    return;
  }
  if (cargosEspeciais.includes(divisao)) {
    alert("Não pode escolher cargos especiais no cadastro.");
    return;
  }
  if (buscarMembroPorId(id)) {
    alert("ID já cadastrado.");
    return;
  }

  if (cadastrarMembro(id, nome, divisao)) {
    alert("Cadastro realizado com sucesso.");
    document.getElementById("inputIdCadastro").value = "";
    document.getElementById("inputNomeCadastro").value = "";
    document.getElementById("selectDivisaoCadastro").value = "";
  } else {
    alert("Erro ao cadastrar membro.");
  }
};

// Botão mostrar banco criminais (exibe formulário)
document.getElementById("btnBancoCriminais").onclick = () => {
  const bancoDiv = document.getElementById("bancoCriminais");
  bancoDiv.style.display = bancoDiv.style.display === "block" ? "none" : "block";
};

// Adicionar registro criminal
document.getElementById("btnAdicionarCriminal").onclick = () => {
  const nome = document.getElementById("inputNomeCriminal").value.trim();
  const rg = document.getElementById("inputRgCriminal").value.trim();
  const historico = document.getElementById("inputHistoricoCriminal").value.trim();
  const foiPreso = document.querySelector('input[name="foiPreso"]:checked')?.value;
  const status = document.getElementById("selectStatusCriminal").value;

  if (!nome || !rg || !historico || !foiPreso || !status) {
    alert("Preencha todos os campos do registro criminal.");
    return;
  }

  adicionarRegistroCriminal(nome, rg, historico, foiPreso, status);
  alert("Registro criminal adicionado com sucesso.");

  // Limpar campos
  document.getElementById("inputNomeCriminal").value = "";
  document.getElementById("inputRgCriminal").value = "";
  document.getElementById("inputHistoricoCriminal").value = "";
  document.querySelector('input[name="foiPreso"]:checked').checked = false;
  document.getElementById("selectStatusCriminal").value = "";
  
  // Esconder tabela resultados até nova pesquisa
  document.getElementById("tabelaCriminais").style.display = "none";
};

// Pesquisar registros criminais
document.getElementById("btnPesquisarCriminal").onclick = () => {
  const nomeBusca = document.getElementById("inputNomeBusca").value.trim();
  const rgBusca = document.getElementById("inputRgBusca").value.trim();

  const resultados = pesquisarRegistrosCriminais(nomeBusca, rgBusca);
  mostrarTabelaCriminais(resultados);

  // Mostrar tabela apenas após pesquisa
  document.getElementById("tabelaCriminais").style.display = resultados.length > 0 ? "table" : "none";

  if (resultados.length === 0) {
    alert("Nenhum registro criminal encontrado com os critérios informados.");
  }
};

// Inicialização da interface
window.onload = () => {
  // Ocultar painel principal e banco de dados criminais até login
  document.getElementById("painel").style.display = "none";
  document.getElementById("btnBancoCriminais").style.display = "none";
  document.getElementById("bancoCriminais").style.display = "none";
  document.getElementById("tabelaCriminais").style.display = "none";

  // Popular select divisões no cadastro
  const selectDiv = document.getElementById("selectDivisaoCadastro");
  for (const div in divisoes) {
    if (div !== "Divisão Comando") { // não incluir Divisão Comando no cadastro
      const opt = document.createElement("option");
      opt.value = div;
      opt.textContent = div;
      selectDiv.appendChild(opt);
    }
  }
};


 

  </script> 

</body>
</html>
