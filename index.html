<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sistema PF RP</title>
  <style>
    body { font-family: Arial, sans-serif; background: #eef; margin: 0; padding: 0; }
    header { background: #003366; color: white; padding: 15px; text-align: center; }
    section { max-width: 800px; margin: auto; padding: 20px; background: white; border-radius: 8px; margin-top: 20px; box-shadow: 0 0 10px #aaa; }
    .hidden { display: none; }
    button { padding: 8px 16px; margin: 5px 0; background: #003366; color: white; border: none; border-radius: 4px; cursor: pointer; }
    button:hover { background: #001f40; }
    input, select, textarea { width: 100%; padding: 8px; margin: 5px 0; border: 1px solid #ccc; border-radius: 4px; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    th { background: #003366; color: white; }
  </style>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
    import { getDatabase, ref, push, onValue, set, remove } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBuaVeRTLVxpAyboRiWS6E4KYHWlYZgMEw",
      authDomain: "pfcpx-c0b9b.firebaseapp.com",
      databaseURL: "https://pfcpx-c0b9b-default-rtdb.firebaseio.com",
      projectId: "pfcpx-c0b9b",
      storageBucket: "pfcpx-c0b9b.appspot.com",
      messagingSenderId: "322312831509",
      appId: "1:322312831509:web:e5fe68609d34db6345c41c"
    };
    
    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    window._db = db;
    window._ref = ref;
    window._push = push;
    window._onValue = onValue;
    window._set = set;
    window._remove = remove;
  </script>
</head>
<body>
  <header>
    <h1>Sistema da Polícia Federal (RP)</h1>
    <button id="alternarBtn">Alternar Painel</button>
  </header>

  <section id="painelPublico">
    <h2>Painel Público</h2>
    <button onclick="mostrarPainel('bo')">Registrar B.O</button>
    <button onclick="mostrarPainel('portarias')">Ver Portarias</button>
    <button onclick="mostrarLogin()">Iniciar Sessão</button>

    <div id="bo" class="hidden">
      <h3>Registrar B.O</h3>
      <form id="formBO">
        <input placeholder="Título" id="tituloBO" required />
        <textarea placeholder="Descrição" id="descricaoBO" required></textarea>
        <input placeholder="Denunciado" id="denunciadoBO" required />
        <button type="submit">Enviar B.O</button>
      </form>
      <h3>BOs Registrados</h3>
      <table><thead><tr><th>Título</th><th>Descrição</th><th>Denunciado</th><th>Data</th></tr></thead><tbody id="tabelaBO"></tbody></table>
    </div>

    <div id="portarias" class="hidden">
      <h3>Portarias Públicas</h3>
      <ul id="listaPortarias"></ul>
    </div>
  </section>

  <section id="loginSection" class="hidden">
    <h2>Login</h2>
    <form id="loginForm">
      <input id="loginUsuario" placeholder="Usuário" required />
      <input id="loginSenha" placeholder="Senha" type="password" required />
      <button type="submit">Entrar</button>
    </form>
    <div id="erroLogin" style="color:red;"></div>
  </section>

  <section id="painelRestrito" class="hidden">
    <h2>Área Restrita</h2>
    <p id="infoUsuario"></p>
    <button onclick="mostrarPainel('criminal')">Banco Criminal</button>
    <button onclick="mostrarPainel('portariaInterna')">Criar Portaria</button>
    <button onclick="mostrarPainel('membros')">Registrar Membro</button>
    <button onclick="logout()">Sair</button>

    <div id="criminal" class="hidden">
      <h3>Banco Criminal</h3>
      <form id="formCrime">
        <input placeholder="Nome do Criminoso" id="nomeCriminoso" required />
        <input placeholder="Tipo de Crime" id="tipoCrime" required />
        <textarea placeholder="Descrição" id="descricaoCrime" required></textarea>
        <button type="submit">Registrar</button>
      </form>
      <table><thead><tr><th>Nome</th><th>Tipo</th><th>Descrição</th><th>Data</th></tr></thead><tbody id="tabelaCrime"></tbody></table>
    </div>

    <div id="portariaInterna" class="hidden">
      <h3>Nova Portaria</h3>
      <form id="formPortaria">
        <input placeholder="Título" id="tituloPortaria" required />
        <textarea placeholder="Conteúdo" id="conteudoPortaria" required></textarea>
        <button type="submit">Criar Portaria</button>
      </form>
    </div>

    <div id="membros" class="hidden">
      <h3>Registrar Membro</h3>
      <form id="formMembro">
        <input id="novoUsuario" placeholder="Usuário" required />
        <input id="novaSenha" placeholder="Senha" required />
        <select id="cargoUsuario" required>
          <option value="">Cargo</option>
          <option>Agente</option>
          <option>Escrivão</option>
          <option>Delegado</option>
          <option>Diretor</option>
        </select>
        <button type="submit">Registrar</button>
      </form>
      <ul id="listaMembros"></ul>
    </div>
  </section>

  <script>
    const db = window._db, ref = window._ref, push = window._push, onValue = window._onValue, set = window._set;

    const usuarios = JSON.parse(localStorage.getItem('usuarios') || '[]');
    if (!usuarios.find(u => u.usuario === 'Gabriel')) usuarios.push({ usuario: 'Gabriel', senha: 'DG', cargo: 'Diretor Geral' });
    localStorage.setItem('usuarios', JSON.stringify(usuarios));

    let usuarioLogado = null;

    function mostrarPainel(id) {
      document.querySelectorAll('#painelPublico > div, #painelRestrito > div').forEach(div => div.classList.add('hidden'));
      document.getElementById(id)?.classList.remove('hidden');
    }

    function mostrarLogin() {
      document.getElementById('painelPublico').classList.add('hidden');
      document.getElementById('painelRestrito').classList.add('hidden');
      document.getElementById('loginSection').classList.remove('hidden');
    }

    function logout() {
      usuarioLogado = null;
      document.getElementById('painelRestrito').classList.add('hidden');
      document.getElementById('painelPublico').classList.remove('hidden');
    }

    document.getElementById('alternarBtn').onclick = () => {
      if (usuarioLogado) {
        document.getElementById('painelRestrito').classList.toggle('hidden');
        document.getElementById('painelPublico').classList.toggle('hidden');
      } else {
        mostrarLogin();
      }
    };

    document.getElementById('loginForm').onsubmit = e => {
      e.preventDefault();
      const u = document.getElementById('loginUsuario').value.trim();
      const s = document.getElementById('loginSenha').value;
      const user = usuarios.find(x => x.usuario === u && x.senha === s);
      if (user) {
        usuarioLogado = user;
        document.getElementById('infoUsuario').innerText = `${user.usuario} (${user.cargo})`;
        document.getElementById('loginSection').classList.add('hidden');
        document.getElementById('painelRestrito').classList.remove('hidden');
        mostrarPainel('criminal');
      } else {
        document.getElementById('erroLogin').innerText = 'Usuário ou senha inválido.';
      }
    };

    document.getElementById('formBO').onsubmit = e => {
      e.preventDefault();
      const t = tituloBO.value, d = descricaoBO.value, den = denunciadoBO.value;
      if (t && d && den) {
        push(ref(db, 'boPublicos'), { titulo: t, descricao: d, denunciado: den, data: new Date().toLocaleString() });
        e.target.reset();
      }
    };

    document.getElementById('formCrime').onsubmit = e => {
      e.preventDefault();
      const n = nomeCriminoso.value, tip = tipoCrime.value, desc = descricaoCrime.value;
      if (n && tip && desc) {
        push(ref(db, 'crimes'), { nome: n, tipo: tip, descricao: desc, data: new Date().toLocaleString() });
        e.target.reset();
      }
    };

    document.getElementById('formPortaria').onsubmit = e => {
      e.preventDefault();
      const t = tituloPortaria.value, c = conteudoPortaria.value;
      push(ref(db, 'portarias'), { titulo: t, conteudo: c, data: new Date().toLocaleString() });
      e.target.reset();
    };

    document.getElementById('formMembro').onsubmit = e => {
      e.preventDefault();
      const u = novoUsuario.value.trim(), s = novaSenha.value, c = cargoUsuario.value;
      if (!usuarios.find(x => x.usuario === u)) {
        usuarios.push({ usuario: u, senha: s, cargo: c });
        localStorage.setItem('usuarios', JSON.stringify(usuarios));
        alert('Membro registrado!');
        atualizarMembros();
        e.target.reset();
      } else {
        alert('Usuário já existe!');
      }
    };

    function atualizarMembros() {
      const ul = document.getElementById('listaMembros');
      ul.innerHTML = '';
      usuarios.forEach(u => {
        const li = document.createElement('li');
        li.textContent = `${u.usuario} (${u.cargo})`;
        ul.appendChild(li);
      });
    }

    onValue(ref(db, 'boPublicos'), snap => {
      const tbody = document.getElementById('tabelaBO');
      tbody.innerHTML = '';
      snap.forEach(item => {
        const d = item.val();
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${d.titulo}</td><td>${d.descricao}</td><td>${d.denunciado}</td><td>${d.data}</td>`;
        tbody.appendChild(tr);
      });
    });

    onValue(ref(db, 'crimes'), snap => {
      const tbody = document.getElementById('tabelaCrime');
      tbody.innerHTML = '';
      snap.forEach(item => {
        const d = item.val();
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${d.nome}</td><td>${d.tipo}</td><td>${d.descricao}</td><td>${d.data}</td>`;
        tbody.appendChild(tr);
      });
    });

    onValue(ref(db, 'portarias'), snap => {
      const ul = document.getElementById('listaPortarias');
      ul.innerHTML = '';
      snap.forEach(item => {
        const d = item.val();
        const li = document.createElement('li');
        li.innerHTML = `<strong>${d.titulo}</strong>: ${d.conteudo}`;
        ul.appendChild(li);
      });
    });

    atualizarMembros();
  </script>
</body>
</html>
