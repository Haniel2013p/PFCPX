<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Painel Serviço Secreto</title>
  <style>
    body {
      background-color: #1e1e1e;
      color: white;
      font-family: Arial, sans-serif;
    }
    .container {
      width: 90%;
      max-width: 900px;
      margin: 30px auto;
      background-color: #2b2b2b;
      padding: 20px;
      border-radius: 10px;
    }
    .hidden {
      display: none;
    }
    input, select, button {
      margin: 5px 0;
      padding: 10px;
      width: 100%;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      padding: 10px;
      border: 1px solid #555;
    }
  </style>
</head>
<body>
  <div class="container" id="login-container">
    <h2>Login</h2>
    <input type="text" id="login-id" placeholder="ID" />
    <input type="password" id="login-senha" placeholder="Senha" />
    <button onclick="login()">Entrar</button>
    <button onclick="mostrarCadastro()">Cadastrar</button>
  </div>

  <div class="container hidden" id="cadastro-container">
    <h2>Cadastro</h2>
    <input type="text" id="cadastro-id" placeholder="ID" />
    <input type="text" id="cadastro-nome" placeholder="Nome" />
    <input type="password" id="cadastro-senha" placeholder="Senha" />
    <select id="cadastro-divisao">
      <option value="inteligencia">Divisão de Inteligência e Investigações</option>
      <option value="operacoes">Divisão de Operações Táticas</option>
      <option value="protecao">Divisão de Proteção Executiva</option>
    </select>
    <button onclick="cadastrar()">Cadastrar</button>
    <button onclick="voltarLogin()">Voltar</button>
  </div>

  <div class="container hidden" id="painel">
    <h2 id="boas-vindas">Bem-vindo</h2>
    <p>Você entrou no Painel do Serviço Secreto Municipal. Use com responsabilidade.</p>
    <button onclick="mostrarLista()">Lista de registros</button>
    <button onclick="logout()">Sair</button>
  </div>

  <div class="container hidden" id="lista-registros">
    <h3>Lista de Membros</h3>
    <table>
      <thead><tr><th>ID</th><th>Nome</th><th>Cargo</th><th>Divisão</th><th>Ações</th></tr></thead>
      <tbody id="corpo-registros"></tbody>
    </table>
    <button onclick="voltarPainel()">Voltar</button>
  </div>

  <script>
    const divisoes = {
      inteligencia: [
        "Estagiário",
        "Investigador Operacional",
        "Agente de Inteligência",
        "Agente Especializado",
        "Inspetor",
        "Inspetor Chefe",
        "Chefe de Inteligência"
      ],
      operacoes: [
        "Agente de Operações Especiais",
        "Agente de Intervenção",
        "Capitão",
        "Coordenador de Operações Táticas"
      ],
      protecao: [
        "Agente de Segurança Municipal",
        "Agente de Proteção Avançada",
        "Sub Comandante de Segurança",
        "Comandante de Segurança"
      ],
      comando: [
        "Inspetor Geral",
        "Chefe de Operações",
        "Sub Diretor do Serviço Secreto",
        "Diretor do Serviço Secreto"
      ]
    };

    const especiais = ["VSSP", "SSP", "ADMINISTRADOR"];

    function salvarUsuarios(usuarios) {
      localStorage.setItem("usuarios", JSON.stringify(usuarios));
    }

    function obterUsuarios() {
      return JSON.parse(localStorage.getItem("usuarios") || "[]");
    }

    function login() {
      const id = document.getElementById("login-id").value.trim();
      const senha = document.getElementById("login-senha").value.trim();
      const usuarios = obterUsuarios();
      const user = usuarios.find(u => u.id === id && u.senha === senha);
      if (!user) return alert("ID ou senha incorretos!");
      localStorage.setItem("logado", JSON.stringify(user));
      mostrarPainel();
    }

    function logout() {
      localStorage.removeItem("logado");
      location.reload();
    }

    function mostrarCadastro() {
      document.getElementById("login-container").classList.add("hidden");
      document.getElementById("cadastro-container").classList.remove("hidden");
    }

    function voltarLogin() {
      document.getElementById("cadastro-container").classList.add("hidden");
      document.getElementById("login-container").classList.remove("hidden");
    }

    function cadastrar() {
      const id = document.getElementById("cadastro-id").value.trim();
      const nome = document.getElementById("cadastro-nome").value.trim();
      const senha = document.getElementById("cadastro-senha").value.trim();
      const divisao = document.getElementById("cadastro-divisao").value;

      if (!id || !nome || !senha) return alert("Preencha todos os campos!");

      const usuarios = obterUsuarios();
      if (usuarios.some(u => u.id === id)) return alert("ID já existe!");

      const cargo = divisoes[divisao][0];

      usuarios.push({ id, nome, senha, divisao, cargo });
      salvarUsuarios(usuarios);
      alert("Cadastro realizado!");
      voltarLogin();
    }

    function mostrarPainel() {
      const user = JSON.parse(localStorage.getItem("logado"));
      if (!user) return logout();
      document.getElementById("login-container").classList.add("hidden");
      document.getElementById("painel").classList.remove("hidden");
      document.getElementById("boas-vindas").textContent = `Bem-vindo, ${user.nome} (${user.cargo})`;
    }

    function mostrarLista() {
      document.getElementById("painel").classList.add("hidden");
      document.getElementById("lista-registros").classList.remove("hidden");

      const usuarios = obterUsuarios();
      const corpo = document.getElementById("corpo-registros");
      corpo.innerHTML = "";

      const logado = JSON.parse(localStorage.getItem("logado"));

      usuarios.forEach(u => {
        const tr = document.createElement("tr");
        tr.innerHTML = \`
          <td>\${u.id}</td>
          <td>\${u.nome}</td>
          <td>\${u.cargo}</td>
          <td>\${formatarDivisao(u.divisao)}</td>
          <td>\${gerarBotoesAcoes(logado, u)}</td>
        \`;
        corpo.appendChild(tr);
      });
    }

    function voltarPainel() {
      document.getElementById("lista-registros").classList.add("hidden");
      document.getElementById("painel").classList.remove("hidden");
    }

    function formatarDivisao(div) {
      return {
        inteligencia: "Inteligência",
        operacoes: "Operações Táticas",
        protecao: "Proteção Executiva",
        comando: "Comando"
      }[div] || "Desconhecida";
    }

    function gerarBotoesAcoes(logado, alvo) {
      if (logado.id === alvo.id) return "";
      if (especiais.includes(logado.cargo)) {
        return \`<button onclick="promover('\${alvo.id}')">Promover</button>
                <button onclick="rebaixar('\${alvo.id}')">Rebaixar</button>
                <button onclick="exonerar('\${alvo.id}')">Expulsar</button>\`;
      }

      const chefiaDivisao = {
        "Chefe de Inteligência": "inteligencia",
        "Coordenador de Operações Táticas": "operacoes",
        "Comandante de Segurança": "protecao"
      };

      const podeGerenciar = chefiaDivisao[logado.cargo] === alvo.divisao;

      if (podeGerenciar) {
        const acoes = [];
        if (!ehUltimoCargo(alvo)) acoes.push(\`<button onclick="promover('\${alvo.id}')">Promover</button>\`);
        if (!ehPrimeiroCargo(alvo)) acoes.push(\`<button onclick="rebaixar('\${alvo.id}')">Rebaixar</button>\`);
        acoes.push(\`<button onclick="exonerar('\${alvo.id}')">Expulsar</button>\`);
        return acoes.join(" ");
      }

      if (logado.divisao === "comando" && !especiais.includes(alvo.cargo)) {
        const acoes = [];
        if (!ehUltimoCargo(alvo)) acoes.push(\`<button onclick="promover('\${alvo.id}')">Promover</button>\`);
        if (!ehPrimeiroCargo(alvo)) acoes.push(\`<button onclick="rebaixar('\${alvo.id}')">Rebaixar</button>\`);
        acoes.push(\`<button onclick="exonerar('\${alvo.id}')">Expulsar</button>\`);
        return acoes.join(" ");
      }

      return "";
    }

    function ehUltimoCargo(user) {
      const lista = divisoes[user.divisao];
      return lista && lista[lista.length - 1] === user.cargo;
    }

    function ehPrimeiroCargo(user) {
      const lista = divisoes[user.divisao];
      return lista && lista[0] === user.cargo;
    }

    function promover(id) {
      const usuarios = obterUsuarios();
      const user = usuarios.find(u => u.id === id);
      const lista = divisoes[user.divisao];
      let index = lista.indexOf(user.cargo);
      if (index === -1) return;

      if (index + 1 >= lista.length) {
        user.divisao = "comando";
        user.cargo = divisoes.comando[0];
      } else {
        user.cargo = lista[index + 1];
      }

      salvarUsuarios(usuarios);
      mostrarLista();
    }

    function rebaixar(id) {
      const usuarios = obterUsuarios();
      const user = usuarios.find(u => u.id === id);
      const lista = divisoes[user.divisao];
      let index = lista.indexOf(user.cargo);
      if (index === -1) return;

      if (user.divisao === "comando" && index === 0) {
        alert("Não é possível rebaixar abaixo de Inspetor Geral automaticamente. Faça manualmente.");
        return;
      }

      if (index - 1 >= 0) {
        user.cargo = lista[index - 1];
        salvarUsuarios(usuarios);
        mostrarLista();
      }
    }

    function exonerar(id) {
      let usuarios = obterUsuarios();
      usuarios = usuarios.filter(u => u.id !== id);
      salvarUsuarios(usuarios);
      mostrarLista();
    }

    if (localStorage.getItem("logado")) {
      mostrarPainel();
    }
  </script>
</body>
</html>
