<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Sistema PF - RP</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f0f2f5;
      margin: 0;
      padding: 0;
    }
    header {
      background: #003366;
      color: white;
      padding: 20px;
      text-align: center;
    }
    main {
      max-width: 1000px;
      margin: 30px auto;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 8px #ccc;
    }
    h2 {
      color: #003366;
    }
    input, select, textarea, button {
      display: block;
      width: 100%;
      margin: 8px 0;
      padding: 10px;
      border: 1px solid #aaa;
      border-radius: 4px;
      box-sizing: border-box;
    }
    button {
      background-color: #003366;
      color: white;
      cursor: pointer;
    }
    button:hover {
      background-color: #001f4d;
    }
    .painel, .restrito {
      display: none;
    }
    .publico {
      margin-top: 20px;
    }
    .msg {
      background: #eef;
      padding: 15px;
      border-radius: 5px;
      margin-bottom: 20px;
    }
    .tabela {
      width: 100%;
      border-collapse: collapse;
    }
    .tabela th, .tabela td {
      border: 1px solid #ccc;
      padding: 10px;
    }
    .tabela th {
      background: #003366;
      color: white;
    }
    .visivel {
      display: block !important;
    }
  </style>
</head>
<body>
  <header>
    <h1>Sistema RP - Polícia Federal</h1>
  </header>

  <main>
    <section class="publico" id="painelPublico">
      <div class="msg">
        <strong>Bem-vindo cidadão!</strong><br />
        Este painel é de uso público. Você pode registrar Boletins de Ocorrência e consultar Portarias Públicas.
      </div>

      <button onclick="mostrarLogin()">Iniciar Sessão</button>

      <h2>Registrar Boletim de Ocorrência</h2>
      <form id="formBOpublico">
        <input type="text" id="bo_nome" placeholder="Seu nome" required />
        <input type="text" id="bo_denunciado" placeholder="Pessoa denunciada" required />
        <textarea id="bo_desc" placeholder="Descreva o ocorrido" required></textarea>
        <button type="submit">Registrar BO</button>
      </form>

      <h2>Boletins Registrados</h2>
      <table class="tabela" id="tabelaBOPublico">
        <thead>
          <tr><th>Nome</th><th>Denunciado</th><th>Descrição</th><th>Data</th></tr>
        </thead>
        <tbody></tbody>
      </table>

      <h2>Portarias Públicas</h2>
      <ul id="listaPortariasPublicas"></ul>
    </section>

    <section id="loginSection" class="painel">
      <h2>Login Restrito</h2>
      <form id="formLogin">
        <input type="text" id="loginUsuario" placeholder="Usuário" required />
        <input type="password" id="loginSenha" placeholder="Senha" required />
        <button type="submit">Entrar</button>
      </form>
      <div id="loginErro" style="color: red; margin-top: 10px;"></div>
    </section>

    <section id="painelRestrito" class="restrito">
      <h2>Painel Restrito</h2>
      <div id="painelDelegado" class="painel">
        <h3>Painel de Promoções e Exonerações</h3>
        <table class="tabela" id="tabelaUsuarios">
          <thead>
            <tr><th>Usuário</th><th>Cargo</th><th>Ações</th></tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <div id="painelCrimes" class="painel">
        <h3>Registro de Banco Criminal</h3>
        <form id="formCrime">
          <input type="text" id="crime_nome" placeholder="Nome do acusado" required />
          <input type="text" id="crime_tipo" placeholder="Tipo de crime" required />
          <textarea id="crime_desc" placeholder="Descrição detalhada" required></textarea>
          <button type="submit">Registrar Crime</button>
        </form>

        <h3>Banco Criminal</h3>
        <table class="tabela" id="tabelaCrimes">
          <thead>
            <tr><th>Nome</th><th>Crime</th><th>Descrição</th><th>Data</th></tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <div id="painelPortarias" class="painel">
        <h3>Registro de Portarias</h3>
        <form id="formPortaria">
          <input type="text" id="tituloPortaria" placeholder="Título da Portaria" required />
          <textarea id="descPortaria" placeholder="Conteúdo da portaria" required></textarea>
          <button type="submit">Publicar Portaria</button>
        </form>
      </div>

      <div id="painelCadastroMembros" class="painel">
        <h3>Registrar Novo Membro</h3>
        <form id="formCadastroMembro">
          <input type="text" id="novoUsuario" placeholder="Nome de usuário" required />
          <input type="password" id="novaSenha" placeholder="Senha" required />
          <select id="cargoInicial">
            <option value="Agente">Agente</option>
            <option value="Delegado">Delegado</option>
            <option value="Diretor">Diretor</option>
          </select>
          <button type="submit">Cadastrar Membro</button>
        </form>
      </div>

      <button onclick="logout()">Sair</button>
    </section>
  </main>

<script>
  const hierarquia = ["Agente", "Delegado", "Diretor"];
  const dados = {
    usuarios: JSON.parse(localStorage.getItem("usuariosPF") || "[]"),
    crimes: JSON.parse(localStorage.getItem("crimesPF") || "[]"),
    portarias: JSON.parse(localStorage.getItem("portariasPF") || "[]"),
    boletins: JSON.parse(localStorage.getItem("boletinsPF") || "[]"),
    logado: null
  };

  if (!dados.usuarios.find(u => u.usuario === "Gabriel")) {
    dados.usuarios.push({ usuario: "Gabriel", senha: "DG", cargo: "Diretor" });
    localStorage.setItem("usuariosPF", JSON.stringify(dados.usuarios));
  }

  function salvarTudo() {
    localStorage.setItem("usuariosPF", JSON.stringify(dados.usuarios));
    localStorage.setItem("crimesPF", JSON.stringify(dados.crimes));
    localStorage.setItem("portariasPF", JSON.stringify(dados.portarias));
    localStorage.setItem("boletinsPF", JSON.stringify(dados.boletins));
  }

  document.getElementById("formLogin").addEventListener("submit", function (e) {
    e.preventDefault();
    const user = loginUsuario.value.trim();
    const pass = loginSenha.value.trim();
    const existe = dados.usuarios.find(u => u.usuario === user && u.senha === pass);
    if (existe) {
      dados.logado = existe;
      document.getElementById("loginSection").style.display = "none";
      document.getElementById("painelRestrito").style.display = "block";
      carregarUsuarios();
      carregarCrimes();
      carregarPortarias();
      configurarPermissoes();
    } else {
      loginErro.textContent = "Usuário ou senha inválidos.";
    }
  });

  function logout() {
    dados.logado = null;
    document.getElementById("painelRestrito").style.display = "none";
    document.getElementById("loginSection").style.display = "block";
  }

  document.getElementById("formBOpublico").addEventListener("submit", function (e) {
    e.preventDefault();
    const bo = {
      nome: bo_nome.value,
      denunciado: bo_denunciado.value,
      desc: bo_desc.value,
      data: new Date().toLocaleString()
    };
    dados.boletins.push(bo);
    salvarTudo();
    carregarBOPublicos();
    formBOpublico.reset();
  });

  function carregarBOPublicos() {
    const tbody = document.querySelector("#tabelaBOPublico tbody");
    tbody.innerHTML = "";
    dados.boletins.forEach(bo => {
      const tr = document.createElement("tr");
      tr.innerHTML = `<td>${bo.nome}</td><td>${bo.denunciado}</td><td>${bo.desc}</td><td>${bo.data}</td>`;
      tbody.appendChild(tr);
    });
  }

  document.getElementById("formCrime").addEventListener("submit", function (e) {
    e.preventDefault();
    const crime = {
      nome: crime_nome.value,
      tipo: crime_tipo.value,
      desc: crime_desc.value,
      data: new Date().toLocaleString()
    };
    dados.crimes.push(crime);
    salvarTudo();
    carregarCrimes();
    formCrime.reset();
  });

  function carregarCrimes() {
    const tbody = document.querySelector("#tabelaCrimes tbody");
    tbody.innerHTML = "";
    dados.crimes.forEach(cr => {
      const tr = document.createElement("tr");
      tr.innerHTML = `<td>${cr.nome}</td><td>${cr.tipo}</td><td>${cr.desc}</td><td>${cr.data}</td>`;
      tbody.appendChild(tr);
    });
  }

  document.getElementById("formPortaria").addEventListener("submit", function (e) {
    e.preventDefault();
    const port = {
      titulo: tituloPortaria.value,
      desc: descPortaria.value,
      data: new Date().toLocaleDateString()
    };
    dados.portarias.push(port);
    salvarTudo();
    carregarPortarias();
    formPortaria.reset();
  });

  function carregarPortarias() {
    const lista = document.getElementById("listaPortariasPublicas");
    lista.innerHTML = "";
    dados.portarias.forEach(p => {
      const li = document.createElement("li");
      li.innerHTML = `<strong>${p.titulo}</strong> - ${p.desc} (${p.data})`;
      lista.appendChild(li);
    });
  }

  document.getElementById("formCadastroMembro").addEventListener("submit", function (e) {
    e.preventDefault();
    const novo = {
      usuario: novoUsuario.value,
      senha: novaSenha.value,
      cargo: cargoInicial.value
    };
    dados.usuarios.push(novo);
    salvarTudo();
    carregarUsuarios();
    formCadastroMembro.reset();
  });

  function carregarUsuarios() {
    const tbody = document.querySelector("#tabelaUsuarios tbody");
    tbody.innerHTML = "";
    dados.usuarios.forEach((u, i) => {
      const permissoes = permissoesHierarquicas(dados.logado.cargo, u.cargo);
      let botoes = '';
      if (permissoes.promover)
        botoes += `<button onclick="alterarCargo(${i}, 1)">Promover</button>`;
      if (permissoes.rebaixar)
        botoes += `<button onclick="alterarCargo(${i}, -1)">Rebaixar</button>`;
      if (permissoes.exonerar)
        botoes += `<button onclick="exonerarUsuario(${i})">Exonerar</button>`;
      tbody.innerHTML += `
        <tr>
          <td>${u.usuario}</td>
          <td>${u.cargo}</td>
          <td>${botoes}</td>
        </tr>
      `;
    });
  }

  function alterarCargo(index, direcao) {
    const u = dados.usuarios[index];
    const atual = hierarquia.indexOf(u.cargo);
    const novo = atual + direcao;
    if (novo >= 0 && novo < hierarquia.length) {
      dados.usuarios[index].cargo = hierarquia[novo];
      salvarTudo();
      carregarUsuarios();
    }
  }

  function exonerarUsuario(index) {
    if (confirm("Deseja exonerar este usuário?")) {
      dados.usuarios.splice(index, 1);
      salvarTudo();
      carregarUsuarios();
    }
  }

  function permissoesHierarquicas(cargoAtivo, cargoAlvo) {
    const iAtivo = hierarquia.indexOf(cargoAtivo);
    const iAlvo = hierarquia.indexOf(cargoAlvo);
    return {
      promover: iAtivo > iAlvo && iAlvo < hierarquia.length - 1,
      rebaixar: iAtivo > iAlvo && iAlvo > 0,
      exonerar: iAtivo > iAlvo
    };
  }

  function mostrarLogin() {
    document.getElementById("painelPublico").style.display = "none";
    document.getElementById("loginSection").style.display = "block";
  }

  function mostrarPainelPublico(id) {
    document.getElementById("painelBOPublico").classList.add("hidden");
    document.getElementById("painelPortariasPublicas").classList.add("hidden");
    document.getElementById(id).classList.remove("hidden");
  }

  function configurarPermissoes() {
    const cargo = dados.logado.cargo;
    painelDelegado.style.display = cargo !== "Agente" ? "block" : "none";
    painelPortarias.style.display = cargo !== "Agente" ? "block" : "none";
    painelCadastroMembros.style.display = cargo === "Diretor" ? "block" : "none";
  }

  window.onload = () => {
    carregarBOPublicos();
    carregarPortarias();
  };
</script>
</body>
</html>
