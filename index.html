<script>
// RESET AUTOMÁTICO DOS DADOS AO ENTRAR NO SITE (remova depois de testar)
localStorage.removeItem('jogadores');

const cargos = [
  "Estagiário",
  "Investigador operacional",
  "Agente especializado",
  "Inspetor",
  "Inspetor chefe",
  "Chefe de inteligência",
  "Vice Secretario de segurança Pública",
  "Secretario de segurança pública"
];

let jogadores = JSON.parse(localStorage.getItem('jogadores')) || {
  "1": { nome: "Rodrigo", cargo: "Inspetor chefe", senha: "RD" },
  "2": { nome: "Japa", cargo: "Inspetor", senha: "JP" },
  "3": { nome: "Haniel", cargo: "Vice Secretario de segurança Pública", senha: "Haniel" },
  "4": { nome: "Luis", cargo: "Estagiário", senha: "LS" }
};

let idAtual = null;
let idAtualSelecionado = null;

function salvarLocalStorage() {
  localStorage.setItem('jogadores', JSON.stringify(jogadores));
}

function fazerLogin() {
  const id = document.getElementById('loginID').value.trim();
  const senha = document.getElementById('loginSenha').value;

  if (!(id in jogadores)) {
    alert('ID não encontrado!');
    return;
  }
  if (jogadores[id].senha !== senha) {
    alert('Senha incorreta!');
    return;
  }

  idAtual = id;
  mostrarPainel();
}

function mostrarPainel() {
  document.getElementById('login').style.display = 'none';
  document.getElementById('novo-jogador').style.display = 'none';

  const userInfo = document.getElementById('user-info');
  userInfo.innerText = `Nome: ${jogadores[idAtual].nome} | Cargo: ${jogadores[idAtual].cargo}`;
  userInfo.style.display = 'block';

  document.getElementById('inputID').value = '';
  document.getElementById('resultado').style.display = 'none';
  document.getElementById('pesquisa').style.display = 'block';
}

function pesquisar() {
  if (!idAtual) {
    alert('Faça login primeiro!');
    return;
  }
  const id = document.getElementById('inputID').value.trim();
  const resultadoDiv = document.getElementById('resultado');

  if (!(id in jogadores)) {
    alert('Jogador não encontrado!');
    resultadoDiv.style.display = 'none';
    return;
  }

  idAtualSelecionado = id;
  atualizarExibicao(id);

  const pode = podeModificar(idAtual, id);

  document.getElementById('acoes').style.display = pode ? 'block' : 'none';
  resultadoDiv.style.display = 'block';
}

function atualizarExibicao(id) {
  document.getElementById('nome').innerText = jogadores[id].nome;
  document.getElementById('cargo').innerText = jogadores[id].cargo;
}

function indiceCargo(cargo) {
  return cargos.indexOf(cargo);
}

function podeModificar(id1, id2) {
  const ind1 = indiceCargo(jogadores[id1].cargo);
  const ind2 = indiceCargo(jogadores[id2].cargo);
  return ind1 > ind2;
}

function promover() {
  if (!idAtualSelecionado) return;
  let cargoAtual = jogadores[idAtualSelecionado].cargo;
  let indice = indiceCargo(cargoAtual);

  if (indice >= cargos.length - 1) {
    alert(`${jogadores[idAtualSelecionado].nome} já está no cargo máximo (${cargoAtual})!`);
    return;
  }

  if (!podeModificar(idAtual, idAtualSelecionado)) {
    alert('Você não tem permissão para promover este jogador.');
    return;
  }

  jogadores[idAtualSelecionado].cargo = cargos[indice + 1];
  salvarLocalStorage();
  atualizarExibicao(idAtualSelecionado);
  alert(`${jogadores[idAtualSelecionado].nome} foi promovido para ${jogadores[idAtualSelecionado].cargo}!`);
}

function rebaixar() {
  if (!idAtualSelecionado) return;
  let cargoAtual = jogadores[idAtualSelecionado].cargo;
  let indice = indiceCargo(cargoAtual);

  if (indice <= 0) {
    alert(`${jogadores[idAtualSelecionado].nome} já está no cargo mínimo (${cargoAtual})!`);
    return;
  }

  if (!podeModificar(idAtual, idAtualSelecionado)) {
    alert('Você não tem permissão para rebaixar este jogador.');
    return;
  }

  jogadores[idAtualSelecionado].cargo = cargos[indice - 1];
  salvarLocalStorage();
  atualizarExibicao(idAtualSelecionado);
  alert(`${jogadores[idAtualSelecionado].nome} foi rebaixado para ${jogadores[idAtualSelecionado].cargo}!`);
}

function expulsar() {
  if (!idAtualSelecionado) return;

  if (!podeModificar(idAtual, idAtualSelecionado)) {
    alert('Você não tem permissão para expulsar este jogador.');
    return;
  }

  let nome = jogadores[idAtualSelecionado].nome;
  delete jogadores[idAtualSelecionado];
  salvarLocalStorage();
  alert(`${nome} foi expulso da organização!`);
  document.getElementById('resultado').style.display = 'none';
  idAtualSelecionado = null;
  document.getElementById('inputID').value = '';
}

function adicionarJogador() {
  const novoID = document.getElementById('novoID').value.trim();
  const novoNome = document.getElementById('novoNome').value.trim();
  const novaSenha = document.getElementById('novaSenha').value;

  if (!novoID || !novoNome || !novaSenha) {
    alert('Por favor, preencha todos os campos!');
    return;
  }

  if (novoID in jogadores) {
    alert('Esse ID já existe!');
    return;
  }

  const cargoInicial = cargos[0];

  jogadores[novoID] = { nome: novoNome, cargo: cargoInicial, senha: novaSenha };
  salvarLocalStorage();
  alert(`Jogador ${novoNome} adicionado com sucesso com o cargo ${cargoInicial}!`);

  document.getElementById('novoID').value = '';
  document.getElementById('novoNome').value = '';
  document.getElementById('novaSenha').value = '';
}

document.getElementById('btnToggleCadastro').addEventListener('click', () => {
  const cadastroDiv = document.getElementById('novo-jogador');
  cadastroDiv.style.display = cadastroDiv.style.display === 'none' ? 'block' : 'none';
});
</script>
