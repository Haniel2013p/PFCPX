<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Painel Serviço Secreto</title>
  <style>
    body {
      background-color: #1e1e1e;
      color: white;
      font-family: Arial, sans-serif;
    }
    .container {
      width: 90%;
      max-width: 900px;
      margin: 30px auto;
      background-color: #2b2b2b;
      padding: 20px;
      border-radius: 10px;
    }
    .hidden {
      display: none;
    }
    input, select, button, textarea {
      margin: 5px 0;
      padding: 10px;
      width: 100%;
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th, td {
      padding: 10px;
      border: 1px solid #555;
    }
  </style>
</head>
<body>
  <div class="container" id="login-container">
    <h2>Login</h2>
    <input type="text" id="login-id" placeholder="ID" />
    <input type="password" id="login-senha" placeholder="Senha" />
    <button onclick="login()">Entrar</button>
    <button onclick="mostrarCadastro()">Cadastrar</button>
  </div>

  <div class="container hidden" id="cadastro-container">
    <h2>Cadastro</h2>
    <input type="text" id="cadastro-id" placeholder="ID" />
    <input type="text" id="cadastro-nome" placeholder="Nome" />
    <input type="password" id="cadastro-senha" placeholder="Senha" />
    <select id="cadastro-divisao">
      <option value="inteligencia">Divisão de Inteligência e Investigações</option>
      <option value="operacoes">Divisão de Operações Táticas</option>
      <option value="protecao">Divisão de Proteção Executiva</option>
    </select>
    <button onclick="cadastrar()">Cadastrar</button>
    <button onclick="voltarLogin()">Voltar</button>
  </div>

  <div class="container hidden" id="painel">
    <h2 id="boas-vindas">Bem-vindo</h2>
    <p>Você entrou no Painel do Serviço Secreto Municipal. Use com responsabilidade.</p>
    <button onclick="mostrarLista()">Lista de registros</button>
    <button onclick="mostrarBancoCriminais()">Banco criminais</button>
    <button onclick="logout()">Sair</button>
  </div>

  <div class="container hidden" id="lista-registros">
    <h3>Lista de Membros</h3>
    <table>
      <thead><tr><th>ID</th><th>Nome</th><th>Cargo</th><th>Divisão</th><th>Ações</th></tr></thead>
      <tbody id="corpo-registros"></tbody>
    </table>
    <button onclick="voltarPainel()">Voltar</button>
  </div>

  <div class="container hidden" id="banco-criminais">
    <h3>Banco de Dados Criminais</h3>
    <input type="text" id="crime-nome" placeholder="Nome" />
    <input type="text" id="crime-rg" placeholder="RG" />
    <textarea id="crime-historico" placeholder="Histórico"></textarea>
    <select id="crime-status">
      <option value="Em investigação">Em investigação</option>
      <option value="Processo penal em andamento">Processo penal em andamento</option>
      <option value="Fugitivo">Fugitivo</option>
      <option value="Em liberdade">Em liberdade</option>
    </select>
    <select id="crime-foi-preso">
      <option value="Não">Foi preso? Não</option>
      <option value="Sim">Foi preso? Sim</option>
    </select>
    <button onclick="adicionarCrime()">Adicionar</button>
    <hr />
    <input type="text" id="pesquisa-rg" placeholder="Pesquisar por RG" />
    <button onclick="pesquisarCrimes()">Pesquisar</button>
    <table id="tabela-crimes" class="hidden">
      <thead><tr><th>Nome</th><th>RG</th><th>Status</th><th>Total Prisões</th><th>Histórico</th></tr></thead>
      <tbody id="corpo-crimes"></tbody>
    </table>
    <button onclick="voltarPainel()">Voltar</button>
  </div>

  <script>
    const divisoes = {
      inteligencia: ["Estagiário", "Investigador Operacional", "Agente de Inteligência", "Agente Especializado", "Inspetor", "Inspetor Chefe", "Chefe de Inteligência"],
      operacoes: ["Agente de Operações Especiais", "Agente de Intervenção", "Capitão", "Coordenador de Operações Táticas"],
      protecao: ["Agente de Segurança Municipal", "Agente de Proteção Avançada", "Sub Comandante de Segurança", "Comandante de Segurança"],
      comando: ["Inspetor Geral", "Chefe de Operações", "Sub Diretor do Serviço Secreto", "Diretor do Serviço Secreto"]
    };

    const especiais = ["VSSP", "SSP", "ADMINISTRADOR"];

    function salvarUsuarios(arr) { localStorage.setItem("usuarios", JSON.stringify(arr)); }
    function obterUsuarios() { return JSON.parse(localStorage.getItem("usuarios") || "[]"); }

    function salvarCrimes(arr) { localStorage.setItem("crimes", JSON.stringify(arr)); }
    function obterCrimes() { return JSON.parse(localStorage.getItem("crimes") || "[]"); }

    function login() {
      const id = loginId.value.trim();
      const senha = loginSenha.value.trim();
      const u = obterUsuarios().find(u => u.id === id && u.senha === senha);
      if (!u) return alert("ID ou senha incorretos!");
      localStorage.setItem("logado", JSON.stringify(u));
      mostrarPainel();
    }

    function logout() { localStorage.removeItem("logado"); location.reload(); }

    function mostrarCadastro() {
      loginContainer.classList.add("hidden");
      cadastroContainer.classList.remove("hidden");
    }

    function voltarLogin() {
      cadastroContainer.classList.add("hidden");
      loginContainer.classList.remove("hidden");
    }

    function cadastrar() {
      const id = cadastroId.value.trim();
      const nome = cadastroNome.value.trim();
      const senha = cadastroSenha.value.trim();
      const divisao = cadastroDivisao.value;
      if (!id || !nome || !senha) return alert("Preencha tudo.");
      const usuarios = obterUsuarios();
      if (usuarios.some(u => u.id === id)) return alert("ID já existe!");
      usuarios.push({ id, nome, senha, divisao, cargo: divisoes[divisao][0] });
      salvarUsuarios(usuarios);
      alert("Cadastro feito.");
      voltarLogin();
    }

    function mostrarPainel() {
      const user = JSON.parse(localStorage.getItem("logado"));
      if (!user) return logout();
      loginContainer.classList.add("hidden");
      painel.classList.remove("hidden");
      boasVindas.textContent = `Bem-vindo, ${user.nome} (${user.cargo})`;
    }

    function mostrarLista() {
      painel.classList.add("hidden");
      listaRegistros.classList.remove("hidden");
      const corpo = corpoRegistros;
      corpo.innerHTML = "";
      const logado = JSON.parse(localStorage.getItem("logado"));
      obterUsuarios().forEach(u => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${u.id}</td><td>${u.nome}</td><td>${u.cargo}</td>
          <td>${formatarDivisao(u.divisao)}</td>
          <td>${gerarBotoesAcoes(logado, u)}</td>`;
        corpo.appendChild(tr);
      });
    }

    function gerarBotoesAcoes(logado, alvo) {
      if (logado.id === alvo.id) return "";
      if (especiais.includes(logado.cargo)) return `
        <button onclick="promover('${alvo.id}')">Promover</button>
        <button onclick="rebaixar('${alvo.id}')">Rebaixar</button>
        <button onclick="exonerar('${alvo.id}')">Expulsar</button>`;
      const chefia = {
        "Chefe de Inteligência": "inteligencia",
        "Coordenador de Operações Táticas": "operacoes",
        "Comandante de Segurança": "protecao"
      };
      const pode = chefia[logado.cargo] === alvo.divisao;
      if (pode || (logado.divisao === "comando" && !especiais.includes(alvo.cargo))) {
        return `
          <button onclick="promover('${alvo.id}')">Promover</button>
          <button onclick="rebaixar('${alvo.id}')">Rebaixar</button>
          <button onclick="exonerar('${alvo.id}')">Expulsar</button>`;
      }
      return "";
    }

    function promover(id) {
      const users = obterUsuarios();
      const u = users.find(u => u.id === id);
      const lista = divisoes[u.divisao];
      const i = lista.indexOf(u.cargo);
      if (i + 1 >= lista.length) {
        u.divisao = "comando";
        u.cargo = divisoes.comando[0];
      } else {
        u.cargo = lista[i + 1];
      }
      salvarUsuarios(users);
      mostrarLista();
    }

    function rebaixar(id) {
      const users = obterUsuarios();
      const u = users.find(u => u.id === id);
      const lista = divisoes[u.divisao];
      const i = lista.indexOf(u.cargo);
      if (i > 0) {
        u.cargo = lista[i - 1];
        salvarUsuarios(users);
        mostrarLista();
      }
    }

    function exonerar(id) {
      const u = obterUsuarios().filter(u => u.id !== id);
      salvarUsuarios(u);
      mostrarLista();
    }

    function voltarPainel() {
      listaRegistros.classList.add("hidden");
      bancoCriminais.classList.add("hidden");
      painel.classList.remove("hidden");
    }

    function formatarDivisao(div) {
      return { inteligencia: "Inteligência", operacoes: "Operações", protecao: "Proteção", comando: "Comando" }[div] || div;
    }

    function mostrarBancoCriminais() {
      painel.classList.add("hidden");
      bancoCriminais.classList.remove("hidden");
      tabelaCrimes.classList.add("hidden");
    }

    function adicionarCrime() {
      const nome = crimeNome.value.trim();
      const rg = crimeRg.value.trim();
      const historico = crimeHistorico.value.trim();
      const status = crimeStatus.value;
      const foiPreso = crimeFoiPreso.value;
      if (!nome || !rg || !historico) return alert("Preencha todos os campos.");

      let crimes = obterCrimes();
      let totalPrisao = 0;
      if (status === "Em liberdade" && foiPreso === "Sim") totalPrisao = 1;

      crimes.push({ nome, rg, historico, status, foiPreso, totalPrisao });
      salvarCrimes(crimes);
      alert("Crime registrado.");
      crimeNome.value = crimeRg.value = crimeHistorico.value = "";
    }

    function pesquisarCrimes() {
      const rg = pesquisaRg.value.trim();
      const resultados = obterCrimes().filter(c => c.rg === rg);
      const corpo = corpoCrimes;
      corpo.innerHTML = "";
      if (!resultados.length) return alert("Nenhum registro encontrado.");
      resultados.forEach(c => {
        const total = (c.status === "Em liberdade" && c.foiPreso === "Sim") ? 1 : 0;
        corpo.innerHTML += `<tr><td>${c.nome}</td><td>${c.rg}</td><td>${c.status}</td><td>${total}</td><td>${c.historico}</td></tr>`;
      });
      tabelaCrimes.classList.remove("hidden");
    }

    // Auto login
    if (localStorage.getItem("logado")) mostrarPainel();
  </script>
</body>
</html>
