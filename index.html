<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Sistema Polícia Federal</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #eef2f5; }
    header { background: #0a3d62; color: white; padding: 15px; text-align: center; }
    button { padding: 10px; border: none; background: #2980b9; color: white; border-radius: 5px; cursor: pointer; }
    button:hover { background: #1c6692; }
    section { padding: 20px; display: none; }
    #publicArea, #privateArea { display: none; }
    .hidden { display: none; }
    .box { background: white; padding: 15px; margin-bottom: 15px; border-radius: 5px; box-shadow: 0 0 8px #ccc; }
    h2 { margin-top: 0; }
    textarea, input, select { width: 100%; padding: 8px; margin: 5px 0 10px; border: 1px solid #ccc; border-radius: 4px; }
    #topBar { display: flex; justify-content: space-between; align-items: center; background: #ecf0f1; padding: 10px 20px; }
    .admin-only { display: none; }
    #boletinsPublicos, #portariasPublicas, #boletinsRestritos, #bancoCriminalList { max-height: 200px; overflow-y: auto; border: 1px solid #ccc; padding: 10px; background: #f9f9f9; margin-top: 10px; }
    .item { padding: 8px; border-bottom: 1px solid #ccc; }
  </style>
</head>
<body>
  <header>
    <h1>Sistema da Polícia Federal</h1>
  </header>
  <div id="topBar">
    <button id="toggleAreaBtn">Ir para Área Restrita</button>
    <button id="logoutBtn" class="hidden">Sair</button>
  </div>

  <!-- Área Pública -->
  <section id="publicArea">
    <div class="box">
      <h2>Registrar Boletim de Ocorrência</h2>
      <form id="formPublicBO">
        <textarea id="descPublicBO" required placeholder="Descreva o ocorrido..."></textarea>
        <button type="submit">Registrar</button>
        <p id="msgPublicBO"></p>
      </form>
    </div>
    <div class="box">
      <h2>Boletins Registrados</h2>
      <div id="boletinsPublicos">Carregando...</div>
    </div>
    <div class="box">
      <h2>Portarias Públicas</h2>
      <div id="portariasPublicas">Carregando...</div>
    </div>
  </section>

  <!-- Área Restrita -->
  <section id="privateArea">
    <div id="loginBox" class="box">
      <h2>Login</h2>
      <form id="loginForm">
        <input type="text" id="loginUser" placeholder="Usuário" required />
        <input type="password" id="loginPass" placeholder="Senha" required />
        <button type="submit">Entrar</button>
        <p id="loginMsg" style="color:red;"></p>
      </form>
    </div>

    <div id="painelBox" class="hidden">
      <div class="box">
        <h2>Painel do Usuário</h2>
        <p>Usuário logado: <strong><span id="usuarioAtual"></span></strong> (<span id="cargoAtual"></span>)</p>
      </div>
      <div class="box">
        <h2>Registrar Boletim de Ocorrência Interno</h2>
        <form id="formRestritoBO">
          <input type="text" id="denunciado" placeholder="Nome do Denunciado" required />
          <textarea id="descRestritoBO" placeholder="Descrição..." required></textarea>
          <button type="submit">Registrar</button>
        </form>
        <div id="boletinsRestritos" class="box">
          <h3>Boletins Registrados</h3>
          <div id="listaRestritoBO">Carregando...</div>
        </div>
      </div>

      <div class="box">
        <h2>Banco Criminal</h2>
        <form id="formCriminal">
          <input type="text" id="criminoso" placeholder="Nome do Criminoso" required />
          <textarea id="descCrime" placeholder="Descrição do Crime..." required></textarea>
          <button type="submit">Registrar</button>
        </form>
        <div id="bancoCriminalList" class="box">
          <h3>Crimes Registrados</h3>
          <div id="listaCrimes">Carregando...</div>
        </div>
      </div>

      <div class="box admin-only" id="portariaBox">
        <h2>Criar Portaria</h2>
        <form id="formPortaria">
          <textarea id="textoPortaria" placeholder="Texto da portaria..." required></textarea>
          <button type="submit">Criar Portaria</button>
        </form>
      </div>

      <div class="box admin-only" id="membroBox">
        <h2>Registrar Membro</h2>
        <form id="formMembro">
          <input type="text" id="nomeMembro" placeholder="Nome" required />
          <input type="password" id="senhaMembro" placeholder="Senha" required />
          <select id="cargoMembro" required>
            <option value="">Cargo</option>
            <option value="Agente">Agente</option>
            <option value="Delegado">Delegado</option>
            <option value="Superintendente Regional">Superintendente Regional</option>
            <option value="Diretor">Diretor</option>
            <option value="Diretor Geral">Diretor Geral</option>
          </select>
          <button type="submit">Registrar</button>
        </form>
        <div class="box">
          <h3>Membros Cadastrados</h3>
          <div id="listaMembros">Carregando...</div>
        </div>
      </div>
    </div>
  </section>
<script> 
    // Registrar membro
    const membrosRef = database.ref('/membros');

    document.getElementById("formMembro").addEventListener("submit", function (e) {
      e.preventDefault();
      if (!loggedUser || (loggedUser.cargo !== "Diretor" && loggedUser.cargo !== "Diretor Geral")) return;

      const nome = document.getElementById("nomeMembro").value.trim();
      const senha = document.getElementById("senhaMembro").value.trim();
      const cargo = document.getElementById("cargoMembro").value;

      if (!nome || !senha || !cargo) return alert("Preencha todos os campos.");

      const novoMembro = { nome, senha, cargo };

      membrosRef.push(novoMembro)
        .then(() => {
          document.getElementById("nomeMembro").value = "";
          document.getElementById("senhaMembro").value = "";
          document.getElementById("cargoMembro").value = "Agente";
          alert("Membro registrado!");
        })
        .catch(() => alert("Erro ao registrar membro."));
    });

    // Exibir membros (somente Diretor ou Diretor Geral)
    function atualizarListaMembros(snapshot) {
      const lista = document.getElementById("listaMembros");
      lista.innerHTML = "";

      if (!loggedUser || (loggedUser.cargo !== "Diretor" && loggedUser.cargo !== "Diretor Geral")) {
        lista.innerHTML = "<i>Sem permissão para visualizar.</i>";
        return;
      }

      snapshot.forEach(child => {
        const { nome, senha, cargo } = child.val();
        const div = document.createElement("div");
        div.innerHTML = `<b>${nome}</b> - ${cargo} - Senha: ${senha}`;
        lista.appendChild(div);
      });
    }

    membrosRef.on("value", atualizarListaMembros);

    // Criar Portaria (Somente Superintendente Regional+)
    const formPortaria = document.getElementById("formPortaria");
    const listaPortarias = document.getElementById("listaPortarias");
    const portariasRef = database.ref("/portarias");

    if (formPortaria) {
      formPortaria.addEventListener("submit", function (e) {
        e.preventDefault();

        if (!loggedUser) return alert("Não logado.");
        const niveis = ["Superintendente Regional", "Delegado", "Diretor", "Diretor Geral"];
        if (!niveis.includes(loggedUser.cargo)) return alert("Cargo insuficiente.");

        const titulo = document.getElementById("tituloPortaria").value.trim();
        const conteudo = document.getElementById("conteudoPortaria").value.trim();
        if (!titulo || !conteudo) return alert("Preencha todos os campos.");

        portariasRef.push({
          titulo,
          conteudo,
          autor: loggedUser.username,
          cargo: loggedUser.cargo,
          timestamp: Date.now()
        }).then(() => {
          document.getElementById("tituloPortaria").value = "";
          document.getElementById("conteudoPortaria").value = "";
          alert("Portaria criada!");
        });
      });
    }

    // Mostrar Portarias (público e restrito)
    portariasRef.on("value", function (snapshot) {
      const portarias = snapshot.val();
      const locais = [document.getElementById("listaPortarias"), document.getElementById("listaPortariasPublica")];
      locais.forEach(local => {
        if (!local) return;
        local.innerHTML = "";
        if (!portarias) {
          local.innerHTML = "<i>Nenhuma portaria criada.</i>";
          return;
        }
        Object.values(portarias)
          .sort((a, b) => b.timestamp - a.timestamp)
          .forEach(p => {
            const div = document.createElement("div");
            div.className = "boItem";
            const data = new Date(p.timestamp);
            div.innerHTML = `<b>${p.titulo}</b><br>${p.conteudo}<br><small><i>Por ${p.autor} (${p.cargo}) - ${data.toLocaleString()}</i></small>`;
            local.appendChild(div);
          });
      });
    });

    // Mostrar BOs registrados no painel restrito
    const listaBoRestrito = document.getElementById("listaBORestrito");
    database.ref("/boletins").on("value", snapshot => {
      if (!listaBoRestrito) return;
      const boletins = snapshot.val();
      listaBoRestrito.innerHTML = "";
      if (!boletins) return listaBoRestrito.innerHTML = "<i>Sem registros.</i>";
      Object.values(boletins).reverse().forEach(bo => {
        const div = document.createElement("div");
        div.className = "boItem";
        div.innerHTML = `<b>${bo.descricao}</b><br><small><i>Por ${bo.autor} (${bo.cargo})</i></small>`;
        listaBoRestrito.appendChild(div);
      });
    });

    // Mostrar registros do banco criminal
    const listaCriminal = document.getElementById("listaCriminal");
    database.ref("/criminal").on("value", snapshot => {
      if (!listaCriminal) return;
      const crimes = snapshot.val();
      listaCriminal.innerHTML = "";
      if (!crimes) return listaCriminal.innerHTML = "<i>Sem registros.</i>";
      Object.values(crimes).reverse().forEach(crime => {
        const div = document.createElement("div");
        div.className = "boItem";
        div.innerHTML = `<b>${crime.descricao}</b><br><small><i>Denunciado: ${crime.denunciado} - Por ${crime.autor}</i></small>`;
        listaCriminal.appendChild(div);
      });
    });

  </script>
</body>
</html>
