<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Sistema PF - RP</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0; padding: 0;
    background: #f0f2f5;
  }
  header {
    background: #004080;
    color: white;
    padding: 15px;
    text-align: center;
  }
  #dashboard-publico, #login-section, #app-section {
    max-width: 700px;
    margin: 30px auto;
    background: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 0 8px #ccc;
  }
  h2 {
    color: #004080;
    margin-bottom: 15px;
  }
  label {
    display: block;
    margin: 8px 0 4px;
  }
  input[type=text], input[type=password], select, textarea {
    width: 100%;
    padding: 8px;
    border-radius: 4px;
    border: 1px solid #aaa;
    box-sizing: border-box;
  }
  button {
    margin-top: 15px;
    padding: 10px 20px;
    background: #004080;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
  }
  button:hover { background: #003060; }
  .hidden { display: none; }
  nav {
    margin-bottom: 20px;
  }
  nav button {
    margin-right: 10px;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
  }
  th, td {
    padding: 8px;
    border: 1px solid #ddd;
    word-break: break-word;
  }
  th {
    background: #004080;
    color: white;
  }
  .error { color: red; margin-top: 10px; }
</style>
</head>
<body>

<header>
  <h1>Sistema Polícia Federal (RP)</h1>
</header>

<!-- Dashboard público -->
<section id="dashboard-publico">
  <h2>Bem-vindo ao Painel Público</h2>
  <p>Este painel é de uso público a cidadãos do complexo. Aqui pode ser efetuado registro de Boletins de Ocorrência (B.O) e revisão das portarias de acesso público.</p>
  
  <button onclick="mostrarPainelPublico('painelBOPublico')">Registrar B.O Público</button>
  <button onclick="mostrarPainelPublico('painelPortariasPublicas')">Ver Portarias Públicas</button>
  <button onclick="mostrarLogin()">Iniciar Sessão (Usuários Registrados)</button>

  <div id="avisosPublicos" style="margin-top:20px; border:1px solid #004080; padding:10px; border-radius:5px; background:#e6f0ff;">
    <h3>Avisos Públicos</h3>
    <ul id="listaAvisosPublicos">
      <!-- Avisos dinâmicos aqui -->
    </ul>
  </div>

  <div id="painelBOPublico" class="hidden" style="margin-top:20px;">
    <h3>Registrar Boletim de Ocorrência (Público)</h3>
    <form id="formBOPublico">
      <label for="tituloBOPublico">Título do BO:</label>
      <input type="text" id="tituloBOPublico" required />
      <label for="descricaoBOPublico">Descrição:</label>
      <textarea id="descricaoBOPublico" rows="4" required></textarea>
      <label for="denunciadoBOPublico">Pessoa Denunciada (nome):</label>
      <input type="text" id="denunciadoBOPublico" required />
      <button type="submit">Registrar B.O</button>
    </form>
    <h3>Boletins Públicos Registrados</h3>
    <table id="tabelaBOPublico">
      <thead>
        <tr><th>Título</th><th>Descrição</th><th>Denunciado</th><th>Data</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <div id="painelPortariasPublicas" class="hidden" style="margin-top:20px;">
    <h3>Portarias Públicas</h3>
    <ul id="listaPortariasPublicas"></ul>
  </div>
</section>

<!-- Login -->
<section id="login-section" class="hidden">
  <h2>Login</h2>
  <form id="loginForm">
    <label for="username">Usuário:</label>
    <input type="text" id="username" required autocomplete="off" />
    <label for="password">Senha:</label>
    <input type="password" id="password" required autocomplete="off" />
    <button type="submit">Entrar</button>
  </form>
  <div id="login-error" class="error"></div>
  <button onclick="mostrarDashboardPublico()">Voltar ao Público</button>
</section>

<!-- Área restrita -->
<section id="app-section" class="hidden">
  <nav>
    <button onclick="mostrarPainel('painelPromocoes')">Painel Promoções</button>
    <button onclick="mostrarPainel('painelBancoCriminal')">Banco Criminal</button>
    <button onclick="mostrarPainel('painelPortariasInternas')">Portarias (Delegado+)</button>
    <button onclick="mostrarPainel('painelRegistroMembros')">Registrar Membros (Diretor+)</button>
    <button onclick="logout()">Sair</button>
  </nav>

  <!-- Painel Promoções -->
  <div id="painelPromocoes" class="painel">
    <h2>Painel de Promoção / Rebaixamento / Exoneração</h2>
    <table id="usuariosTable">
      <thead>
        <tr><th>Usuário</th><th>Cargo</th><th>Ações</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- Banco Criminal -->
  <div id="painelBancoCriminal" class="painel hidden">
    <h2>Registro Banco Criminal</h2>
    <form id="formBancoCriminal">
      <label for="nomeCriminoso">Nome do Criminoso:</label>
      <input type="text" id="nomeCriminoso" required />
      <label for="tipoCrime">Tipo do Crime:</label>
      <input type="text" id="tipoCrime" required />
      <label for="descricaoCrime">Descrição do Crime:</label>
      <textarea id="descricaoCrime" rows="4" required></textarea>
      <button type="submit">Registrar Crime</button>
    </form>
    <h3>Crimes Registrados</h3>
    <table id="tabelaBancoCriminal">
      <thead>
        <tr><th>Nome</th><th>Tipo</th><th>Descrição</th><th>Data</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- Portarias internas -->
  <div id="painelPortariasInternas" class="painel hidden">
    <h2>Gerenciar Portarias</h2>
    <form id="formPortaria">
      <label for="tituloPortaria">Título da Portaria:</label>
      <input type="text" id="tituloPortaria" required />
      <label for="conteudoPortaria">Conteúdo:</label>
      <textarea id="conteudoPortaria" rows="4" required></textarea>
      <button type="submit">Criar Portaria</button>
    </form>
    <h3>Portarias Internas Criadas</h3>
    <ul id="listaPortariasInternas"></ul>
  </div>

  <!-- Registro de membros -->
  <div id="painelRegistroMembros" class="painel hidden">
    <h2>Registrar Novo Membro (Diretor+)</h2>
    <form id="formRegistroMembros">
      <label for="novoUsuario">Usuário (login):</label>
      <input type="text" id="novoUsuario" required autocomplete="off" />
      <label for="novaSenha">Senha:</label>
      <input type="password" id="novaSenha" required />
      <label for="cargoInicial">Cargo Inicial:</label>
      <select id="cargoInicial" required>
        <option value="" disabled selected>Selecione um cargo</option>
        <option value="Agente">Agente</option>
        <option value="Delegado">Delegado</option>
        <option value="Diretor">Diretor</option>
        <option value="Diretor Geral">Diretor Geral</option>
      </select>
      <button type="submit">Registrar Membro</button>
    </form>
    <h3>Membros Registrados</h3>
    <table id="tabelaMembros">
      <thead>
        <tr><th>Usuário</th><th>Cargo</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</section>

<script>
// Dados simulados para usuários cadastrados
// Cargo hierarquia: Agente < Delegado < Diretor < Diretor Geral
const cargosHierarquia = ['Agente', 'Delegado', 'Diretor', 'Diretor Geral'];

// Usuários padrão
let usuarios = JSON.parse(localStorage.getItem('usuarios')) || [
  {username:'diretorgeral', password:'senha123', cargo:'Diretor Geral'},
  {username:'diretor', password:'senha123', cargo:'Diretor'},
  {username:'delegado', password:'senha123', cargo:'Delegado'},
  {username:'agente', password:'senha123', cargo:'Agente'},
];

// Boletins de Ocorrência Públicos
let boletinsPublicos = JSON.parse(localStorage.getItem('boletinsPublicos')) || [];

// Portarias públicas
let portariasPublicas = JSON.parse(localStorage.getItem('portariasPublicas')) || [
  {titulo: 'Portaria 001', conteudo: 'Regulamento de acesso ao complexo', data: new Date().toLocaleString()},
];

// Portarias internas (delegado+)
let portariasInternas = JSON.parse(localStorage.getItem('portariasInternas')) || [];

// Banco criminal
let bancoCriminal = JSON.parse(localStorage.getItem('bancoCriminal')) || [];

// Estado da sessão
let usuarioLogado = null;

// Funções Auxiliares
function salvarDados() {
  localStorage.setItem('usuarios', JSON.stringify(usuarios));
  localStorage.setItem('boletinsPublicos', JSON.stringify(boletinsPublicos));
  localStorage.setItem('portariasPublicas', JSON.stringify(portariasPublicas));
  localStorage.setItem('portariasInternas', JSON.stringify(portariasInternas));
  localStorage.setItem('bancoCriminal', JSON.stringify(bancoCriminal));
}

function mostrarDashboardPublico() {
  document.getElementById('dashboard-publico').classList.remove('hidden');
  document.getElementById('login-section').classList.add('hidden');
  document.getElementById('app-section').classList.add('hidden');
  esconderTodosPainéisPublicos();
  mostrarAvisosPublicos();
}

function mostrarLogin() {
  document.getElementById('dashboard-publico').classList.add('hidden');
  document.getElementById('login-section').classList.remove('hidden');
  document.getElementById('app-section').classList.add('hidden');
  document.getElementById('login-error').textContent = '';
}

function mostrarApp() {
  document.getElementById('dashboard-publico').classList.add('hidden');
  document.getElementById('login-section').classList.add('hidden');
  document.getElementById('app-section').classList.remove('hidden');
  mostrarPainel('painelPromocoes');
  atualizarUsuariosTabela();
  atualizarBancoCriminalTabela();
  atualizarPortariasInternasLista();
  atualizarMembrosTabela();
}

function esconderTodosPainéisPublicos() {
  document.getElementById('painelBOPublico').classList.add('hidden');
  document.getElementById('painelPortariasPublicas').classList.add('hidden');
}

function mostrarPainelPublico(id) {
  esconderTodosPainéisPublicos();
  document.getElementById(id).classList.remove('hidden');
  if (id === 'painelBOPublico') {
    atualizarTabelaBOPublico();
  }
  if (id === 'painelPortariasPublicas') {
    atualizarPortariasPublicasLista();
  }
}

function atualizarTabelaBOPublico() {
  const tbody = document.querySelector('#tabelaBOPublico tbody');
  tbody.innerHTML = '';
  boletinsPublicos.forEach(bo => {
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${bo.titulo}</td><td>${bo.descricao}</td><td>${bo.denunciado}</td><td>${bo.data}</td>`;
    tbody.appendChild(tr);
  });
}

function atualizarPortariasPublicasLista() {
  const ul = document.getElementById('listaPortariasPublicas');
  ul.innerHTML = '';
  portariasPublicas.forEach(p => {
    const li = document.createElement('li');
    li.textContent = `${p.titulo} - ${p.conteudo} (Criado em: ${p.data})`;
    ul.appendChild(li);
  });
}

function mostrarPainel(id) {
  const paineis = document.querySelectorAll('#app-section .painel');
  paineis.forEach(p => p.classList.add('hidden'));
  const painel = document.getElementById(id);
  if (!painel) return;
  // Controle de visibilidade conforme cargo
  if (id === 'painelPortariasInternas' && !podeGerenciarPortarias()) {
    alert('Acesso negado: Apenas Delegado+ pode acessar Portarias.');
    return;
  }
  if (id === 'painelRegistroMembros' && !podeRegistrarMembros()) {
    alert('Acesso negado: Apenas Diretor ou Diretor Geral pode registrar membros.');
    return;
  }
  painel.classList.remove('hidden');
}

function podeGerenciarPortarias() {
  return ['Delegado', 'Diretor', 'Diretor Geral'].includes(usuarioLogado.cargo);
}

function podeRegistrarMembros() {
  return ['Diretor', 'Diretor Geral'].includes(usuarioLogado.cargo);
}

function podePromover(usuarioAlvo) {
  // Só pode promover se cargo do alvo for menor que do logado
  const cargoLogadoIdx = cargosHierarquia.indexOf(usuarioLogado.cargo);
  const cargoAlvoIdx = cargosHierarquia.indexOf(usuarioAlvo.cargo);
  return cargoLogadoIdx > cargoAlvoIdx;
}

function podeRebaixar(usuarioAlvo) {
  return podePromover(usuarioAlvo);
}

function podeExonerar(usuarioAlvo) {
  return podePromover(usuarioAlvo);
}

function atualizarUsuariosTabela() {
  const tbody = document.querySelector('#usuariosTable tbody');
  tbody.innerHTML = '';
  usuarios.forEach(u => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${u.username}</td>
      <td>${u.cargo}</td>
      <td>
        ${podePromover(u) ? `<button onclick="promoverUsuario('${u.username}')">Promover</button>` : ''}
        ${podeRebaixar(u) ? `<button onclick="rebaixarUsuario('${u.username}')">Rebaixar</button>` : ''}
        ${podeExonerar(u) ? `<button onclick="exonerarUsuario('${u.username}')">Exonerar</button>` : ''}
      </td>`;
    tbody.appendChild(tr);
  });
}

function promoverUsuario(username) {
  const usuario = usuarios.find(u => u.username === username);
  if (!usuario) return alert('Usuário não encontrado');
  const idx = cargosHierarquia.indexOf(usuario.cargo);
  const idxLogado = cargosHierarquia.indexOf(usuarioLogado.cargo);
  if (idx === -1 || idxLogado === -1) return alert('Erro nos cargos');
  if (idx + 1 >= cargosHierarquia.length) {
    return alert('Não pode promover além da patente atual.');
  }
  if (idx + 1 >= idxLogado) {
    return alert('Não pode promover para patente igual ou superior à sua.');
  }
  usuario.cargo = cargosHierarquia[idx + 1];
  salvarDados();
  atualizarUsuariosTabela();
}

function rebaixarUsuario(username) {
  const usuario = usuarios.find(u => u.username === username);
  if (!usuario) return alert('Usuário não encontrado');
  const idx = cargosHierarquia.indexOf(usuario.cargo);
  if (idx <= 0) {
    return alert('Não pode rebaixar além da patente mínima.');
  }
  const idxLogado = cargosHierarquia.indexOf(usuarioLogado.cargo);
  if (idx >= idxLogado) {
    return alert('Não pode rebaixar alguém com patente igual ou superior à sua.');
  }
  usuario.cargo = cargosHierarquia[idx - 1];
  salvarDados();
  atualizarUsuariosTabela();
}

function exonerarUsuario(username) {
  if (usuarioLogado.username === username) {
    return alert('Você não pode se exonerar.');
  }
  const idxLogado = cargosHierarquia.indexOf(usuarioLogado.cargo);
  const usuario = usuarios.find(u => u.username === username);
  if (!usuario) return alert('Usuário não encontrado');
  const idxAlvo = cargosHierarquia.indexOf(usuario.cargo);
  if (idxAlvo >= idxLogado) {
    return alert('Não pode exonerar alguém com patente igual ou superior à sua.');
  }
  usuarios = usuarios.filter(u => u.username !== username);
  salvarDados();
  atualizarUsuariosTabela();
}

// Atualizar Banco Criminal
function atualizarBancoCriminalTabela() {
  const tbody = document.querySelector('#tabelaBancoCriminal tbody');
  tbody.innerHTML = '';
  bancoCriminal.forEach(c => {
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${c.nome}</td><td>${c.tipo}</td><td>${c.descricao}</td><td>${c.data}</td>`;
    tbody.appendChild(tr);
  });
}

// Atualizar Portarias Internas
function atualizarPortariasInternasLista() {
  const ul = document.getElementById('listaPortariasInternas');
  ul.innerHTML = '';
  portariasInternas.forEach(p => {
    const li = document.createElement('li');
    li.textContent = `${p.titulo} - ${p.conteudo} (Criado em: ${p.data})`;
    ul.appendChild(li);
  });
}

// Atualizar Membros
function atualizarMembrosTabela() {
  const tbody = document.querySelector('#tabelaMembros tbody');
  tbody.innerHTML = '';
  usuarios.forEach(u => {
    const tr = document.createElement('tr');
    tr.innerHTML = `<td>${u.username}</td><td>${u.cargo}</td>`;
    tbody.appendChild(tr);
  });
}

// Atualizar Avisos Públicos (usando portarias públicas como exemplo)
function mostrarAvisosPublicos() {
  const ul = document.getElementById('listaAvisosPublicos');
  ul.innerHTML = '';
  portariasPublicas.forEach(p => {
    const li = document.createElement('li');
    li.textContent = `${p.titulo} - ${p.conteudo} (Criado em: ${p.data})`;
    ul.appendChild(li);
  });
}

// Eventos formulário BO Público
document.getElementById('formBOPublico').addEventListener('submit', e => {
  e.preventDefault();
  const titulo = document.getElementById('tituloBOPublico').value.trim();
  const descricao = document.getElementById('descricaoBOPublico').value.trim();
  const denunciado = document.getElementById('denunciadoBOPublico').value.trim();
  if (!titulo || !descricao || !denunciado) {
    alert('Preencha todos os campos do B.O.');
    return;
  }
  boletinsPublicos.push({
    titulo,
    descricao,
    denunciado,
    data: new Date().toLocaleString()
  });
  salvarDados();
  atualizarTabelaBOPublico();
  document.getElementById('formBOPublico').reset();
});

// Eventos formulário Banco Criminal
document.getElementById('formBancoCriminal').addEventListener('submit', e => {
  e.preventDefault();
  const nome = document.getElementById('nomeCriminoso').value.trim();
  const tipo = document.getElementById('tipoCrime').value.trim();
  const descricao = document.getElementById('descricaoCrime').value.trim();
  if (!nome || !tipo || !descricao) {
    alert('Preencha todos os campos do Banco Criminal.');
    return;
  }
  bancoCriminal.push({
    nome,
    tipo,
    descricao,
    data: new Date().toLocaleString()
  });
  salvarDados();
  atualizarBancoCriminalTabela();
  document.getElementById('formBancoCriminal').reset();
});

// Eventos formulário Portaria Interna
document.getElementById('formPortaria').addEventListener('submit', e => {
  e.preventDefault();
  if (!podeGerenciarPortarias()) {
    alert('Acesso negado: Apenas Delegado+ pode criar portarias.');
    return;
  }
  const titulo = document.getElementById('tituloPortaria').value.trim();
  const conteudo = document.getElementById('conteudoPortaria').value.trim();
  if (!titulo || !conteudo) {
    alert('Preencha todos os campos da Portaria.');
    return;
  }
  portariasInternas.push({
    titulo,
    conteudo,
    data: new Date().toLocaleString()
  });
  salvarDados();
  atualizarPortariasInternasLista();
  document.getElementById('formPortaria').reset();
});

// Eventos formulário Registro Membros
document.getElementById('formRegistroMembros').addEventListener('submit', e => {
  e.preventDefault();
  if (!podeRegistrarMembros()) {
    alert('Acesso negado: Apenas Diretor ou Diretor Geral pode registrar membros.');
    return;
  }
  const novoUser = document.getElementById('novoUsuario').value.trim();
  const novaSenha = document.getElementById('novaSenha').value.trim();
  const cargoInicial = document.getElementById('cargoInicial').value;
  if (!novoUser || !novaSenha || !cargoInicial) {
    alert('Preencha todos os campos para registrar o membro.');
    return;
  }
  if (usuarios.find(u => u.username === novoUser)) {
    alert('Usuário já existe.');
    return;
  }
  // Só pode registrar cargos inferiores ao cargo do logado
  const idxCargoLogado = cargosHierarquia.indexOf(usuarioLogado.cargo);
  const idxCargoNovo = cargosHierarquia.indexOf(cargoInicial);
  if (idxCargoNovo >= idxCargoLogado) {
    alert('Não pode registrar com cargo igual ou superior ao seu.');
    return;
  }
  usuarios.push({username: novoUser, password: novaSenha, cargo: cargoInicial});
  salvarDados();
  atualizarUsuariosTabela();
  atualizarMembrosTabela();
  document.getElementById('formRegistroMembros').reset();
});

// Login
document.getElementById('loginForm').addEventListener('submit', e => {
  e.preventDefault();
  const username = document.getElementById('username').value.trim();
  const password = document.getElementById('password').value.trim();
  const usuario = usuarios.find(u => u.username === username && u.password === password);
  if (!usuario) {
    document.getElementById('login-error').textContent = 'Usuário ou senha incorretos.';
    return;
  }
  usuarioLogado = usuario;
  mostrarApp();
});

// Logout
function logout() {
  usuarioLogado = null;
  mostrarDashboardPublico();
}

// Inicialização
mostrarDashboardPublico();

</script>

</body>
</html>

