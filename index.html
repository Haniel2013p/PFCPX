<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Serviço Secreto Municipal</title>
<style>
  body { font-family: Arial, sans-serif; margin: 20px; background: #f4f4f4; }
  #login, #cadastro, #painel { max-width: 600px; margin: auto; background: white; padding: 20px; border-radius: 6px; box-shadow: 0 0 8px #ccc; }
  h2 { text-align: center; }
  label { display: block; margin: 10px 0 5px; }
  input[type=text], input[type=password], select { width: 100%; padding: 8px; box-sizing: border-box; }
  button { padding: 10px 20px; margin: 10px 5px 0 0; cursor: pointer; border: none; border-radius: 4px; }
  #menuTopo button { background-color: #357edd; color: white; margin-right: 10px; }
  #menuTopo button#btnResetar { background: #b33; }
  #menuTopo button#btnLogout { background: #d44; }
  #menuTopo { margin-bottom: 15px; }
  #menuTopo button { display: inline-block; }
  #mensagem, #mensagemCadastro { color: red; margin-top: 10px; }
  table { width: 100%; border-collapse: collapse; margin-top: 10px; }
  table, th, td { border: 1px solid #ccc; }
  th, td { padding: 8px; text-align: left; }
  #textoExplicativo { text-align: center; margin-bottom: 15px; }
  #listaRegistros { max-height: 200px; overflow-y: auto; background: #eef; padding: 10px; border-radius: 4px; margin-top: 10px; }
</style>
</head>
<body>

<div id="login">
  <h2>Login Serviço Secreto</h2>
  <label for="loginId">ID:</label>
  <input type="text" id="loginId" />
  <label for="loginSenha">Senha:</label>
  <input type="password" id="loginSenha" />
  <button id="btnLogin">Entrar</button>
  <p id="mensagem"></p>
  <hr />
  <p>Não tem conta? <button id="btnVaiCadastro">Cadastre-se</button></p>
</div>

<div id="cadastro" style="display:none;">
  <h2>Cadastro Serviço Secreto</h2>
  <label for="cadNome">Nome Completo:</label>
  <input type="text" id="cadNome" />
  <label for="cadSenha">Senha:</label>
  <input type="password" id="cadSenha" />
  <button id="btnCadastrar">Cadastrar</button>
  <button id="btnVoltarLogin">Voltar ao Login</button>
  <p id="mensagemCadastro"></p>
</div>

<div id="painel" style="display:none;">
  <div id="menuTopo">
    <button id="btnSobre">Sobre o Serviço Secreto</button>
    <button id="btnListaRegistros">Lista de registros</button>
    <button id="btnPainel">Painel de controle</button>
    <button id="btnResetar">Resetar banco de dados</button>
    <button id="btnLogout">Sair</button>
  </div>

  <div id="textoExplicativo" style="display:none;">
    <h3>Bem-vindo ao Serviço Secreto Municipal</h3>
    <p>Este serviço é responsável por gerenciar o quadro de agentes, promoções, rebaixamentos e expulsões.</p>
  </div>

  <div id="listaRegistros" style="display:none;"></div>

  <div id="painelControle" style="display:none;">
    <h3>Painel de Controle</h3>
    <label for="pesquisaJogador">Pesquisar Jogador pelo ID:</label>
    <input type="text" id="pesquisaJogador" />
    <button id="btnPesquisar">Pesquisar</button>
    <div id="resultadoPesquisa" style="margin-top:10px;"></div>
  </div>
</div>

<script>
  // Variáveis globais
  let jogadores = {};
  let idAtual = null; // usuário logado
  let idSelecionado = null; // para painel

  // Ao entrar no site, limpar banco de dados (localStorage)
  localStorage.removeItem('jogadores');

  // Funções auxiliares para salvar e carregar
  function salvarLocalStorage() {
    localStorage.setItem('jogadores', JSON.stringify(jogadores));
  }

  function carregarLocalStorage() {
    const data = localStorage.getItem('jogadores');
    jogadores = data ? JSON.parse(data) : {};
  }

  // Carregar dados (vai estar vazio por causa do reset)
  carregarLocalStorage();

  // Forçar cadastro inicial do diretor (ID = 1)
  if (!jogadores['1']) {
    jogadores['1'] = { nome: 'Diretor', senha: 'diretor123', cargo: 'Diretor' };
    salvarLocalStorage();
  }

  // Elementos
  const loginDiv = document.getElementById('login');
  const cadastroDiv = document.getElementById('cadastro');
  const painelDiv = document.getElementById('painel');
  const mensagem = document.getElementById('mensagem');
  const mensagemCadastro = document.getElementById('mensagemCadastro');

  const textoExplicativo = document.getElementById('textoExplicativo');
  const listaRegistrosDiv = document.getElementById('listaRegistros');
  const painelControleDiv = document.getElementById('painelControle');

  // Botões
  document.getElementById('btnVaiCadastro').onclick = () => {
    mensagem.textContent = '';
    loginDiv.style.display = 'none';
    cadastroDiv.style.display = 'block';
  };

  document.getElementById('btnVoltarLogin').onclick = () => {
    mensagemCadastro.textContent = '';
    cadastroDiv.style.display = 'none';
    loginDiv.style.display = 'block';
  };

  document.getElementById('btnCadastrar').onclick = () => {
    const nome = document.getElementById('cadNome').value.trim();
    const senha = document.getElementById('cadSenha').value.trim();

    mensagemCadastro.style.color = 'red';

    if (!nome || !senha) {
      mensagemCadastro.textContent = 'Preencha todos os campos.';
      return;
    }

    // Acha novo ID
    let novoId = 1;
    while (jogadores[novoId]) novoId++;

    jogadores[novoId] = { nome, senha, cargo: 'Agente' };
    salvarLocalStorage();

    mensagemCadastro.style.color = 'green';
    mensagemCadastro.textContent = `Cadastro realizado com sucesso! Seu ID é ${novoId}. Volte ao login.`;

    // Limpa campos
    document.getElementById('cadNome').value = '';
    document.getElementById('cadSenha').value = '';
  };

  document.getElementById('btnLogin').onclick = () => {
    const id = document.getElementById('loginId').value.trim();
    const senha = document.getElementById('loginSenha').value.trim();
    mensagem.style.color = 'red';

    if (!id || !senha) {
      mensagem.textContent = 'Preencha ID e senha.';
      return;
    }

    if (!jogadores[id]) {
      mensagem.textContent = 'ID não encontrado.';
      return;
    }

    if (jogadores[id].senha !== senha) {
      mensagem.textContent = 'Senha incorreta.';
      return;
    }

    idAtual = id;
    mensagem.textContent = '';
    loginDiv.style.display = 'none';
    cadastroDiv.style.display = 'none';
    painelDiv.style.display = 'block';

    mostrarTextoExplicativo();
    mostrarMenu('textoExplicativo');
  };

  function mostrarTextoExplicativo() {
    textoExplicativo.style.display = 'block';
    listaRegistrosDiv.style.display = 'none';
    painelControleDiv.style.display = 'none';
  }

  function mostrarMenu(menu) {
    textoExplicativo.style.display = (menu === 'textoExplicativo');
    listaRegistrosDiv.style.display = (menu === 'listaRegistros');
    painelControleDiv.style.display = (menu === 'painelControle');
  }

  // Botões do painel
  document.getElementById('btnSobre').onclick = () => {
    mostrarMenu('textoExplicativo');
  };

  document.getElementById('btnListaRegistros').onclick = () => {
    montarListaRegistros();
    mostrarMenu('listaRegistros');
  };

  document.getElementById('btnPainel').onclick = () => {
    mostrarMenu('painelControle');
  };

  document.getElementById('btnLogout').onclick = () => {
    if (confirm('Deseja realmente sair?')) {
      idAtual = null;
      idSelecionado = null;
      painelDiv.style.display = 'none';
      loginDiv.style.display = 'block';
      document.getElementById('loginId').value = '';
      document.getElementById('loginSenha').value = '';
    }
  };

  // Resetar banco de dados
  document.getElementById('btnResetar').onclick = () => {
    if (confirm('Tem certeza que deseja resetar todo o banco de dados?')) {
      jogadores = {};
      // recria o diretor
      jogadores['1'] = { nome: 'Diretor', senha: 'diretor123', cargo: 'Diretor' };
      salvarLocalStorage();
      idAtual = null;
      idSelecionado = null;
      painelDiv.style.display = 'none';
      loginDiv.style.display = 'block';
      alert('Banco de dados resetado com sucesso!');
    }
  };

  // Monta a lista de registros
  function montarListaRegistros() {
    let html = '<table><thead><tr><th>ID</th><th>Nome</th><th>Cargo</th></tr></thead><tbody>';
    for (const id in jogadores) {
      const p = jogadores[id];
      html += `<tr><td>${id}</td><td>${p.nome}</td><td>${p.cargo}</td></tr>`;
    }
    html += '</tbody></table>';
    listaRegistrosDiv.innerHTML = html;
  }

  // Pesquisa jogador
  document.getElementById('btnPesquisar').onclick = () => {
    const id = document.getElementById('pesquisaJogador').value.trim();
    const resultadoDiv = document.getElementById('resultadoPesquisa');
    if (!id) {
      resultadoDiv.innerHTML = '<span style="color:red;">Digite um ID para pesquisar.</span>';
      return;
    }
    if (!jogadores[id]) {
      resultadoDiv.innerHTML = '<span style="color:red;">Jogador não encontrado.</span>';
      return;
    }
    const p = jogadores[id];
    resultadoDiv.innerHTML = `
      <p><strong>ID:</strong> ${id}</p>
      <p><strong>Nome:</strong> ${p.nome}</p>
      <p><strong>Cargo:</strong> ${p.cargo}</p>
    `;
  };
</script>

</body>
</html>
