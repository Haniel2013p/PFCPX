<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Painel Serviço Secreto Municipal</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background-color: #222;
    color: #eee;
    margin: 0; padding: 0;
  }
  .container {
    max-width: 700px;
    margin: 20px auto;
    background: #333;
    padding: 20px;
    border-radius: 8px;
  }
  input, select, textarea, button {
    width: 100%;
    margin: 6px 0;
    padding: 8px;
    border-radius: 4px;
    border: none;
    font-size: 1em;
  }
  textarea {
    resize: vertical;
    height: 60px;
  }
  button {
    cursor: pointer;
  }
  button.blue {
    background-color: #007bff;
    color: white;
  }
  button.red {
    background-color: #dc3545;
    color: white;
  }
  button.green {
    background-color: #28a745;
    color: white;
  }
  button.grey {
    background-color: #555;
    color: white;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 12px;
  }
  th, td {
    border: 1px solid #666;
    padding: 8px;
    text-align: left;
  }
  th {
    background-color: #444;
  }
  .hidden {
    display: none;
  }
  #menu-buttons button {
    width: auto;
    margin-right: 10px;
  }
</style>
</head>
<body>
<div class="container">

  <div id="login-section">
    <h2>Login no Serviço Secreto Municipal</h2>
    <input type="text" id="login-id" placeholder="ID" />
    <input type="password" id="login-password" placeholder="Senha" />
    <button id="btn-login" class="blue">Entrar</button>
    <p>Não tem conta? <button id="btn-show-register" class="grey" style="width:auto;">Cadastrar-se</button></p>
  </div>

  <div id="register-section" class="hidden">
    <h2>Cadastro</h2>
    <input type="text" id="reg-name" placeholder="Nome" />
    <input type="text" id="reg-id" placeholder="ID (Número único)" />
    <input type="password" id="reg-password" placeholder="Senha" />
    <select id="reg-cargo">
      <option value="Estagiário">Estagiário</option>
      <option value="Agente">Agente</option>
      <option value="Investigador">Investigador</option>
      <option value="Detetive">Detetive</option>
      <option value="Chefe de Seção">Chefe de Seção</option>
      <option value="Diretor">Diretor</option>
      <option value="VSSP">VSSP</option>
      <option value="SSP">SSP</option>
      <option value="Administrador">Administrador</option>
    </select>
    <button id="btn-register" class="green">Cadastrar</button>
    <button id="btn-cancel-register" class="grey">Cancelar</button>
  </div>

  <div id="panel-section" class="hidden">
    <div id="menu-buttons">
      <button id="btn-lista" class="blue">Lista de registros</button>
      <button id="btn-banco" class="blue">Banco criminais</button>
      <button id="btn-logout" class="red">Sair</button>
    </div>
    <hr/>
    <div id="welcome-text" style="margin-bottom: 10px; font-size: 1.1em;">
      Bem-vindo ao Serviço Secreto Municipal. Use os botões acima para navegar.
    </div>

    <div id="lista-registros" class="hidden">
      <h3>Lista de registros</h3>
      <table>
        <thead>
          <tr><th>ID</th><th>Nome</th><th>Cargo</th><th>Ações</th></tr>
        </thead>
        <tbody id="registros-tbody">
          <!-- registros vão aqui -->
        </tbody>
      </table>
      <button id="btn-voltar-lista" class="blue">Voltar</button>
    </div>

    <div id="banco-criminais" class="hidden">
      <h3>Banco de Registros Criminais</h3>
      <input type="text" id="input-search-rg" placeholder="RG para pesquisar" />
      <input type="text" id="input-search-id" placeholder="ID (automático)" disabled />
      <input type="text" id="input-search-nome" placeholder="Nome" />
      <input type="text" id="input-search-rg2" placeholder="RG" />
      <textarea id="input-search-historico" placeholder="Histórico"></textarea>
      <select id="input-search-status">
        <option>Em investigação</option>
        <option>Processo penal em andamento</option>
        <option>Fugitivo</option>
        <option>Em liberdade</option>
      </select>
      <button id="btn-adicionar-criminal" class="blue">Adicionar</button>
      <button id="btn-pesquisar-criminal" class="blue">Pesquisar</button>
      <button id="btn-voltar-banco" class="blue">Voltar</button>

      <h4>Resultados:</h4>
      <table>
        <thead>
          <tr><th>Nome</th><th>RG</th><th>Histórico</th><th>Total de Prisões</th><th>Status</th></tr>
        </thead>
        <tbody id="resultados-tbody"></tbody>
      </table>
    </div>
  </div>
</div>

<script>
  // Dados em localStorage
  // Usuários: array de objetos {id, nome, senha, cargo}
  // Exemplo de usuário administrador fixo:
  const adminUser = {
    id: "200",
    nome: "Administrador",
    senha: "Haniel",
    cargo: "Administrador"
  };

  // Cargos na ordem hierárquica:
  const cargos = [
    "Estagiário",
    "Agente",
    "Investigador",
    "Detetive",
    "Chefe de Seção",
    "Diretor",
    "VSSP",
    "SSP",
    "Administrador" // acima de SSP
  ];

  // Inicializa usuários no localStorage com admin fixo se não existir
  function inicializaUsuarios() {
    let usuarios = JSON.parse(localStorage.getItem("usuarios"));
    if (!usuarios) {
      usuarios = [adminUser];
      localStorage.setItem("usuarios", JSON.stringify(usuarios));
    } else {
      // garante que adminUser está no array (sem duplicar)
      const existeAdmin = usuarios.some(u => u.id === adminUser.id);
      if (!existeAdmin) {
        usuarios.push(adminUser);
        localStorage.setItem("usuarios", JSON.stringify(usuarios));
      }
    }
  }

  // Inicializa registros criminais no localStorage
  function inicializaCriminais() {
    let criminais = JSON.parse(localStorage.getItem("criminais"));
    if (!criminais) {
      criminais = [];
      localStorage.setItem("criminais", JSON.stringify(criminais));
    }
  }

  // Estado do usuário logado
  let usuarioLogado = null;

  // Funções DOM
  const loginSection = document.getElementById("login-section");
  const registerSection = document.getElementById("register-section");
  const panelSection = document.getElementById("panel-section");

  const btnLogin = document.getElementById("btn-login");
  const btnShowRegister = document.getElementById("btn-show-register");
  const btnRegister = document.getElementById("btn-register");
  const btnCancelRegister = document.getElementById("btn-cancel-register");

  const btnLogout = document.getElementById("btn-logout");
  const btnLista = document.getElementById("btn-lista");
  const btnBanco = document.getElementById("btn-banco");

  const listaRegistrosDiv = document.getElementById("lista-registros");
  const bancoCriminaisDiv = document.getElementById("banco-criminais");

  const registrosTbody = document.getElementById("registros-tbody");
  const resultadosTbody = document.getElementById("resultados-tbody");

  const btnVoltarLista = document.getElementById("btn-voltar-lista");
  const btnVoltarBanco = document.getElementById("btn-voltar-banco");

  // Form campos banco criminoso
  const inputSearchRG = document.getElementById("input-search-rg");
  const inputSearchID = document.getElementById("input-search-id");
  const inputSearchNome = document.getElementById("input-search-nome");
  const inputSearchRG2 = document.getElementById("input-search-rg2");
  const inputSearchHistorico = document.getElementById("input-search-historico");
  const inputSearchStatus = document.getElementById("input-search-status");

  // Form campos login
  const inputLoginID = document.getElementById("login-id");
  const inputLoginSenha = document.getElementById("login-password");

  // Form campos cadastro
  const inputRegName = document.getElementById("reg-name");
  const inputRegID = document.getElementById("reg-id");
  const inputRegSenha = document.getElementById("reg-password");
  const selectRegCargo = document.getElementById("reg-cargo");

  // Inicialização
  inicializaUsuarios();
  inicializaCriminais();

  // Mostrar/ocultar seções
  function mostrarLogin() {
    loginSection.classList.remove("hidden");
    registerSection.classList.add("hidden");
    panelSection.classList.add("hidden");
    limpaCamposLogin();
  }
  function mostrarCadastro() {
    loginSection.classList.add("hidden");
    registerSection.classList.remove("hidden");
    panelSection.classList.add("hidden");
    limpaCamposCadastro();
  }
  function mostrarPainel() {
    loginSection.classList.add("hidden");
    registerSection.classList.add("hidden");
    panelSection.classList.remove("hidden");
    mostrarListaRegistros(false);
    mostrarBancoCriminais(false);
  }

  // Limpar campos
  function limpaCamposLogin() {
    inputLoginID.value = "";
    inputLoginSenha.value = "";
  }
  function limpaCamposCadastro() {
    inputRegName.value = "";
    inputRegID.value = "";
    inputRegSenha.value = "";
    selectRegCargo.value = "Estagiário";
  }
  function limpaCamposBancoCriminais() {
    inputSearchRG.value = "";
    inputSearchID.value = "";
    inputSearchNome.value = "";
    inputSearchRG2.value = "";
    inputSearchHistorico.value = "";
    inputSearchStatus.value = "Em investigação";
    resultadosTbody.innerHTML = "";
  }

  // Função para login
  btnLogin.onclick = () => {
    const id = inputLoginID.value.trim();
    const senha = inputLoginSenha.value.trim();
    if (!id || !senha) {
      alert("Preencha ID e senha.");
      return;
    }
    let usuarios = JSON.parse(localStorage.getItem("usuarios")) || [];
    const usuario = usuarios.find(u => u.id === id && u.senha === senha);
    if (usuario) {
      usuarioLogado = usuario;
      mostrarPainel();
      alert(Bem-vindo, ${usuario.nome} (${usuario.cargo})!);
      carregarListaRegistros();
    } else {
      alert("ID ou senha inválidos.");
    }
  };

  // Mostrar tela de cadastro
  btnShowRegister.onclick = () => {
    mostrarCadastro();
  };

  // Cancelar cadastro
  btnCancelRegister.onclick = () => {
    mostrarLogin();
  };

  // Cadastro novo usuário
  btnRegister.onclick = () => {
    const nome = inputRegName.value.trim();
    const id = inputRegID.value.trim();
    const senha = inputRegSenha.value.trim();
    const cargo = selectRegCargo.value;

    if (!nome || !id || !senha) {
      alert("Preencha todos os campos do cadastro.");
      return;
    }

    if (id === "200") {
      alert("ID 200 reservado para Administrador fixo.");
      return;
    }

    let usuarios = JSON.parse(localStorage.getItem("usuarios")) || [];
    if (usuarios.find(u => u.id === id)) {
      alert("ID já cadastrado.");
      return;
    }
    usuarios.push({id, nome, senha, cargo});
    localStorage.setItem("usuarios", JSON.stringify(usuarios));
    alert("Cadastro realizado com sucesso. Faça login.");
    mostrarLogin();
  };

  // Logout
  btnLogout.onclick = () => {
    usuarioLogado = null;
    mostrarLogin();
  };

  // Mostrar lista de registros
  btnLista.onclick = () => {
    mostrarListaRegistros(true);
    mostrarBancoCriminais(false);
  };

  btnVoltarLista.onclick = () => {
    mostrarListaRegistros(false);
  };

  // Mostrar banco de criminosos
  btnBanco.onclick = () => {
    mostrarListaRegistros(false);
    mostrarBancoCriminais(true);
    limpaCamposBancoCriminais();
    carregarProximoIdCriminal();
  };

  btnVoltarBanco.onclick = () => {
    mostrarBancoCriminais(false);
  };

  // Mostrar/ocultar lista registros
  function mostrarListaRegistros(mostrar) {
    if (mostrar) {
      listaRegistrosDiv.classList.remove("hidden");
      bancoCriminaisDiv.classList.add("hidden");
      carregarListaRegistros();
    } else {
      listaRegistrosDiv.classList.add("hidden");
    }
  }

  // Mostrar/ocultar banco criminais
  function mostrarBancoCriminais(mostrar) {
    if (mostrar) {
      bancoCriminaisDiv.classList.remove("hidden");
      listaRegistrosDiv.classList.add("hidden");
    } else {
      bancoCriminaisDiv.classList.add("hidden");
    }
  }

  // Carregar lista de registros na tabela
  function carregarListaRegistros() {
    let usuarios = JSON.parse(localStorage.getItem("usuarios")) || [];
    registrosTbody.innerHTML = "";

    usuarios.sort((a,b) => parseInt(a.id) - parseInt(b.id));
    usuarios.forEach(u => {
      const tr = document.createElement("tr");
      tr.innerHTML = <td>${u.id}</td><td>${u.nome}</td><td>${u.cargo}</td><td></td>;
      const tdAcoes = tr.querySelector("td:last-child");

      // Botão promover (se não for Administrador e não estiver no topo)
      if (cargos.indexOf(u.cargo) < cargos.length - 1) {
        const btnPromover = document.createElement("button");
        btnPromover.className = "blue";
        btnPromover.textContent = "Promover";
        btnPromover.onclick = () => promoverUsuario(u.id);
        tdAcoes.appendChild(btnPromover);
      }
      // Botão rebaixar (se não for Estagiário)
      if (cargos.indexOf(u.cargo) > 0 && u.cargo !== "Administrador") {
        const btnRebaixar = document.createElement("button");
        btnRebaixar.className = "blue";
        btnRebaixar.textContent = "Rebaixar";
        btnRebaixar.style.marginLeft = "6px";
        btnRebaixar.onclick = () => rebaixarUsuario(u.id);
        tdAcoes.appendChild(btnRebaixar);
      }
      // Botão expulsar (não pode expulsar admin 200)
      if (u.id !== "200") {
        const btnExpulsar = document.createElement("button");
        btnExpulsar.className = "red";
        btnExpulsar.textContent = "Expulsar";
        btnExpulsar.style.marginLeft = "6px";
        btnExpulsar.onclick = () => expulsarUsuario(u.id);
        tdAcoes.appendChild(btnExpulsar);
      }

      registrosTbody.appendChild(tr);
    });
  }

  // Função promover usuário
  function promoverUsuario(id) {
    if (!usuarioLogado) return;
    let usuarios = JSON.parse(localStorage.getItem("usuarios")) || [];
    let u = usuarios.find(x => x.id === id);
    if (!u) return alert("Usuário não encontrado");
    if (u.cargo === "Administrador") return alert("Não pode promover além de Administrador");

    let cargoIndex = cargos.indexOf(u.cargo);
    if (cargoIndex === -1 || cargoIndex >= cargos.length - 1) return alert("Não pode promover");

    // Só pode promover se seu cargo for maior ou igual ao cargo que está promovendo
    let seuCargoIndex = cargos.indexOf(usuarioLogado.cargo);
    if (seuCargoIndex <= cargoIndex) return alert("Você não tem permissão para promover este usuário.");

    u.cargo = cargos[cargoIndex + 1];
    localStorage.setItem("usuarios", JSON.stringify(usuarios));
    carregarListaRegistros();
  }

  // Função rebaixar usuário
  function rebaixarUsuario(id) {
    if (!usuarioLogado) return;
    let usuarios = JSON.parse(localStorage.getItem("usuarios")) || [];
    let u = usuarios.find(x => x.id === id);
    if (!u) return alert("Usuário não encontrado");
    if (u.cargo === "Estagiário" || u.cargo === "Administrador") return alert("Não pode rebaixar este usuário");

    let cargoIndex = cargos.indexOf(u.cargo);
    if (cargoIndex <= 0) return alert("Não pode rebaixar");

        // Só pode rebaixar se seu cargo for maior que o cargo do usuário
    let seuCargoIndex = cargos.indexOf(usuarioLogado.cargo);
    if (seuCargoIndex <= cargoIndex) return alert("Você não tem permissão para rebaixar este usuário.");

    u.cargo = cargos[cargoIndex - 1];
    localStorage.setItem("usuarios", JSON.stringify(usuarios));
    carregarListaRegistros();
  }

  // Função expulsar usuário
  function expulsarUsuario(id) {
    if (!usuarioLogado) return;
    if (id === "200") return alert("Você não pode expulsar o Administrador fixo.");

    let usuarios = JSON.parse(localStorage.getItem("usuarios")) || [];
    let u = usuarios.find(x => x.id === id);
    if (!u) return alert("Usuário não encontrado");

    let cargoIndex = cargos.indexOf(u.cargo);
    let seuCargoIndex = cargos.indexOf(usuarioLogado.cargo);
    if (seuCargoIndex <= cargoIndex) return alert("Você não tem permissão para expulsar este usuário.");

    if (confirm(Tem certeza que deseja expulsar ${u.nome}?)) {
      usuarios = usuarios.filter(x => x.id !== id);
      localStorage.setItem("usuarios", JSON.stringify(usuarios));
      carregarListaRegistros();
    }
  }

  // Banco de registros criminais
  document.getElementById("btn-adicionar-criminal").onclick = () => {
    if (!usuarioLogado) return;
    if (cargos.indexOf(usuarioLogado.cargo) < 0) return alert("Você precisa estar logado.");

    const nome = inputSearchNome.value.trim();
    const rg = inputSearchRG2.value.trim();
    const historico = inputSearchHistorico.value.trim();
    const status = inputSearchStatus.value;
    const id = inputSearchID.value.trim();

    if (!nome || !rg || !historico) {
      alert("Preencha todos os campos.");
      return;
    }

    let criminais = JSON.parse(localStorage.getItem("criminais")) || [];
    let totalPrisao = criminais.filter(x => x.rg === rg).length + 1;

    criminais.push({ id, nome, rg, historico, status, totalPrisao });
    localStorage.setItem("criminais", JSON.stringify(criminais));
    alert("Registro adicionado.");
    limpaCamposBancoCriminais();
    carregarProximoIdCriminal();
  };

  document.getElementById("btn-pesquisar-criminal").onclick = () => {
    const rg = inputSearchRG.value.trim();
    if (!rg) {
      alert("Digite o RG para pesquisar.");
      return;
    }

    let criminais = JSON.parse(localStorage.getItem("criminais")) || [];
    const resultados = criminais.filter(x => x.rg === rg);
    resultadosTbody.innerHTML = "";

    if (resultados.length === 0) {
      resultadosTbody.innerHTML = "<tr><td colspan='5'>Nenhum registro encontrado.</td></tr>";
    } else {
      resultados.forEach(r => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${r.nome}</td>
          <td>${r.rg}</td>
          <td>${r.historico}</td>
          <td>${r.totalPrisao}</td>
          <td>${r.status}</td>
        `;
        resultadosTbody.appendChild(tr);
      });
    }
  };

  function carregarProximoIdCriminal() {
    let criminais = JSON.parse(localStorage.getItem("criminais")) || [];
    let maiorId = criminais.reduce((acc, cur) => Math.max(acc, parseInt(cur.id || 0)), 0);
    inputSearchID.value = (maiorId + 1).toString();
  }

  // Iniciar exibindo tela de login
  mostrarLogin();
</script>
</body>
</html>
