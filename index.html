<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>PF‑RP Completo com Firebase</title>
  <style>
    body{font-family:Arial,sans-serif;margin:0;padding:0;background:#f0f2f5;}
    header{background:#004080;color:#fff;padding:15px;text-align:center;}
    section{max-width:900px;margin:20px auto;background:#fff;padding:15px;border-radius:8px;box-shadow:0 0 8px #ccc;}
    .hidden{display:none;}
    nav button{margin:5px;padding:8px 12px;background:#004080;color:#fff;border:none;border-radius:4px;cursor:pointer;}
    nav button:hover{background:#003060;}
    input,textarea,select,button{width:100%;margin-top:5px;padding:8px;border:1px solid #aaa;border-radius:4px;box-sizing:border-box;}
    table{width:100%;border-collapse:collapse;margin-top:10px;}
    th,td{padding:8px;border:1px solid #ddd;word-break:break-word;}
    th{background:#004080;color:#fff;}
    .msg{color:red;font-weight:bold;margin:5px 0;}
  </style>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>
<body>
<header><h1>Sistema Polícia Federal (RP)</h1></header>

<section id="public_area">
  <h2>Área Pública</h2>
  <nav>
    <button onclick="showPublicTab('bo')">Boletins</button>
    <button onclick="showPublicTab('port')">Portarias Públicas</button>
    <button onclick="showLogin()">Área Restrita</button>
  </nav>
  <div id="public-bo">
    <h3>Registrar Boletim (qualquer pessoa)</h3>
    <form id="formPublicBO">
      <input id="pubDenunciante" placeholder="Seu nome" required/>
      <input id="pubAcusado" placeholder="Nome do acusado" required/>
      <textarea id="pubRelato" placeholder="Relato aqui..." rows="4" required></textarea>
      <button type="submit">Enviar BO</button>
    </form>
    <div id="listBOpublic"></div>
  </div>
  <div id="public-port" class="hidden">
    <h3>Portarias Públicas</h3>
    <div id="listPortPublic"></div>
  </div>
</section>

<section id="private_area" class="hidden">
  <div id="loginPanel">
    <h2>Login</h2>
    <form id="formLogin">
      <input id="loginName" placeholder="Usuário" required/>
      <input id="loginPass" placeholder="Senha" type="password" required/>
      <button type="submit">Entrar</button>
    </form>
    <div id="msgLogin" class="msg"></div>
    <button onclick="backToPublic()">Voltar</button>
  </div>
  <div id="appPanel" class="hidden">
    <div style="text-align:right;margin-bottom:10px;">
      Usuário: <span id="lblUser"></span> (<span id="lblCargo"></span>) 
      <button onclick="doLogout()">Sair</button>
    </div>
    <nav>
      <button onclick="showTab('membros')">Membros</button>
      <button onclick="showTab('acoes')">Promoções/Rebaixamentos</button>
      <button onclick="showTab('criminal')">Banco Criminal</button>
      <button onclick="showTab('portInt')">Portarias Internas</button>
    </nav>

    <!-- MEMBERS -->
    <div id="tab-membros" class="hidden">
      <h3>Registrar Membro (Diretor Geral)</h3>
      <form id="formMembro">
        <input id="membroNome" placeholder="Nome" required/>
        <select id="membroCargo" required><option value="">Selecione cargo</option>
          <option>Agente</option><option>Escrivão</option><option>Delegado</option>
          <option>Superintendente Regional</option><option>Diretor Geral</option>
        </select>
        <button type="submit">Registrar</button>
      </form>
      <div id="msgMembro" class="msg"></div>
    </div>

    <!-- ACTIONS -->
    <div id="tab-acoes" class="hidden">
      <h3>Gestão: Promoção/Rebaixamento/Exoneração</h3>
      <form id="formAcao">
        <input id="acaoNome" placeholder="Nome do membro" required/>
        <select id="acaoTipo" required>
          <option value="">Selecione ação</option>
          <option value="Promoção">Promoção</option>
          <option value="Rebaixamento">Rebaixamento</option>
          <option value="Exoneração">Exoneração</option>
        </select>
        <input id="acaoNovoCargo" placeholder="Novo cargo (se aplicável)"/>
        <button type="submit">Registrar Ação</button>
      </form>
      <div id="msgAcao" class="msg"></div>
      <div id="listaAcoes"></div>
    </div>
    <!-- CRIMINAL BANK -->
    <div id="tab-criminal" class="hidden">
      <h3>Banco Criminal</h3>
      <form id="formCriminal">
        <input id="crimNome" placeholder="Nome do acusado" required/>
        <textarea id="crimDescricao" placeholder="Descrição do crime" required></textarea>
        <button type="submit">Registrar Crime</button>
      </form>
      <div id="listaCrimes"></div>
    </div>

    <!-- PORTARIAS -->
    <div id="tab-portInt" class="hidden">
      <h3>Portarias Internas (SR+)</h3>
      <form id="formPortaria">
        <textarea id="portTexto" placeholder="Texto da portaria" required></textarea>
        <button type="submit">Publicar Portaria</button>
      </form>
      <div id="listaPortarias"></div>
    </div>
  </div>
</section>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyBuaVeRTLVxpAyboRiWS6E4KYHWlYZgMEw",
    authDomain: "pfcpx-c0b9b.firebaseapp.com",
    projectId: "pfcpx-c0b9b",
    storageBucket: "pfcpx-c0b9b.firebasestorage.app",
    messagingSenderId: "322312831509",
    appId: "1:322312831509:web:e5fe68609d34db6345c41c",
    measurementId: "G-24QF5E8Q5E"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  let usuarioAtual = null;

  function showPublicTab(tab) {
    document.getElementById("public-bo").classList.add("hidden");
    document.getElementById("public-port").classList.add("hidden");
    if (tab === "bo") document.getElementById("public-bo").classList.remove("hidden");
    else document.getElementById("public-port").classList.remove("hidden");
  }

  function showLogin() {
    document.getElementById("public_area").classList.add("hidden");
    document.getElementById("private_area").classList.remove("hidden");
    document.getElementById("loginPanel").classList.remove("hidden");
    document.getElementById("appPanel").classList.add("hidden");
  }

  function backToPublic() {
    document.getElementById("public_area").classList.remove("hidden");
    document.getElementById("private_area").classList.add("hidden");
  }

  function showTab(tab) {
    ['membros','acoes','criminal','portInt'].forEach(id=>{
      document.getElementById("tab-"+id).classList.add("hidden");
    });
    document.getElementById("tab-"+tab).classList.remove("hidden");
  }

  function doLogout() {
    usuarioAtual = null;
    backToPublic();
  }

  // Login fixo
  const usuariosFixos = {
    "Gabriel": {senha: "DG", cargo: "Diretor Geral"}
  };

  document.getElementById("formLogin").addEventListener("submit", function(e){
    e.preventDefault();
    const nome = loginName.value.trim();
    const senha = loginPass.value.trim();
    if(usuariosFixos[nome] && usuariosFixos[nome].senha === senha){
      usuarioAtual = {nome, cargo: usuariosFixos[nome].cargo};
      document.getElementById("lblUser").innerText = nome;
      document.getElementById("lblCargo").innerText = usuarioAtual.cargo;
      document.getElementById("loginPanel").classList.add("hidden");
      document.getElementById("appPanel").classList.remove("hidden");
    } else {
      msgLogin.innerText = "Login inválido.";
    }
  });

  // Registro de BO (público)
  formPublicBO.addEventListener("submit", function(e){
    e.preventDefault();
    const bo = {
      denunciante: pubDenunciante.value,
      acusado: pubAcusado.value,
      relato: pubRelato.value,
      data: new Date().toLocaleString()
    };
    db.ref("boletins").push(bo);
    formPublicBO.reset();
    alert("BO registrado com sucesso.");
  });

  // Registro de Membro
  formMembro.addEventListener("submit", function(e){
    e.preventDefault();
    if(usuarioAtual?.cargo !== "Diretor Geral"){
      msgMembro.innerText = "Apenas Diretor Geral pode registrar membros.";
      return;
    }
    const membro = {
      nome: membroNome.value,
      cargo: membroCargo.value,
      registradoPor: usuarioAtual.nome,
      data: new Date().toLocaleString()
    };
    db.ref("membros").push(membro);
    formMembro.reset();
    msgMembro.innerText = "Membro registrado.";
  });

  // Ação Hierárquica
  formAcao.addEventListener("submit", function(e){
    e.preventDefault();
    if(!["Delegado","Superintendente Regional","Diretor Geral"].includes(usuarioAtual.cargo)){
      msgAcao.innerText = "Apenas Delegado+ pode realizar ações.";
      return;
    }
    const acao = {
      nome: acaoNome.value,
      tipo: acaoTipo.value,
      novoCargo: acaoNovoCargo.value || "",
      realizadaPor: usuarioAtual.nome,
      data: new Date().toLocaleString()
    };
    db.ref("acoes").push(acao);
    msgAcao.innerText = "Ação registrada.";
    formAcao.reset();
  });

  // Registro criminal
  formCriminal.addEventListener("submit", function(e){
    e.preventDefault();
    const crime = {
      nome: crimNome.value,
      descricao: crimDescricao.value,
      registradoPor: usuarioAtual.nome,
      data: new Date().toLocaleString()
    };
    db.ref("crimes").push(crime);
    formCriminal.reset();
    alert("Crime registrado.");
  });

  // Portarias (SR+)
  formPortaria.addEventListener("submit", function(e){
    e.preventDefault();
    if(!["Superintendente Regional","Diretor Geral"].includes(usuarioAtual.cargo)){
      alert("Apenas SR+ pode publicar portaria.");
      return;
    }
    const port = {
      texto: portTexto.value,
      autor: usuarioAtual.nome,
      data: new Date().toLocaleString()
    };
    db.ref("portarias").push(port);
    formPortaria.reset();
    alert("Portaria publicada.");
  });

  // LISTAGENS
  db.ref("boletins").on("value", snap=>{
    const html = [];
    snap.forEach(item=>{
      const b = item.val();
      html.push(`<div><strong>${b.denunciante}</strong> denunciou <strong>${b.acusado}</strong><br>${b.relato}<br><small>${b.data}</small></div><hr>`);
    });
    listBOpublic.innerHTML = html.reverse().join("");
  });

  db.ref("portarias").on("value", snap=>{
    const html = [];
    snap.forEach(item=>{
      const p = item.val();
      html.push(`<div>${p.texto}<br><small>${p.autor} - ${p.data}</small></div><hr>`);
    });
    listPortPublic.innerHTML = listaPortarias.innerHTML = html.reverse().join("");
  });

  db.ref("crimes").on("value", snap=>{
    const html = [];
    snap.forEach(item=>{
      const c = item.val();
      html.push(`<div><strong>${c.nome}</strong>: ${c.descricao}<br><small>${c.registradoPor} - ${c.data}</small></div><hr>`);
    });
    listaCrimes.innerHTML = html.reverse().join("");
  });

  db.ref("acoes").on("value", snap=>{
    const html = [];
    snap.forEach(item=>{
      const a = item.val();
      html.push(`<div><strong>${a.tipo}</strong> - ${a.nome} ${a.novoCargo ? " para "+a.novoCargo : ""}<br><small>${a.realizadaPor} - ${a.data}</small></div><hr>`);
    });
    listaAcoes.innerHTML = html.reverse().join("");
  });
</script>
</body>
</html>
