<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Painel do Serviço Secreto Municipal</title>
<style>
body {
  font-family: Arial, sans-serif;
  background-color: #111;
  color: #eee;
  margin: 0;
  padding: 0;
}

.centered {
  text-align: center;
  margin-top: 50px;
}

.hidden {
  display: none;
}

input, select, textarea, button {
  display: block;
  margin: 10px auto;
  padding: 10px;
  width: 80%;
  max-width: 400px;
  border-radius: 5px;
  border: none;
}

button {
  background-color: #333;
  color: #fff;
  cursor: pointer;
}

button:hover {
  background-color: #555;
}

.top-bar {
  display: flex;
  justify-content: space-around;
  background-color: #222;
  padding: 10px;
  position: sticky;
  top: 0;
}

table {
  width: 90%;
  margin: auto;
  border-collapse: collapse;
  margin-top: 20px;
  color: #fff;
}

th, td {
  border: 1px solid #444;
  padding: 10px;
  text-align: center;
  background-color: #222;
}

textarea {
  height: 100px;
  resize: none;
}


</style>


</head>
<body>
  <div id="loginContainer" class="centered">
    <h2>Login</h2>
    <input type="text" id="loginId" placeholder="ID">
    <button onclick="login()">Entrar</button>
    <p>Ainda não tem conta? <a href="#" onclick="showCadastro()">Cadastre-se</a></p>
  </div>

  <div id="cadastroContainer" class="centered hidden">
    <h2>Cadastro</h2>
    <input type="text" id="cadastroId" placeholder="ID">
    <input type="text" id="cadastroNome" placeholder="Nome">
    <select id="cadastroDivisao">
      <option value="">Selecione uma divisão</option>
      <option value="Operações Táticas">Operações Táticas</option>
      <option value="Inteligência e Investigações">Inteligência e Investigações</option>
      <option value="Proteção Executiva">Proteção Executiva</option>
    </select>
    <button onclick="cadastrar()">Cadastrar</button>
    <p>Já tem conta? <a href="#" onclick="showLogin()">Login</a></p>
  </div>

  <div id="painelContainer" class="hidden">
    <div class="top-bar">
      <span id="userInfo"></span>
      <button onclick="mostrarRegistros()">Lista de Registros</button>
      <button onclick="mostrarBancoCriminais()">Banco Criminais</button>
      <button onclick="logout()">Sair</button>
    </div>
    <h2>Bem-vindo ao Serviço Secreto Municipal</h2>
    <p class="centered">Este sistema é esclusivo aos membros do Serviço Secreto Municipal,  use com responsabilidade.</p> 

    <div id="registroContainer" class="hidden">
      <h3>Lista de Registros</h3>
      <table id="tabelaRegistros"></table>
    </div>

    <div id="bancoCriminaisContainer" class="hidden">
      <h3>Banco de Dados Criminais</h3>
      <div class="form-criminal">
        <input type="text" id="nomeCriminal" placeholder="Nome">
        <input type="text" id="rgCriminal" placeholder="RG">
        <textarea id="historicoCriminal" placeholder="Histórico"></textarea>
        <select id="statusCriminal">
          <option>Em investigação</option>
          <option>Processo penal em andamento</option>
          <option>Fugitivo</option>
          <option>Em liberdade</option>
        </select>
        <label><input type="checkbox" id="foiPreso"> Foi preso?</label>
        <button onclick="adicionarCriminal()">Adicionar</button>
        <hr>
        <input type="text" id="pesquisaRG" placeholder="Pesquisar por RG">
        <button onclick="pesquisarCriminal()">Pesquisar</button>
        <div id="resultadoPesquisa" class="hidden"></div>
      </div>


    </div>
  </div>
<script>
const divisoes = {
  "Inteligência e Investigações": [
    "Estagiário",
    "Investigador Operacional",
    "Agente de Inteligência",
    "Agente Especializado",
    "Inspetor",
    "Inspetor Chefe",
    "Chefe de Inteligência"
  ],
  "Operações Táticas": [
    "Agente de Operações Especiais",
    "Agente de Intervenção",
    "Capitão",
    "Coordenador de Operações Táticas"
  ],
  "Proteção Executiva": [
    "Agente de Segurança Municipal",
    "Agente de Proteção Avançada",
    "Sub Comandante de Segurança",
    "Comandante de Segurança"
  ],
  "Divisão Comando": [
    "Inspetor Geral",
    "Chefe de Operações",
    "Sub Diretor do Serviço Secreto",
    "Diretor do Serviço Secreto"
  ]
};

const especiais = ["VSSP", "SSP", "ADMINISTRADOR"];

function salvarUsuarios(usuarios) {
  localStorage.setItem("usuarios", JSON.stringify(usuarios));
}

function obterUsuarios() {
  return JSON.parse(localStorage.getItem("usuarios") || "[]");
}

function login() {
  const id = document.getElementById("loginId").value.trim();
  const usuarios = obterUsuarios();
  const user = usuarios.find(u => u.id === id);
  if (!user) return alert("ID incorreto!");
  localStorage.setItem("logado", JSON.stringify(user));
  mostrarPainel();
}

function logout() {
  localStorage.removeItem("logado");
  location.reload();
}

function showCadastro() {
  document.getElementById("loginContainer").classList.add("hidden");
  document.getElementById("cadastroContainer").classList.remove("hidden");
}

function showLogin() {
  document.getElementById("cadastroContainer").classList.add("hidden");
  document.getElementById("loginContainer").classList.remove("hidden");
}

function cadastrar() {
  const id = document.getElementById("cadastroId").value.trim();
  const nome = document.getElementById("cadastroNome").value.trim();
  const divisao = document.getElementById("cadastroDivisao").value;
  if (!id || !nome || !divisao) return alert("Preencha todos os campos!");

  const usuarios = obterUsuarios();
  if (usuarios.find(u => u.id === id)) return alert("ID já cadastrado!");

  const cargo = divisoes[divisao][0];
  usuarios.push({ id, nome, divisao, cargo });
  salvarUsuarios(usuarios);
  alert("Cadastro realizado!");
  showLogin();
}

function mostrarPainel() {
  document.getElementById("loginContainer").classList.add("hidden");
  document.getElementById("cadastroContainer").classList.add("hidden");
  document.getElementById("painelContainer").classList.remove("hidden");

  const user = JSON.parse(localStorage.getItem("logado"));
  document.getElementById("userInfo").textContent = `${user.nome} (${user.cargo} - ${user.divisao})`;
}

function mostrarRegistros() {
  const container = document.getElementById("registroContainer");
  container.classList.toggle("hidden");
  atualizarTabelaRegistros();
}

function atualizarTabelaRegistros() {
  const tabela = document.getElementById("tabelaRegistros");
  tabela.innerHTML = `
    <tr>
      <th>ID</th>
      <th>Nome</th>
      <th>Cargo</th>
      <th>Divisão</th>
      <th>Ações</th>
    </tr>
  `;
  const usuarios = obterUsuarios();
  const logado = JSON.parse(localStorage.getItem("logado"));

  usuarios.forEach(user => {
    const tr = document.createElement("tr");
    const podeGerenciar = verificarPermissao(logado, user);
    const botoes = podeGerenciar ? `
      ${!ehUltimoCargo(user) ? `<button onclick="promover('${user.id}')">Promover</button>` : ""}
      ${!ehPrimeiroCargo(user) ? `<button onclick="rebaixar('${user.id}')">Rebaixar</button>` : ""}
      <button onclick="exonerar('${user.id}')">Expulsar</button>
    ` : "";
    tr.innerHTML = `
      <td>${user.id}</td>
      <td>${user.nome}</td>
      <td>${user.cargo}</td>
      <td>${user.divisao}</td>
      <td>${botoes}</td>
    `;
    tabela.appendChild(tr);
  });
}

function verificarPermissao(logado, alvo) {
  const chefes = {
    "Chefe de Inteligência": "Inteligência e Investigações",
    "Coordenador de Operações Táticas": "Operações Táticas",
    "Comandante de Segurança": "Proteção Executiva"
  };

  const mesmaDivisao = logado.divisao === alvo.divisao;
  const ehChefe = chefes[logado.cargo] === alvo.divisao;
  const ehComando = logado.divisao === "Divisão Comando";
  const ehSuperior = especiais.includes(logado.cargo);

  return ehSuperior || (ehChefe && mesmaDivisao) || ehComando;
}

function ehUltimoCargo(user) {
  const lista = divisoes[user.divisao];
  return lista[lista.length - 1] === user.cargo;
}

function ehPrimeiroCargo(user) {
  const lista = divisoes[user.divisao];
  return lista[0] === user.cargo;
}

function promover(id) {
  const usuarios = obterUsuarios();
  const user = usuarios.find(u => u.id === id);
  const lista = divisoes[user.divisao];
  let index = lista.indexOf(user.cargo);

  if (index === lista.length - 1) {
    user.divisao = "Divisão Comando";
    user.cargo = divisoes["Divisão Comando"][0];
  } else {
    user.cargo = lista[index + 1];
  }

  salvarUsuarios(usuarios);
  atualizarTabelaRegistros();
}

function rebaixar(id) {
  const usuarios = obterUsuarios();
  const user = usuarios.find(u => u.id === id);
  const lista = divisoes[user.divisao];
  let index = lista.indexOf(user.cargo);

  if (index > 0) {
    user.cargo = lista[index - 1];
    salvarUsuarios(usuarios);
    atualizarTabelaRegistros();
  }
}

function exonerar(id) {
  let usuarios = obterUsuarios();
  usuarios = usuarios.filter(u => u.id !== id);
  salvarUsuarios(usuarios);
  atualizarTabelaRegistros();
}

// Banco Criminal
function mostrarBancoCriminais() {
  document.getElementById("bancoCriminaisContainer").classList.toggle("hidden");
}

function adicionarCriminal() {
  const nome = document.getElementById("nomeCriminal").value.trim();
  const rg = document.getElementById("rgCriminal").value.trim();
  const historico = document.getElementById("historicoCriminal").value.trim();
  const status = document.getElementById("statusCriminal").value;
  const foiPreso = document.getElementById("foiPreso").checked;

  if (!nome || !rg || !historico) return alert("Preencha todos os campos!");

  const criminais = JSON.parse(localStorage.getItem("criminais") || "[]");

  const total = (status === "Em liberdade" && foiPreso) ? contarPrisao(historico) : 0;

  criminais.push({ nome, rg, historico, status, foiPreso, total });
  localStorage.setItem("criminais", JSON.stringify(criminais));
  alert("Registro adicionado!");
}

function contarPrisao(historico) {
  return (historico.match(/preso/gi) || []).length;
}

function pesquisarCriminal() {
  const rg = document.getElementById("pesquisaRG").value.trim();
  const criminais = JSON.parse(localStorage.getItem("criminais") || "[]");
  const resultado = criminais.filter(c => c.rg === rg);

  const container = document.getElementById("resultadoPesquisa");
  container.innerHTML = "";

  if (resultado.length === 0) {
    container.innerHTML = "<p>Nenhum registro encontrado.</p>";
  } else {
    const tabela = document.createElement("table");
    tabela.innerHTML = `
      <tr>
        <th>Nome</th>
        <th>RG</th>
        <th>Status</th>
        <th>Total Prisões</th>
        <th>Histórico</th>
      </tr>
    `;

    resultado.forEach(r => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${r.nome}</td>
        <td>${r.rg}</td>
        <td>${r.status}</td>
        <td>${r.total}</td>
        <td>${r.historico}</td>
      `;
      tabela.appendChild(tr);
    });

    container.appendChild(tabela);
  }

  container.classList.remove("hidden");
}

// Auto login
if (localStorage.getItem("logado")) {
  mostrarPainel();
}
</script>


</body>
</html>
