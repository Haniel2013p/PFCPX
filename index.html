<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Painel Serviço Secreto Municipal</title>
<style>
  body { font-family: Arial, sans-serif; background: #222; color: #eee; margin: 0; padding: 0; }
  #login, #painel, #registros, #banco-criminal { max-width: 700px; margin: 30px auto; background: #333; padding: 20px; border-radius: 8px; display: none; }
  input, select, button { padding: 8px; margin: 6px 0; width: 100%; border-radius: 4px; border: none; }
  button { background: #0a74da; color: white; cursor: pointer; }
  button:hover { background: #065aab; }
  #menu { display: flex; justify-content: space-between; margin-bottom: 20px; }
  #menu button { width: auto; padding: 10px 20px; margin: 0 5px; }
  table { width: 100%; border-collapse: collapse; margin-top: 10px; }
  th, td { border: 1px solid #555; padding: 8px; text-align: left; }
  th { background: #444; }
  .hidden { display: none; }
</style>
</head>
<body>

<div id="login">
  <h2>Login - Serviço Secreto Municipal</h2>
  <input id="inputUsuario" type="text" placeholder="Usuário" autocomplete="off" />
  <input id="inputSenha" type="password" placeholder="Senha" autocomplete="off" />
  <button id="btnLogin">Entrar</button>
  <p id="msgLogin" style="color:#f44;"></p>
</div>

<div id="painel">
  <div id="menu">
    <button id="btnLista">Lista de registros</button>
    <button id="btnBancoCriminal">Banco criminais</button>
    <button id="btnLogout" style="background:#b22222;">Sair</button>
  </div>
  <div id="explicacao" style="text-align:center; margin-bottom: 20px;">
    <p>Bem-vindo ao Painel do Serviço Secreto Municipal. Aqui você pode gerenciar membros, registros criminais e controlar cargos.</p>
  </div>
</div>

<div id="registros">
  <h3>Lista de registros</h3>
  <table>
    <thead><tr><th>ID</th><th>Nome</th><th>Cargo</th><th>Ações</th></tr></thead>
    <tbody id="tabelaRegistros"></tbody>
  </table>
  <button id="btnVoltarRegistros">Voltar</button>
</div>

<div id="banco-criminal">
  <h3>Banco de Registros Criminais</h3>
  <input id="inputPesquisarRG" placeholder="Pesquisar por RG..." autocomplete="off" />
  <br />
  <input id="inputNomeCriminal" placeholder="Nome" autocomplete="off" />
  <input id="inputRGCriminal" placeholder="RG" autocomplete="off" />
  <textarea id="inputHistorico" placeholder="Histórico" rows="3"></textarea>
  <select id="selectStatus">
    <option value="Em investigação">Em investigação</option>
    <option value="Processo penal em andamento">Processo penal em andamento</option>
    <option value="Fugitivo">Fugitivo</option>
    <option value="Em liberdade">Em liberdade</option>
  </select>
  <button id="btnAdicionarCriminal">Adicionar</button>
  <button id="btnPesquisarCriminal">Pesquisar</button>
  <button id="btnVoltarBanco">Voltar</button>

  <h4>Resultados:</h4>
  <table>
    <thead><tr><th>Nome</th><th>RG</th><th>Histórico</th><th>Total de Prisões</th><th>Status</th></tr></thead>
    <tbody id="tabelaCriminais"></tbody>
  </table>
</div>

<script>
// Cargos na ordem crescente (0 = Estagiário, 8 = Administrador)
const cargos = [
  "Estagiário",
  "Agente",
  "Investigador",
  "Detetive",
  "Chefe de Seção",
  "Diretor",
  "VSSP",
  "SSP",
  "Administrador"
];

// Usuários com cargos e senhas (id, nome, senha, cargo)
const usuarios = [
  { id: 200, nome: "Administrador", senha: "Haniel", cargo: "Administrador" },
  { id: 1, nome: "Fulano", senha: "123", cargo: "Estagiário" },
  { id: 2, nome: "Ciclano", senha: "abc", cargo: "Agente" }
  // você pode adicionar outros aqui
];

// Variável que guarda o usuário logado
let usuarioLogado = null;

// Dados dos membros (igual usuarios para a lista)
let membros = [...usuarios];

// Banco de dados criminais
let bancoCriminal = JSON.parse(localStorage.getItem('bancoCriminal') || '[]');

// Webhook para logs Discord (exemplo)
const webhookURL = 'https://discord.com/api/webhooks/1390011117778112723/KWkdPpdOmtRkgLlUH7QLUwx3sqxnHX-qhA0EkZFwjRiMPTJL8bLmbL1l3P-LZWRJBKeb';

// Função para log no webhook Discord (fetch POST)
function enviarLogDiscord(mensagem) {
  fetch(webhookURL, {
    method: 'POST',
    headers: {'Content-Type': 'application/json'},
    body: JSON.stringify({content: mensagem})
  });
}

// Mostrar e esconder telas
function mostrarTela(id) {
  ['login','painel','registros','banco-criminal'].forEach(div => {
    document.getElementById(div).style.display = (div === id) ? 'block' : 'none';
  });
}

// Login
document.getElementById('btnLogin').addEventListener('click', () => {
  const user = document.getElementById('inputUsuario').value.trim();
  const pass = document.getElementById('inputSenha').value;
  const encontrado = usuarios.find(u => u.nome.toLowerCase() === user.toLowerCase() && u.senha === pass);
  const msg = document.getElementById('msgLogin');

  if(encontrado) {
    usuarioLogado = encontrado;
    msg.textContent = '';
    document.getElementById('inputUsuario').value = '';
    document.getElementById('inputSenha').value = '';
    carregarPainel();
  } else {
    msg.textContent = 'Usuário ou senha incorretos.';
  }
});

function carregarPainel() {
  mostrarTela('painel');
  carregarListaRegistros();
}

// Lista de registros
document.getElementById('btnLista').addEventListener('click', () => {
  mostrarTela('registros');
  carregarListaRegistros();
});
document.getElementById('btnVoltarRegistros').addEventListener('click', () => {
  mostrarTela('painel');
});

// Banco Criminal
document.getElementById('btnBancoCriminal').addEventListener('click', () => {
  mostrarTela('banco-criminal');
  limparFormularioCriminal();
  carregarTabelaCriminal(bancoCriminal);
});
document.getElementById('btnVoltarBanco').addEventListener('click', () => {
  mostrarTela('painel');
});

// Logout
document.getElementById('btnLogout').addEventListener('click', () => {
  usuarioLogado = null;
  mostrarTela('login');
});

// Carrega tabela registros com ações promover, rebaixar, expulsar
function carregarListaRegistros() {
  const tbody = document.getElementById('tabelaRegistros');
  tbody.innerHTML = '';

  membros.forEach(user => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${user.id}</td>
      <td>${user.nome}</td>
      <td>${user.cargo}</td>
      <td>
        ${podePromover(usuarioLogado, user) ? `<button data-id="${user.id}" class="btnPromover">Promover</button>` : ''}
        ${podeRebaixar(usuarioLogado, user) ? `<button data-id="${user.id}" class="btnRebaixar">Rebaixar</button>` : ''}
        ${podeExpulsar(usuarioLogado, user) ? `<button data-id="${user.id}" class="btnExpulsar" style="background:#b22222;">Expulsar</button>` : ''}
      </td>
    `;
    tbody.appendChild(tr);
  });

  // Eventos dos botões
  document.querySelectorAll('.btnPromover').forEach(btn => {
    btn.addEventListener('click', () => {
      const id = parseInt(btn.getAttribute('data-id'));
      promoverMembro(id);
    });
  });
  document.querySelectorAll('.btnRebaixar').forEach(btn => {
    btn.addEventListener('click', () => {
      const id = parseInt(btn.getAttribute('data-id'));
      rebaixarMembro(id);
    });
  });
  document.querySelectorAll('.btnExpulsar').forEach(btn => {
    btn.addEventListener('click', () => {
      const id = parseInt(btn.getAttribute('data-id'));
      expulsarMembro(id);
    });
  });
}

// Funções de permissão (cargo maior pode agir em menor)
function cargoIndex(nomeCargo) {
  return cargos.indexOf(nomeCargo);
}
function podePromover(quemPromove, quemRecebe) {
  if(!quemPromove) return false;
  return cargoIndex(quemPromove.cargo) > cargoIndex(quemRecebe.cargo) && cargoIndex(quemRecebe.cargo) < cargos.length - 1;
}
function podeRebaixar(quemRebaixa, quemRecebe) {
  if(!quemRebaixa) return false;
  return cargoIndex(quemRebaixa.cargo) > cargoIndex(quemRecebe.cargo) && cargoIndex(quemRecebe.cargo) > 0;
}
function podeExpulsar(quemExpulsa, quemRecebe) {
  if(!quemExpulsa) return false;
  return cargoIndex(quemExpulsa.cargo) > cargoIndex(quemRecebe.cargo);
}

// Promover
function promoverMembro(id) {
  const user = membros.find(m => m.id === id);
  if(!user) return alert("Membro não encontrado");
  if(!podePromover(usuarioLogado, user)) return alert("Você não pode promover este membro");

  let idx = cargoIndex(user.cargo);
  if(idx < cargos.length - 1) {
    user.cargo = cargos[idx+1];
    carregarListaRegistros();
    alert(`${user.nome} foi promovido para ${user.cargo}`);
    enviarLogDiscord(`**PROMOÇÃO**: ${usuarioLogado.nome} promoveu ${user.nome} para ${user.cargo}`);
  }
}

// Rebaixar
function rebaixarMembro(id) {
  const user = membros.find(m => m.id === id);
  if(!user) return alert("Membro não encontrado");
  if(!podeRebaixar(usuarioLogado, user)) return alert("Você não pode rebaixar este membro");

  let idx = cargoIndex(user.cargo);
  if(idx > 0) {
    user.cargo = cargos[idx-1];
    carregarListaRegistros();
    alert(`${user.nome} foi rebaixado para ${user.cargo}`);
    enviarLogDiscord(`**REBAIXAMENTO**: ${usuarioLogado.nome} rebaixou ${user.nome} para ${user.cargo}`);
  }
}

// Expulsar
function expulsarMembro(id) {
  const userIndex = membros.findIndex(m => m.id === id);
  if(userIndex === -1) return alert("Membro não encontrado");
  const user = membros[userIndex];
  if(!podeExpulsar(usuarioLogado, user)) return alert("Você não pode expulsar este membro");
  if(user.id === usuarioLogado.id) return alert("Você não pode expulsar você mesmo");

  if(confirm(`Tem certeza que deseja expulsar ${user.nome}?`)) {
    membros.splice(userIndex,1);
    carregarListaRegistros();
    alert(`${user.nome} foi expulso.`);
    enviarLogDiscord(`**EXPULSÃO**: ${usuarioLogado.nome} expulsou ${user.nome}`);
  }
}

// Banco Criminal funções
function limparFormularioCriminal() {
  document.getElementById('inputNomeCriminal').value = '';
  document.getElementById('inputRGCriminal').value = '';
  document.getElementById('inputHistorico').value = '';
  document.getElementById('selectStatus').value = 'Em investigação';
  document.getElementById('inputPesquisarRG').value = '';
}

function carregarTabelaCriminal(lista) {
  const tbody = document.getElementById('tabelaCriminais');
  tbody.innerHTML = '';
  lista.forEach(item => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${item.nome}</td>
      <td>${item.rg}</td>
      <td>${item.historico}</td>
      <td>${item.totalPrisao}</td>
      <td>${item.status}</td>
    `;
    tbody.appendChild(tr);
  });
}

document.getElementById('btnAdicionarCriminal').addEventListener('click', () => {
  if(!usuarioLogado) {
    alert('Você precisa estar logado para adicionar registros criminais.');
    return;
  }
  const nome = document.getElementById('inputNomeCriminal').value.trim();
  const rg = document.getElementById('inputRGCriminal').value.trim();
  const historico = document.getElementById('inputHistorico').value.trim();
  const status = document.getElementById('selectStatus').value;

  if(!nome || !rg || !historico) {
    alert('Preencha todos os campos.');
    return;
  }

  // Verifica se RG já existe para atualizar prisões e histórico
  let registroExistente = bancoCriminal.find(item => item.rg === rg);

  if(registroExistente) {
    registroExistente.totalPrisao++;
    registroExistente.historico += `\n${historico}`;
    registroExistente.status = status;
  } else {
    bancoCriminal.push({
      nome,
      rg,
      historico,
      totalPrisao: 1,
      status
    });
  }

  localStorage.setItem('bancoCriminal', JSON.stringify(bancoCriminal));
  carregarTabelaCriminal(bancoCriminal);
  limparFormularioCriminal();
  alert('Registro criminal adicionado/atualizado com sucesso!');
});

document.getElementById('btnPesquisarCriminal').addEventListener('click', () => {
  const rgPesquisa = document.getElementById('inputPesquisarRG').value.trim();
  if(!rgPesquisa) {
    carregarTabelaCriminal(bancoCriminal);
    return;
  }
  const resultados = bancoCriminal.filter(item => item.rg.includes(rgPesquisa));
  carregarTabelaCriminal(resultados);
});

// Iniciar página mostrando login
mostrarTela('login');
</script>

</body>
</html>
