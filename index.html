<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Painel Serviço Secreto Municipal</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0; padding: 0;
    background: #222;
    color: #eee;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    min-height: 100vh;
  }
  #container {
    background: #333;
    width: 400px;
    margin: 20px;
    border-radius: 8px;
    box-shadow: 0 0 15px #000;
    padding: 20px 30px 30px 30px;
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  h1 {
    text-align: center;
    margin-bottom: 20px;
    color: #aaf;
  }
  input[type=text], input[type=password], select {
    width: 100%;
    padding: 8px 6px;
    margin: 6px 0 12px 0;
    border: none;
    border-radius: 4px;
    font-size: 1rem;
  }
  button {
    background: none;
    color: white;
    border: none;
    font-weight: normal;
    cursor: pointer;
    font-size: 0.9rem;
    padding: 6px 12px;
    margin-right: 8px;
    border-radius: 4px;
    transition: background 0.25s;
    min-width: 80px;
    height: 32px;
  }
  button:hover:not(:disabled) {
    background: #4477dd;
  }
  button:disabled {
    background: #444;
    cursor: default;
  }
  #menuTopo {
    position: absolute;
    top: 20px;
    left: 20px;
    display: flex;
    gap: 8px;
  }
  #menuTopo button {
    background: #5588ee;
  }
  #menuTopo button#btnLogout {
    background: #d44;
  }
  #usuarioInfo {
    position: absolute;
    top: 20px;
    right: 20px;
    text-align: right;
    font-size: 0.9rem;
    line-height: 1.3;
    white-space: pre-line;
    user-select: none;
  }
  #sobre-ss, #lista-registros, #painel-pesquisa {
    margin-top: 60px;
    width: 100%;
    max-width: 360px;
    text-align: center;
  }
  #sobre-ss p {
    margin: 0 15px 0 15px;
    font-size: 1rem;
  }
  #lista-registros {
    max-height: 200px;
    overflow-y: auto;
    background: #444;
    padding: 10px;
    border-radius: 6px;
    margin-bottom: 20px;
  }
  #lista-registros table {
    width: 100%;
    border-collapse: collapse;
  }
  #lista-registros th, #lista-registros td {
    border: 1px solid #666;
    padding: 6px 4px;
    font-size: 0.9rem;
  }
  #painel-pesquisa {
    margin-top: 0;
  }
  #painel-pesquisa input[type=text] {
    width: 70%;
    display: inline-block;
    margin-right: 6px;
  }
  #painel-pesquisa button {
    width: 25%;
    padding: 6px;
    font-size: 0.9rem;
    min-width: auto;
    margin-right: 0;
  }
  #resultado {
    background: #444;
    padding: 15px;
    border-radius: 6px;
    margin-top: 15px;
    text-align: left;
  }
  #resultado p {
    margin: 6px 0;
    font-size: 1rem;
  }
  #resultado button {
    margin: 4px 6px 0 0;
    padding: 6px 14px;
    font-size: 0.9rem;
    border-radius: 4px;
    min-width: auto;
  }
  #resultado button#btnExpulsar {
    background: #d44;
    color: white;
  }
  #login, #novo-jogador {
    width: 100%;
    max-width: 360px;
    margin-top: 40px;
  }
  .link-btn {
    background: none;
    border: none;
    color: #88aaff;
    cursor: pointer;
    padding: 0;
    font-size: 0.9rem;
    text-decoration: underline;
    margin-top: 10px;
  }
  .link-btn:hover {
    color: #bbd;
  }
</style>
</head>
<body>
  <div id="container">
    <h1>Serviço Secreto Municipal</h1>

    <!-- Menu topo (botões) -->
    <div id="menuTopo" style="display:none;">
      <button id="btnSobre">Sobre o Serviço Secreto</button>
      <button id="btnListaRegistros">Lista de registros</button>
      <button id="btnPainel">Painel de controle</button>
      <button id="btnLogout">Sair</button>
    </div>

    <!-- Usuário logado info canto superior direito -->
    <div id="usuarioInfo" style="display:none;"></div>

    <!-- Login -->
    <div id="login">
      <input type="text" id="loginID" placeholder="Digite seu ID" autocomplete="off" />
      <input type="password" id="loginSenha" placeholder="Digite sua senha" autocomplete="off" />
      <button id="btnLogin">Entrar</button>
      <button class="link-btn" id="btnToggleCadastro">Cadastrar novo membro</button>
    </div>

    <!-- Cadastro -->
    <div id="novo-jogador" style="display:none;">
      <input type="text" id="novoID" placeholder="Novo ID (único)" autocomplete="off" />
      <input type="text" id="novoNome" placeholder="Nome completo" autocomplete="off" />
      <input type="password" id="novaSenha" placeholder="Senha" autocomplete="off" />
      <button id="btnCadastrar">Cadastrar</button>
      <button class="link-btn" id="btnVoltarLogin">Voltar ao login</button>
    </div>

    <!-- Área logado -->
    <div id="painel" style="display:none; width: 100%; max-width: 360px;">
      <!-- Texto explicativo sobre o Serviço Secreto -->
      <div id="sobre-ss" style="display:none;">
        <p>Bem-vindo ao Serviço Secreto Municipal, onde protegemos a integridade da prefeitura e a segurança dos cidadãos. Aqui você pode pesquisar membros, promover, rebaixar ou expulsar agentes com base nas necessidades da equipe.</p>
      </div>

      <!-- Lista de registros -->
      <div id="lista-registros" style="display:none;">
        <table>
          <thead><tr><th>ID</th><th>Nome</th><th>Cargo</th></tr></thead>
          <tbody id="listaTabela"></tbody>
        </table>
      </div>

      <!-- Painel de pesquisa e ações -->
      <div id="painel-pesquisa" style="display:none;">
        <input type="text" id="inputID" placeholder="Digite ID do agente" autocomplete="off" />
        <button id="btnPesquisar">Pesquisar</button>

        <div id="resultado" style="display:none;">
          <p><strong>Nome:</strong> <span id="nome"></span></p>
          <p><strong>Cargo:</strong> <span id="cargo"></span></p>
          <button id="btnPromover">Promover</button>
          <button id="btnRebaixar">Rebaixar</button>
          <button id="btnExpulsar">Expulsar</button>
        </div>
      </div>
    </div>
  </div>

<script>
  const webhookURL = "https://discord.com/api/webhooks/1390011117778112723/KWkdPpdOmtRkgLlUH7QLUwx3sqxnHX-qhA0EkZFwjRiMPTJL8bLmbL1l3P-LZWRJBKeb";

  // Cargos em ordem crescente
  const cargos = [
    "Estagiário",
    "Agente",
    "Investigador",
    "Detetive",
    "Chefe de Seção",
    "Diretor",
    "VSSP",
    "SSP"
  ];

  // Cria ou reseta o banco de jogadores com o usuário solicitado
  let jogadores = {
    "5": {
      nome: "Gabriel",
      senha: "VSSP-HANIEL",
      cargo: "VSSP"
    }
  };
  salvarLocalStorage();

  let idAtual = null;       // ID do usuário logado
  let idSelecionado = null; // ID selecionado na pesquisa

  // Referências DOM
  const loginDiv = document.getElementById('login');
  const cadastroDiv = document.getElementById('novo-jogador');
  const painelDiv = document.getElementById('painel');
  const menuTopo = document.getElementById('menuTopo');
  const usuarioInfo = document.getElementById('usuarioInfo');

  const btnLogin = document.getElementById('btnLogin');
  const btnCadastrar = document.getElementById('btnCadastrar');
  const btnToggleCadastro = document.getElementById('btnToggleCadastro');
  const btnVoltarLogin = document.getElementById('btnVoltarLogin');
  const btnLogout = document.getElementById('btnLogout');

  const btnSobre = document.getElementById('btnSobre');
  const btnListaRegistros = document.getElementById('btnListaRegistros');
  const btnPainel = document.getElementById('btnPainel');

  const sobreSS = document.getElementById('sobre-ss');
  const listaRegistros = document.getElementById('lista-registros');
  const painelPesquisa = document.getElementById('painel-pesquisa');

  const listaTabela = document.getElementById('listaTabela');

  const inputID = document.getElementById('inputID');
  const btnPesquisar = document.getElementById('btnPesquisar');

  const resultado = document.getElementById('resultado');
  const nomeSpan = document.getElementById('nome');
  const cargoSpan = document.getElementById('cargo');

  const btnPromover = document.getElementById('btnPromover');
  const btnRebaixar = document.getElementById('btnRebaixar');
  const btnExpulsar = document.getElementById('btnExpulsar');

  // Salvar no localStorage
  function salvarLocalStorage() {
    localStorage.setItem('jogadoresSSM', JSON.stringify(jogadores));
  }

  // Carregar do localStorage
  function carregarLocalStorage() {
    const dados = localStorage.getItem('jogadoresSSM');
    if (dados) {
      jogadores = JSON.parse(dados);
    }
  }

  carregarLocalStorage();

  // Atualiza o texto com dados do usuário logado
  function atualizarUsuarioInfo() {
    if (!idAtual || !jogadores[idAtual]) return;
    usuarioInfo.style.display = 'block';
    usuarioInfo.textContent = `ID: ${idAtual}\nNome: ${jogadores[idAtual].nome}\nCargo: ${jogadores[idAtual].cargo}`;
  }

  // Mostrar seção só uma vez
  function mostrarSecao(secao) {
    sobreSS.style.display = 'none';
    listaRegistros.style.display = 'none';
    painelPesquisa.style.display = 'none';

    secao.style.display = 'block';
  }

  // Mostrar menu topo
  function mostrarMenu() {
    menuTopo.style.display = 'flex';
  }

  // Esconder menu topo
  function esconderMenu() {
    menuTopo.style.display = 'none';
    usuarioInfo.style.display = 'none';
  }

  // Limpar campos de login
  function limparLogin() {
    document.getElementById('loginID').value = '';
    document.getElementById('loginSenha').value = '';
  }

  // Limpar campos cadastro
  function limparCadastro() {
    document.getElementById('novoID').value = '';
    document.getElementById('novoNome').value = '';
    document.getElementById('novaSenha').value = '';
  }

  // Atualizar tabela de registros
  function atualizarTabela() {
    listaTabela.innerHTML = '';
    for (const id in jogadores) {
      const tr = document.createElement('tr');
      const tdID = document.createElement('td');
      const tdNome = document.createElement('td');
      const tdCargo = document.createElement('td');
      tdID.textContent = id;
      tdNome.textContent = jogadores[id].nome;
      tdCargo.textContent = jogadores[id].cargo;
      tr.appendChild(tdID);
      tr.appendChild(tdNome);
      tr.appendChild(tdCargo);
      listaTabela.appendChild(tr);
    }
  }

  // Função para enviar logs ao webhook
  async function enviarLog(acao, alvoID) {
    if (!idAtual || !jogadores[idAtual]) return;
    const nomeUsuario = jogadores[idAtual].nome;
    const cargoUsuario = jogadores[idAtual].cargo;
    const nomeAlvo = jogadores[alvoID] ? jogadores[alvoID].nome : "Desconhecido";
    const cargoAlvo = jogadores[alvoID] ? jogadores[alvoID].cargo : "Desconhecido";

    const conteudo = {
      content: `**${acao}**\nUsuário: ${nomeUsuario} (${idAtual}, ${cargoUsuario})\nAlvo: ${nomeAlvo} (${alvoID}, ${cargoAlvo})`
    };

    try {
      await fetch(webhookURL, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify(conteudo)
      });
    } catch (err) {
      console.error("Erro ao enviar log:", err);
    }
  }

  // Login
  btnLogin.onclick = () => {
    const id = document.getElementById('loginID').value.trim();
    const senha = document.getElementById('loginSenha').value.trim();
    if (!id || !senha) {
      alert("Preencha ID e senha.");
      return;
    }
    if (!jogadores[id]) {
      alert("ID não encontrado.");
      return;
    }
    if (jogadores[id].senha !== senha) {
      alert("Senha incorreta.");
      return;
    }
    idAtual = id;
    limparLogin();
    loginDiv.style.display = 'none';
    cadastroDiv.style.display = 'none';
    painelDiv.style.display = 'block';
    mostrarMenu();
    mostrarSecao(sobreSS);
    atualizarUsuarioInfo();
  };

  // Logout
  btnLogout.onclick = () => {
    idAtual = null;
    idSelecionado = null;
    loginDiv.style.display = 'block';
    cadastroDiv.style.display = 'none';
    painelDiv.style.display = 'none';
    esconderMenu();
    resultado.style.display = 'none';
  };

  // Toggle para cadastro
  btnToggleCadastro.onclick = () => {
    loginDiv.style.display = 'none';
    cadastroDiv.style.display = 'block';
  };
  btnVoltarLogin.onclick = () => {
    cadastroDiv.style.display = 'none';
    loginDiv.style.display = 'block';
  };

  // Cadastro
  btnCadastrar.onclick = () => {
    const id = document.getElementById('novoID').value.trim();
    const nome = document.getElementById('novoNome').value.trim();
    const senha = document.getElementById('novaSenha').value.trim();

    if (!id || !nome || !senha) {
      alert("Preencha todos os campos.");
      return;
    }
    if (jogadores[id]) {
      alert("ID já cadastrado.");
      return;
    }
    jogadores[id] = { nome, senha, cargo: "Estagiário" };
    salvarLocalStorage();
    alert("Cadastro realizado! Você já pode logar.");
    limparCadastro();
    cadastroDiv.style.display = 'none';
    loginDiv.style.display = 'block';
  };

  // Botões do menu topo
  btnSobre.onclick = () => mostrarSecao(sobreSS);
  btnListaRegistros.onclick = () => {
    atualizarTabela();
    mostrarSecao(listaRegistros);
  };
  btnPainel.onclick = () => mostrarSecao(painelPesquisa);

  // Pesquisa
  btnPesquisar.onclick = () => {
    const id = inputID.value.trim();
    if (!id) {
      alert("Digite um ID para pesquisar.");
      return;
    }
    if (!jogadores[id]) {
      alert("ID não encontrado.");
      resultado.style.display = 'none';
      return;
    }
    idSelecionado = id;
    nomeSpan.textContent = jogadores[id].nome;
    cargoSpan.textContent = jogadores[id].cargo;
    resultado.style.display = 'block';
  };

  // Verifica se atual usuário pode modificar outro (não pode mexer com iguais ou superiores)
  function podeModificar(alvoCargo) {
    if (!idAtual) return false;
    const cargoAtual = jogadores[idAtual].cargo;
    return cargos.indexOf(cargoAtual) > cargos.indexOf(alvoCargo);
  }

  // Promoção
  btnPromover.onclick = () => {
    if (!idSelecionado) return;
    const alvo = jogadores[idSelecionado];
    if (!podeModificar(alvo.cargo)) {
      alert("Você não pode promover este usuário.");
      return;
    }
    const idx = cargos.indexOf(alvo.cargo);
    if (idx < cargos.length - 1) {
      alvo.cargo = cargos[idx + 1];
      salvarLocalStorage();
      cargoSpan.textContent = alvo.cargo;
      enviarLog("Promoção", idSelecionado);
      alert(`Usuário promovido para ${alvo.cargo}`);
    } else {
      alert("Usuário já está no cargo máximo.");
    }
  };

  // Rebaixamento
  btnRebaixar.onclick = () => {
    if (!idSelecionado) return;
    const alvo = jogadores[idSelecionado];
    if (!podeModificar(alvo.cargo)) {
      alert("Você não pode rebaixar este usuário.");
      return;
    }
    const idx = cargos.indexOf(alvo.cargo);
    if (idx > 0) {
      alvo.cargo = cargos[idx - 1];
      salvarLocalStorage();
      cargoSpan.textContent = alvo.cargo;
      enviarLog("Rebaixamento", idSelecionado);
      alert(`Usuário rebaixado para ${alvo.cargo}`);
    } else {
      alert("Usuário já está no cargo mínimo.");
    }
  };

  // Expulsar
  btnExpulsar.onclick = () => {
    if (!idSelecionado) return;
    if (!podeModificar(jogadores[idSelecionado].cargo)) {
      alert("Você não pode expulsar este usuário.");
      return;
    }
    if (!confirm(`Confirma expulsar ${jogadores[idSelecionado].nome}?`)) return;
    enviarLog("Expulsão", idSelecionado);
    delete jogadores[idSelecionado];
    salvarLocalStorage();
    alert("Usuário expulso.");
    resultado.style.display = 'none';
    idSelecionado = null;
  };

</script>
</body>
</html>


