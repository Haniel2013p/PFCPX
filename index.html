<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Painel Serviço Secreto Municipal</title>
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background-color: black;
      color: white;
      text-align: center;
    }
    .hidden { display: none; }
    .container {
      padding: 20px;
    }
    input, select, button {
      padding: 10px;
      margin: 5px;
      border-radius: 5px;
    }
    button {
      background-color: #007BFF;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background-color: #0056b3;
    }
    table {
      width: 100%;
      margin-top: 20px;
      border-collapse: collapse;
    }
    th, td {
      border: 1px solid #fff;
      padding: 10px;
    }
    .button-group button {
      margin: 0 3px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div id="loginArea">
      <h2>Login</h2>
      <input type="number" id="loginId" placeholder="ID"><br>
      <input type="password" id="loginSenha" placeholder="Senha"><br>
      <button onclick="logar()">Entrar</button>
      <p>Não tem conta? <a href="#" onclick="mostrarCadastro()">Cadastre-se</a></p>
    </div>

    <div id="cadastroArea" class="hidden">
      <h2>Cadastro</h2>
      <input type="text" id="cadNome" placeholder="Nome"><br>
      <input type="number" id="cadId" placeholder="ID"><br>
      <input type="password" id="cadSenha" placeholder="Senha"><br>
      <select id="cadDivisao">
        <option value="">Selecione a Divisão</option>
        <option value="Inteligência e Investigações">Inteligência e Investigações</option>
        <option value="Operações Táticas">Operações Táticas</option>
        <option value="Proteção Executiva">Proteção Executiva</option>
      </select><br>
      <button onclick="cadastrar()">Cadastrar</button>
      <button onclick="voltarLogin()">Voltar</button>
    </div>

    <div id="painelArea" class="hidden">
      <h2 id="boasVindas"></h2>
      <p id="textoExplicativo">Você está no Painel do Serviço Secreto Municipal. Use com responsabilidade.</p>
      <button onclick="mostrarListaRegistros()">Lista de registros</button>
      <button onclick="logout()">Sair</button>
    </div>

    <div id="listaRegistrosArea" class="hidden">
      <h2>Lista de Registros</h2>
      <button onclick="voltarPainel()">Voltar</button>
      <table id="tabelaRegistros">
        <thead>
          <tr>
            <th>Nome</th>
            <th>ID</th>
            <th>Divisão</th>
            <th>Cargo</th>
            <th>Ações</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>

  <script>
    const divisoes = {
      "Inteligência e Investigações": ["Estagiário", "Investigador Operacional", "Agente de Inteligência", "Agente Especializado", "Inspetor", "Inspetor Chefe", "Chefe de Inteligência"],
      "Operações Táticas": ["Agente de Operações Especiais", "Agente de Intervenção", "Capitão", "Coordenador de Operações Táticas"],
      "Proteção Executiva": ["Agente de Segurança Municipal", "Agente de Proteção Avançada", "Sub Comandante de Segurança", "Comandante de Segurança"],
      "Divisão Comando": ["Inspetor Geral", "Chefe de Operações", "Sub Diretor do Serviço Secreto", "Diretor do Serviço Secreto"]
    };
    const especiais = ["VSSP", "SSP", "ADMINISTRADOR"];

    let usuarioLogado = null;

    function salvarUsuarios(usuarios) {
      localStorage.setItem("usuariosSSP", JSON.stringify(usuarios));
    }

    function obterUsuarios() {
      return JSON.parse(localStorage.getItem("usuariosSSP")) || [];
    }

    function cadastrar() {
      const nome = document.getElementById("cadNome").value;
      const id = parseInt(document.getElementById("cadId").value);
      const senha = document.getElementById("cadSenha").value;
      const divisao = document.getElementById("cadDivisao").value;

      if (!nome || !id || !senha || !divisao) return alert("Preencha todos os campos!");

      const usuarios = obterUsuarios();
      if (usuarios.find(u => u.id === id)) return alert("ID já cadastrado.");

      let cargo = divisoes[divisao][0];
      if (id === 200) cargo = "ADMINISTRADOR";

      usuarios.push({ nome, id, senha, divisao, cargo });
      salvarUsuarios(usuarios);
      alert("Cadastro realizado com sucesso!");
      voltarLogin();
    }

    function mostrarCadastro() {
      document.getElementById("loginArea").classList.add("hidden");
      document.getElementById("cadastroArea").classList.remove("hidden");
    }

    function voltarLogin() {
      document.getElementById("cadastroArea").classList.add("hidden");
      document.getElementById("loginArea").classList.remove("hidden");
    }

    function logar() {
      const id = parseInt(document.getElementById("loginId").value);
      const senha = document.getElementById("loginSenha").value;
      const usuarios = obterUsuarios();
      const user = usuarios.find(u => u.id === id && u.senha === senha);
      if (!user) return alert("ID ou senha inválidos.");

      usuarioLogado = user;
      document.getElementById("loginArea").classList.add("hidden");
      document.getElementById("painelArea").classList.remove("hidden");
      document.getElementById("boasVindas").innerText = `Bem-vindo, ${user.nome}`;
    }

    function logout() {
      usuarioLogado = null;
      document.getElementById("painelArea").classList.add("hidden");
      document.getElementById("loginArea").classList.remove("hidden");
    }

    function voltarPainel() {
      document.getElementById("listaRegistrosArea").classList.add("hidden");
      document.getElementById("painelArea").classList.remove("hidden");
    }

    function mostrarListaRegistros() {
      if (!usuarioLogado) return;
      document.getElementById("painelArea").classList.add("hidden");
      document.getElementById("listaRegistrosArea").classList.remove("hidden");
      const usuarios = obterUsuarios();
      const tbody = document.querySelector("#tabelaRegistros tbody");
      tbody.innerHTML = "";
      usuarios.forEach(u => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${u.nome}</td>
          <td>${u.id}</td>
          <td>${u.divisao || '-'}</td>
          <td>${u.cargo}</td>
          <td class="button-group">
            ${u.id !== usuarioLogado.id ? `
              <button onclick="promover(${u.id})">Promover</button>
              <button onclick="rebaixar(${u.id})">Rebaixar</button>
              <button onclick="expulsar(${u.id})">Expulsar</button>
            ` : ''}
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    function promover(id) {
      const usuarios = obterUsuarios();
      const index = usuarios.findIndex(u => u.id === id);
      const user = usuarios[index];
      if (!user || !usuarioLogado) return;
      if (usuarioLogado.id === id) return alert("Você não pode se promover!");
      if (especiais.includes(user.cargo)) return alert("Não é possível alterar esse cargo.");
      if (especiais.includes(usuarioLogado.cargo) || usuarioLogado.cargo === "Diretor do Serviço Secreto") {
        const cargos = divisoes[user.divisao] || divisoes["Divisão Comando"];
        const pos = cargos.indexOf(user.cargo);
        if (pos < cargos.length - 1) {
          user.cargo = cargos[pos + 1];
        } else if (user.divisao !== "Divisão Comando") {
          user.divisao = "Divisão Comando";
          user.cargo = divisoes["Divisão Comando"][0];
        }
        usuarios[index] = user;
        salvarUsuarios(usuarios);
        mostrarListaRegistros();
      } else {
        alert("Você não tem permissão para promover este usuário.");
      }
    }

    function rebaixar(id) {
      const usuarios = obterUsuarios();
      const index = usuarios.findIndex(u => u.id === id);
      const user = usuarios[index];
      if (!user || !usuarioLogado) return;
      if (usuarioLogado.id === id) return alert("Você não pode se rebaixar!");
      if (especiais.includes(user.cargo)) return alert("Não é possível alterar esse cargo.");
      if (especiais.includes(usuarioLogado.cargo) || usuarioLogado.cargo === "Diretor do Serviço Secreto") {
        const cargos = divisoes[user.divisao] || divisoes["Divisão Comando"];
        const pos = cargos.indexOf(user.cargo);
        if (pos > 0) {
          user.cargo = cargos[pos - 1];
        }
        usuarios[index] = user;
        salvarUsuarios(usuarios);
        mostrarListaRegistros();
      } else {
        alert("Você não tem permissão para rebaixar este usuário.");
      }
    }

    function expulsar(id) {
      if (!confirm("Tem certeza que deseja expulsar este membro?")) return;
      const usuarios = obterUsuarios().filter(u => u.id !== id);
      salvarUsuarios(usuarios);
      mostrarListaRegistros();
    }
  </script>
</body>
</html>
