<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Painel PF - RP</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f0f2f5;
      margin: 0; padding: 0;
    }
    header {
      background: #003366;
      color: white;
      padding: 20px;
      text-align: center;
    }
    main {
      max-width: 1000px;
      margin: 30px auto;
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 8px #ccc;
    }
    h2 {
      color: #003366;
    }
    input, select, textarea, button {
      display: block;
      width: 100%;
      margin: 8px 0;
      padding: 10px;
      border: 1px solid #aaa;
      border-radius: 4px;
      box-sizing: border-box;
    }
    button {
      background-color: #003366;
      color: white;
      cursor: pointer;
    }
    button:hover {
      background-color: #001f4d;
    }
    .painel, .restrito, #loginSection {
      display: none;
    }
    .publico {
      margin-top: 20px;
      display: block;
    }
    .msg {
      background: #eef;
      padding: 15px;
      border-radius: 5px;
      margin-bottom: 20px;
    }
    .tabela {
      width: 100%;
      border-collapse: collapse;
    }
    .tabela th, .tabela td {
      border: 1px solid #ccc;
      padding: 10px;
    }
    .tabela th {
      background: #003366;
      color: white;
    }
    .aviso {
      border: 1px solid #003366;
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 5px;
      background: #e6f0ff;
    }
    .btn-acoes button {
      margin-right: 5px;
      margin-bottom: 5px;
      width: auto;
      padding: 5px 10px;
    }
  </style>
</head>
<body>
  <header>
    <h1>Sistema RP - Polícia Federal</h1>
  </header>

  <main>
    <!-- PAINEL PÚBLICO -->
    <section class="publico" id="painelPublico">
      <div class="msg">
        <strong>Bem-vindo cidadão!</strong><br />
        Este painel é de uso público aos cidadãos do complexo.<br />
        Aqui você pode registrar Boletins de Ocorrência e consultar portarias públicas.
      </div>

      <button onclick="mostrarLogin()">Iniciar Sessão</button>

      <h2>Registrar Boletim de Ocorrência</h2>
      <form id="formBOpublico">
        <input type="text" id="bo_nome" placeholder="Seu nome" required />
        <input type="text" id="bo_denunciado" placeholder="Pessoa denunciada" required />
        <textarea id="bo_desc" placeholder="Descreva o ocorrido" required></textarea>
        <button type="submit">Registrar BO</button>
      </form>

      <h2>Boletins Registrados</h2>
      <table class="tabela" id="tabelaBOPublico">
        <thead>
          <tr><th>Nome</th><th>Denunciado</th><th>Descrição</th><th>Data</th></tr>
        </thead>
        <tbody></tbody>
      </table>

      <h2>Portarias Públicas</h2>
      <div id="listaPortariasPublicas"></div>
    </section>

    <!-- LOGIN -->
    <section id="loginSection">
      <h2>Login Restrito</h2>
      <form id="formLogin">
        <input type="text" id="loginUsuario" placeholder="Usuário" required />
        <input type="password" id="loginSenha" placeholder="Senha" required />
        <button type="submit">Entrar</button>
      </form>
      <div id="loginErro" style="color: red; margin-top: 10px;"></div>
      <button onclick="voltarPublico()">Voltar</button>
    </section>

    <!-- PAINEL RESTRITO -->
    <section id="painelRestrito" class="restrito">
      <h2>Painel Restrito</h2>

      <!-- PROMOÇÕES, REBAIXAMENTOS, EXONERAÇÕES -->
      <div id="painelDelegado" class="painel">
        <h3>Painel de Promoções, Rebaixamentos e Exonerações</h3>
        <table class="tabela" id="tabelaUsuarios">
          <thead>
            <tr><th>Usuário</th><th>Cargo</th><th>Ações</th></tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <!-- BANCO CRIMINAL -->
      <div id="painelCrimes" class="painel">
        <h3>Registro de Banco Criminal</h3>
        <form id="formCrime">
          <input type="text" id="crime_nome" placeholder="Nome do acusado" required />
          <input type="text" id="crime_tipo" placeholder="Tipo de crime" required />
          <textarea id="crime_desc" placeholder="Descrição detalhada" required></textarea>
          <button type="submit">Registrar Crime</button>
        </form>

        <h3>Banco Criminal</h3>
        <table class="tabela" id="tabelaCrimes">
          <thead>
            <tr><th>Nome</th><th>Crime</th><th>Descrição</th><th>Data</th></tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <!-- PORTARIAS -->
      <div id="painelPortarias" class="painel">
        <h3>Registro de Portarias</h3>
        <form id="formPortaria">
          <input type="text" id="tituloPortaria" placeholder="Título da Portaria" required />
          <textarea id="descPortaria" placeholder="Conteúdo da portaria" required></textarea>
          <button type="submit">Publicar Portaria</button>
        </form>
      </div>

      <!-- CADASTRO DE MEMBROS -->
      <div id="painelCadastroMembros" class="painel">
        <h3>Registrar Novo Membro</h3>
        <form id="formCadastroMembro">
          <input type="text" id="novoUsuario" placeholder="Nome de usuário" required />
          <input type="password" id="novaSenha" placeholder="Senha" required />
          <select id="cargoInicial">
            <option value="Agente">Agente</option>
            <option value="Delegado">Delegado</option>
            <option value="Delegado+">Delegado+</option>
            <option value="Diretor">Diretor</option>
            <option value="Diretor Geral">Diretor Geral</option>
          </select>
          <button type="submit">Cadastrar Membro</button>
        </form>
      </div>

      <button onclick="logout()">Sair</button>
    </section>
  </main>

<script>
  const hierarquia = ["Agente", "Delegado", "Delegado+", "Diretor", "Diretor Geral"];

  // Dados salvos no localStorage
  const dados = {
    usuarios: JSON.parse(localStorage.getItem("usuariosPF") || "[]"),
    crimes: JSON.parse(localStorage.getItem("crimesPF") || "[]"),
    portarias: JSON.parse(localStorage.getItem("portariasPF") || "[]"),
    boPublicos: JSON.parse(localStorage.getItem("boPublicosPF") || "[]"),
    logado: null
  };

  // Inicializa usuários padrão se vazio
  if (dados.usuarios.length === 0) {
    dados.usuarios.push({ usuario: "diretorGeral", senha: "123", cargo: "Diretor Geral" });
    dados.usuarios.push({ usuario: "diretor", senha: "234", cargo: "Diretor" });
    dados.usuarios.push({ usuario: "delegado+", senha: "345", cargo: "Delegado+" });
    dados.usuarios.push({ usuario: "delegado", senha: "456", cargo: "Delegado" });
    dados.usuarios.push({ usuario: "agente", senha: "789", cargo: "Agente" });
    salvarUsuarios();
  }

  // Mostrar e ocultar painéis
  function mostrarLogin() {
    document.getElementById("painelPublico").style.display = "none";
     document.getElementById("loginSection").style.display = "block";
    document.getElementById("loginErro").innerText = "";
  }

  function voltarPublico() {
    document.getElementById("loginSection").style.display = "none";
    document.getElementById("painelPublico").style.display = "block";
  }

  function logout() {
    dados.logado = null;
    salvarSessao();
    esconderTodosPainel();
    voltarPublico();
  }

  function esconderTodosPainel() {
    document.getElementById("painelRestrito").style.display = "none";
    document.getElementById("painelPublico").style.display = "none";
    document.getElementById("loginSection").style.display = "none";
  }

  // Salvar dados em localStorage
  function salvarUsuarios() {
    localStorage.setItem("usuariosPF", JSON.stringify(dados.usuarios));
  }
  function salvarCrimes() {
    localStorage.setItem("crimesPF", JSON.stringify(dados.crimes));
  }
  function salvarPortarias() {
    localStorage.setItem("portariasPF", JSON.stringify(dados.portarias));
  }
  function salvarBOPublicos() {
    localStorage.setItem("boPublicosPF", JSON.stringify(dados.boPublicos));
  }
  function salvarSessao() {
    if (dados.logado) {
      localStorage.setItem("sessaoPF", JSON.stringify(dados.logado));
    } else {
      localStorage.removeItem("sessaoPF");
    }
  }

  // Carregar sessão
  function carregarSessao() {
    const sessao = localStorage.getItem("sessaoPF");
    if (sessao) {
      dados.logado = JSON.parse(sessao);
      mostrarPainelRestrito();
    } else {
      mostrarPainelPublico();
    }
  }

  // Mostrar painel público
  function mostrarPainelPublico() {
    esconderTodosPainel();
    document.getElementById("painelPublico").style.display = "block";
    carregarTabelaBOPublicos();
    carregarPortariasPublicas();
  }

  // Mostrar painel restrito
  function mostrarPainelRestrito() {
    esconderTodosPainel();
    document.getElementById("painelRestrito").style.display = "block";
    mostrarPainelPorCargo();
    carregarTabelaUsuarios();
    carregarTabelaCrimes();
    carregarPortariasPublicas();
  }

  // Mostrar partes do painel restrito conforme cargo
  function mostrarPainelPorCargo() {
    const cargo = dados.logado.cargo;
    // Mostrar painel de promoções e exonerar para Delegado+ ou superior
    if (["Delegado+", "Diretor", "Diretor Geral"].includes(cargo)) {
      document.getElementById("painelDelegado").style.display = "block";
    } else {
      document.getElementById("painelDelegado").style.display = "none";
    }
    // Banco criminal para todos cargos exceto Agente
    if (["Delegado", "Delegado+", "Diretor", "Diretor Geral"].includes(cargo)) {
      document.getElementById("painelCrimes").style.display = "block";
    } else {
      document.getElementById("painelCrimes").style.display = "none";
    }
    // Portarias para Delegado+ ou superior
    if (["Delegado+", "Diretor", "Diretor Geral"].includes(cargo)) {
      document.getElementById("painelPortarias").style.display = "block";
    } else {
      document.getElementById("painelPortarias").style.display = "none";
    }
    // Cadastro de membros só para Diretor Geral
    if (cargo === "Diretor Geral") {
      document.getElementById("painelCadastroMembros").style.display = "block";
    } else {
      document.getElementById("painelCadastroMembros").style.display = "none";
    }
  }

  // Login
  document.getElementById("formLogin").addEventListener("submit", function(e) {
    e.preventDefault();
    const user = document.getElementById("loginUsuario").value.trim();
    const pass = document.getElementById("loginSenha").value.trim();
    const usuario = dados.usuarios.find(u => u.usuario === user && u.senha === pass);
    if (usuario) {
      dados.logado = { usuario: usuario.usuario, cargo: usuario.cargo };
      salvarSessao();
      mostrarPainelRestrito();
    } else {
      document.getElementById("loginErro").innerText = "Usuário ou senha inválidos.";
    }
  });

  // Cadastro de novo membro (só diretor geral)
  document.getElementById("formCadastroMembro").addEventListener("submit", function(e) {
    e.preventDefault();
    if (dados.logado.cargo !== "Diretor Geral") {
      alert("Você não tem permissão para cadastrar membros.");
      return;
    }
    const novoUsuario = document.getElementById("novoUsuario").value.trim();
    const novaSenha = document.getElementById("novaSenha").value.trim();
    const cargoInicial = document.getElementById("cargoInicial").value;
    if (!novoUsuario || !novaSenha) {
      alert("Usuário e senha são obrigatórios.");
      return;
    }
    if (dados.usuarios.find(u => u.usuario === novoUsuario)) {
      alert("Usuário já existe.");
      return;
    }
    dados.usuarios.push({ usuario: novoUsuario, senha: novaSenha, cargo: cargoInicial });
    salvarUsuarios();
    alert("Membro cadastrado com sucesso!");
    this.reset();
    carregarTabelaUsuarios();
  });

  // Tabela de usuários com ações para promoções, rebaixamentos e exonerações
  function carregarTabelaUsuarios() {
    const tbody = document.querySelector("#tabelaUsuarios tbody");
    tbody.innerHTML = "";
    dados.usuarios.forEach(u => {
      if (u.usuario === dados.logado.usuario) return; // Não mostrar o próprio usuário para não auto-exonerar
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${u.usuario}</td>
        <td>${u.cargo}</td>
        <td class="btn-acoes">
          ${gerarBotoesAcao(u)}
        </td>
      `;
      tbody.appendChild(tr);

      // Atribuir eventos aos botões
      if (document.getElementById(`btnPromover-${u.usuario}`)) {
        document.getElementById(`btnPromover-${u.usuario}`).addEventListener("click", () => promoverUsuario(u.usuario));
      }
      if (document.getElementById(`btnRebaixar-${u.usuario}`)) {
        document.getElementById(`btnRebaixar-${u.usuario}`).addEventListener("click", () => rebaixarUsuario(u.usuario));
      }
      if (document.getElementById(`btnExonerar-${u.usuario}`)) {
        document.getElementById(`btnExonerar-${u.usuario}`).addEventListener("click", () => exonerarUsuario(u.usuario));
      }
    });
  }

  // Gera botões com permissões conforme hierarquia
  function gerarBotoesAcao(usuario) {
    const u = dados.usuarios.find(us => us.usuario === usuario);
    const cargoLogado = dados.logado.cargo;
    const cargoUsuario = u.cargo;
    const idxLogado = hierarquia.indexOf(cargoLogado);
    const idxUsuario = hierarquia.indexOf(cargoUsuario);

    let botoes = "";

    // Só pode promover se estiver hierarquicamente acima e não for o máximo
    if (idxLogado > idxUsuario && idxUsuario < hierarquia.length - 1) {
      botoes += `<button id="btnPromover-${usuario}" title="Promover">▲</button>`;
    }
    // Só pode rebaixar se estiver acima e não for o mínimo
    if (idxLogado > idxUsuario && idxUsuario > 0) {
      botoes += `<button id="btnRebaixar-${usuario}" title="Rebaixar">▼</button>`;
    }
    // Só pode exonerar se estiver acima
    if (idxLogado > idxUsuario) {
      botoes += `<button id="btnExonerar-${usuario}" title="Exonerar">✖</button>`;
    }
    if (!botoes) botoes = "Sem permissão";
    return botoes;
  }

  // Funções de ação
  function promoverUsuario(usuario) {
    const u = dados.usuarios.find(us => us.usuario === usuario);
    const idx = hierarquia.indexOf(u.cargo);
    if (idx < hierarquia.length - 1) {
      u.cargo = hierarquia[idx + 1];
      salvarUsuarios();
      carregarTabelaUsuarios();
      alert(`${usuario} promovido para ${u.cargo}.`);
    }
  }

  function rebaixarUsuario(usuario) {
    const u = dados.usuarios.find(us => us.usuario === usuario);
    const idx = hierarquia.indexOf(u.cargo);
    if (idx > 0) {
      u.cargo = hierarquia[idx - 1];
      salvarUsuarios();
      carregarTabelaUsuarios();
      alert(`${usuario} rebaixado para ${u.cargo}.`);
    }
  }

  function exonerarUsuario(usuario) {
    if (!confirm(`Deseja exonerar o usuário ${usuario}?`)) return;
    const idx = dados.usuarios.findIndex(u => u.usuario === usuario);
    if (idx !== -1) {
      dados.usuarios.splice(idx, 1);
      salvarUsuarios();
      carregarTabelaUsuarios();
      alert(`Usuário ${usuario} exonerado.`);
    }
  }

  // Formulário BO público
  document.getElementById("formBOpublico").addEventListener("submit", function(e) {
    e.preventDefault();
    const nome = document.getElementById("bo_nome").value.trim();
    const denunciado = document.getElementById("bo_denunciado").value.trim();
    const desc = document.getElementById("bo_desc").value.trim();
    if (!nome || !denunciado || !desc) {
      alert("Todos os campos são obrigatórios.");
      return;
    }
    const novoBO = {
      nome, denunciado, desc,
      data: new Date().toLocaleString()
    };
    dados.boPublicos.push(novoBO);
    salvarBOPublicos();
    carregarTabelaBOPublicos();
    this.reset();
    alert("Boletim de Ocorrência registrado com sucesso!");
  });

  // Tabela BO público
  function carregarTabelaBOPublicos() {
    const tbody = document.querySelector("#tabelaBOPublico tbody");
    tbody.innerHTML = "";
    dados.boPublicos.forEach(bo => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${bo.nome}</td>
        <td>${bo.denunciado}</td>
        <td>${bo.desc}</td>
        <td>${bo.data}</td>
      `;
      tbody.appendChild(tr);
    });
  }

  // Registro e listagem banco criminal
  document.getElementById("formCrime").addEventListener("submit", function(e) {
    e.preventDefault();
    const nome = document.getElementById("crime_nome").value.trim();
    const tipo = document.getElementById("crime_tipo").value.trim();
    const desc = document.getElementById("crime_desc").value.trim();
    if (!nome || !tipo || !desc) {
      alert("Todos os campos são obrigatórios.");
      return;
    }
    const novoCrime = {
      nome, tipo, desc,
      data: new Date().toLocaleString()
    };
    dados.crimes.push(novoCrime);
    salvarCrimes();
    carregarTabelaCrimes();
    this.reset();
    alert("Crime registrado no banco criminal!");
  });

  function carregarTabelaCrimes() {
    const tbody = document.querySelector("#tabelaCrimes tbody");
    tbody.innerHTML = "";
    dados.crimes.forEach(c => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${c.nome}</td>
        <td>${c.tipo}</td>
        <td>${c.desc}</td>
        <td>${c.data}</td>
      `;
      tbody.appendChild(tr);
    });
  }

  // Portarias - cadastro (restrito) e lista pública
  document.getElementById("formPortaria").addEventListener("submit", function(e) {
    e.preventDefault();
    const titulo = document.getElementById("tituloPortaria").value.trim();
    const desc = document.getElementById("descPortaria").value.trim();
    if (!titulo || !desc) {
      alert("Título e descrição são obrigatórios.");
      return;
    }
    const novaPortaria = {
      titulo, desc,
      data: new Date().toLocaleString()
    };
    dados.portarias.push(novaPortaria);
    salvarPortarias();
    carregarPortariasPublicas();
    this.reset();
    alert("Portaria publicada!");
  });

  // Mostrar portarias públicas
  function carregarPortariasPublicas() {
    const div = document.getElementById("listaPortariasPublicas");
    div.innerHTML = "";
    if (dados.portarias.length === 0) {
      div.innerHTML = "<p>Não há portarias publicadas.</p>";
      return;
    }
    dados.portarias.forEach(p => {
      const el = document.createElement("div");
      el.classList.add("aviso");
      el.innerHTML = `<strong>${p.titulo}</strong><br /><small>${p.data}</small><p>${p.desc}</p>`;
      div.appendChild(el);
    });
  }

  // Inicialização
  window.onload = () => {
    carregarSessao();
  };
</script>
</body>
</html>

