<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Painel Serviço Secreto Municipal</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0; padding: 0;
    background: #222;
    color: #eee;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    min-height: 100vh;
  }
  #container {
    background: #333;
    width: 360px;
    margin: 20px;
    border-radius: 8px;
    box-shadow: 0 0 15px #000;
    padding: 20px;
  }
  h1 {
    text-align: center;
    margin-bottom: 15px;
    color: #aaf;
  }
  input[type=text], input[type=password], select {
    width: 100%;
    padding: 8px 6px;
    margin: 6px 0 12px 0;
    border: none;
    border-radius: 4px;
    font-size: 1rem;
  }
  button {
    background: #5588ee;
    color: white;
    padding: 10px;
    width: 100%;
    border: none;
    border-radius: 4px;
    font-weight: bold;
    cursor: pointer;
    font-size: 1rem;
    margin-bottom: 10px;
  }
  button:hover:not(:disabled) {
    background: #4477dd;
  }
  button:disabled {
    background: #444;
    cursor: default;
  }
  #menuTopo {
    display: flex;
    justify-content: space-between;
    margin-bottom: 15px;
  }
  #menuTopo button {
    width: auto;
    padding: 6px 12px;
    font-size: 0.9rem;
  }
  #lista-registros {
    max-height: 200px;
    overflow-y: auto;
    background: #444;
    padding: 10px;
    border-radius: 6px;
    margin-bottom: 15px;
  }
  #lista-registros table {
    width: 100%;
    border-collapse: collapse;
  }
  #lista-registros th, #lista-registros td {
    border: 1px solid #666;
    padding: 6px 4px;
    font-size: 0.9rem;
  }
  #sobre-ss {
    text-align: center;
    margin-bottom: 20px;
  }
  #resultado {
    background: #444;
    padding: 15px;
    border-radius: 6px;
    margin-top: 10px;
  }
  #resultado p {
    margin: 8px 0;
    font-size: 1rem;
  }
  #inputID {
    font-size: 1rem;
    padding: 6px;
  }
  .link-btn {
    background: none;
    border: none;
    color: #88aaff;
    cursor: pointer;
    padding: 0;
    font-size: 0.95rem;
    text-decoration: underline;
    margin-top: 10px;
  }
  .link-btn:hover {
    color: #bbd;
  }
</style>
</head>
<body>
  <div id="container">
    <h1>Serviço Secreto Municipal</h1>

    <!-- Login -->
    <div id="login">
      <input type="text" id="loginID" placeholder="Digite seu ID" autocomplete="off" />
      <input type="password" id="loginSenha" placeholder="Digite sua senha" autocomplete="off" />
      <button id="btnLogin">Entrar</button>
      <button class="link-btn" id="btnToggleCadastro">Cadastrar novo membro</button>
    </div>

    <!-- Cadastro -->
    <div id="novo-jogador" style="display:none;">
      <input type="text" id="novoID" placeholder="Novo ID (único)" autocomplete="off" />
      <input type="text" id="novoNome" placeholder="Nome completo" autocomplete="off" />
      <input type="password" id="novaSenha" placeholder="Senha" autocomplete="off" />
      <button id="btnCadastrar">Cadastrar</button>
      <button class="link-btn" id="btnVoltarLogin">Voltar ao login</button>
    </div>

    <!-- Área logado -->
    <div id="painel" style="display:none;">
      <div id="menuTopo">
        <button id="btnSobre">Sobre o Serviço Secreto</button>
        <button id="btnListaRegistros">Lista de registros</button>
        <button id="btnPainel">Painel de controle</button>
        <button id="btnLogout" style="background:#d44;">Sair</button>
      </div>

      <!-- Texto explicativo sobre o Serviço Secreto -->
      <div id="sobre-ss" style="display:none;">
        <p>Bem-vindo ao Serviço Secreto Municipal, onde protegemos a integridade da prefeitura e a segurança dos cidadãos. Aqui você pode pesquisar membros, promover, rebaixar ou expulsar agentes com base nas necessidades da equipe.</p>
      </div>

      <!-- Lista de registros -->
      <div id="lista-registros" style="display:none;">
        <table>
          <thead><tr><th>ID</th><th>Nome</th><th>Cargo</th></tr></thead>
          <tbody id="listaTabela"></tbody>
        </table>
      </div>

      <!-- Painel de pesquisa e ações -->
      <div id="painel-pesquisa" style="display:none;">
        <input type="text" id="inputID" placeholder="Digite ID do agente" autocomplete="off" />
        <button id="btnPesquisar">Pesquisar</button>

        <div id="resultado" style="display:none;">
          <p><strong>Nome:</strong> <span id="nome"></span></p>
          <p><strong>Cargo:</strong> <span id="cargo"></span></p>
          <button id="btnPromover">Promover</button>
          <button id="btnRebaixar">Rebaixar</button>
          <button id="btnExpulsar" style="background:#d44;">Expulsar</button>
        </div>
      </div>
    </div>

  <script>
    const webhookURL = "https://discord.com/api/webhooks/1390011117778112723/KWkdPpdOmtRkgLlUH7QLUwx3sqxnHX-qhA0EkZFwjRiMPTJL8bLmbL1l3P-LZWRJBKeb";

    // Cargos na ordem do mais baixo ao mais alto
    const cargos = [
      "Estagiário",
      "Agente",
      "Investigador",
      "Detetive",
      "Chefe de Seção",
      "Diretor"
    ];

    // Dados dos jogadores armazenados localmente
    let jogadores = JSON.parse(localStorage.getItem('jogadoresSS')) || {};

    // Variáveis controle
    let idAtual = null;       // ID do usuário logado
    let idSelecionado = null; // ID selecionado no painel

    // Elementos DOM
    const loginDiv = document.getElementById('login');
    const cadastroDiv = document.getElementById('novo-jogador');
    const painelDiv = document.getElementById('painel');
    const sobreDiv = document.getElementById('sobre-ss');
    const listaRegistrosDiv = document.getElementById('lista-registros');
    const painelPesquisaDiv = document.getElementById('painel-pesquisa');
    const resultadoDiv = document.getElementById('resultado');

    // Função para atualizar localStorage
    function salvarLocalStorage() {
      localStorage.setItem('jogadoresSS', JSON.stringify(jogadores));
    }

    // Função para mostrar lista de registros
    function mostrarListaRegistros() {
      const tbody = document.getElementById('listaTabela');
      tbody.innerHTML = '';
      for (const id in jogadores) {
        const jog = jogadores[id];
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${id}</td><td>${jog.nome}</td><td>${jog.cargo}</td>`;
        tbody.appendChild(tr);
      }
    }

    // Mostrar dados do jogador selecionado
    function mostrarDadosJogador(id) {
      const jogador = jogadores[id];
      if (!jogador) return;
      document.getElementById('nome').textContent = jogador.nome;
      document.getElementById('cargo').textContent = jogador.cargo;
      resultadoDiv.style.display = 'block';

      // Não permite ações no próprio usuário
      const disabled = (id === idAtual);
      document.getElementById('btnPromover').disabled = disabled;
      document.getElementById('btnRebaixar').disabled = disabled;
      document.getElementById('btnExpulsar').disabled = disabled;
    }

    // Enviar log para Discord via webhook
    async function enviarLogDiscord(acao, jogadorAlvo, cargoAntes, cargoDepois) {
      const userAtual = jogadores[idAtual];
      const data = {
        embeds: [{
          title: `Ação: ${acao}`,
          description:
            `**Responsável:** ${userAtual.nome} (ID: ${idAtual})\n` +
            `**Alvo:** ${jogadorAlvo.nome} (ID: ${idSelecionado})\n` +
            `**Cargo antes:** ${cargoAntes}\n` +
            (cargoDepois ? `**Cargo depois:** ${cargoDepois}\n` : '') +
            `**Data:** ${new Date().toLocaleString()}`,
          color: 3447003
        }]
      };
      try {
        await fetch(webhookURL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
      } catch (e) {
        console.warn('Erro ao enviar log para Discord:', e);
      }
    }

    // Event listeners

    // Login
    document.getElementById('btnLogin').addEventListener('click', () => {
      const id = document.getElementById('loginID').value.trim();
      const senha = document.getElementById('loginSenha').value;
      if (!id || !senha) {
        alert('Preencha ID e senha.');
        return;
      }
      if (!(id in jogadores)) {
        alert('ID não cadastrado.');
        return;
      }
      if (jogadores[id].senha !== senha) {
        alert('Senha incorreta.');
        return;
      }
      idAtual = id;
      // Limpar campos
      document.getElementById('loginID').value = '';
      document.getElementById('loginSenha').value = '';

      // Mostrar painel e conteúdo inicial
      loginDiv.style.display = 'none';
      cadastroDiv.style.display = 'none';
      painelDiv.style.display = 'block';
      mostrarPainel('sobre');
    });

    // Toggle para cadastro
    document.getElementById('btnToggleCadastro').addEventListener('click', () => {
      loginDiv.style.display = 'none';
      cadastroDiv.style.display = 'block';
    });

    document.getElementById('btnVoltarLogin').addEventListener('click', () => {
      cadastroDiv.style.display = 'none';
      loginDiv.style.display = 'block';
    });

    // Cadastro
    document.getElementById('btnCadastrar').addEventListener('click', () => {
      const novoID = document.getElementById('novoID').value.trim();
      const novoNome = document.getElementById('novoNome').value.trim();
      const novaSenha = document.getElementById('novaSenha').value;
      if (!novoID || !novoNome || !novaSenha) {
        alert('Preencha todos os campos.');
        return;
      }
      if (novoID in jogadores) {
        alert('ID já existe!');
        return;
      }
      jogadores[novoID] = {
        nome: novoNome,
        cargo: cargos[0],
        senha: novaSenha
      };
      salvarLocalStorage();
      alert('Cadastro realizado com sucesso! Agora faça login.');
      document.getElementById('novoID').value = '';
      document.getElementById('novoNome').value = '';
      document.getElementById('novaSenha').value = '';
      cadastroDiv.style.display = 'none';
      loginDiv.style.display = 'block';
    });

    // Mostrar painel conforme botão
    function mostrarPainel(painel) {
      sobreDiv.style.display = 'none';
      listaRegistrosDiv.style.display = 'none';
      painelPesquisaDiv.style.display = 'none';
      resultadoDiv.style.display = 'none';
      idSelecionado = null;

      if (painel === 'sobre') {
        sobreDiv.style.display = 'block';
      } else if (painel === 'lista') {
        listaRegistrosDiv.style.display = 'block';
        mostrarListaRegistros();
      } else if (painel === 'painel') {
        painelPesquisaDiv.style.display = 'block';
      }
    }

    // Botões topo painel
    document.getElementById('btnSobre').addEventListener('click', () => {
      mostrarPainel('sobre');
    });

    document.getElementById('btnListaRegistros').addEventListener('click', () => {
      mostrarPainel('lista');
    });

    document.getElementById('btnPainel').addEventListener('click', () => {
      mostrarPainel('painel');
    });

    document.getElementById('btnLogout').addEventListener('click', () => {
      if (confirm('Deseja realmente sair?')) {
        idAtual = null;
        idSelecionado = null;
        painelDiv.style.display = 'none';
        loginDiv.style.display = 'block';
      }
    });

    // Pesquisa jogador por ID
    document.getElementById('btnPesquisar').addEventListener('click', () => {
      const id = document.getElementById('inputID').value.trim();
      if (!id || !(id in jogadores)) {
        alert('ID não encontrado!');
        resultadoDiv.style.display = 'none';
        return;
      }
      idSelecionado = id;
      mostrarDadosJogador(id);
    });

    // Promover
    document.getElementById('btnPromover').addEventListener('click', () => {
      if (!idSelecionado) return;
      const jogador = jogadores[idSelecionado];
      const idx = cargos.indexOf(jogador.cargo);
      if (idx < 0 || idx >= cargos.length - 1) {
        alert('Não é possível promover este jogador.');
        return;
      }
      const cargoAntes = jogador.cargo;
      jogador.cargo = cargos[idx + 1];
      salvarLocalStorage();
      mostrarDadosJogador(idSelecionado);
      alert(`${jogador.nome} foi promovido para ${jogador.cargo}.`);
      enviarLogDiscord('Promoção', jogador, cargoAntes, jogador.cargo);
    });

    // Rebaixar
    document.getElementById('btnRebaixar').addEventListener('click', () => {
      if (!idSelecionado) return;
      const jogador = jogadores[idSelecionado];
      const idx = cargos.indexOf(jogador.cargo);
      if (idx <= 0) {
        alert('Não é possível rebaixar este jogador.');
        return;
      }
      const cargoAntes = jogador.cargo;
      jogador.cargo = cargos[idx - 1];
      salvarLocalStorage();
      mostrarDadosJogador(idSelecionado);
      alert(`${jogador.nome} foi rebaixado para ${jogador.cargo}.`);
      enviarLogDiscord('Rebaixamento', jogador, cargoAntes, jogador.cargo);
    });

    // Expulsar
    document.getElementById('btnExpulsar').addEventListener('click', () => {
      if (!idSelecionado) return;
      if (!confirm('Tem certeza que deseja expulsar este jogador?')) return;
      const jogador = jogadores[idSelecionado];
      const cargoAntes = jogador.cargo;
      delete jogadores[idSelecionado];
      salvarLocalStorage();
      alert(`${jogador.nome} foi expulso do Serviço Secreto.`);
      idSelecionado = null;
      resultadoDiv.style.display = 'none';
      enviarLogDiscord('Expulsão', jogador, cargoAntes, null);
    });

    // Na inicialização, mostrar login e esconder tudo
    function init() {
      loginDiv.style.display = 'block';
      cadastroDiv.style.display = 'none';
      painelDiv.style.display = 'none';
    }
    init();

  </script>
  </div>
</body>
</html>
