<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Sistema PF - RP</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0; padding: 0;
    background: #f0f2f5;
  }
  header {
    background: #004080;
    color: white;
    padding: 15px;
    text-align: center;
  }
  #dashboard-publico, #login-section, #app-section {
    max-width: 700px;
    margin: 30px auto;
    background: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 0 8px #ccc;
  }
  h2 {
    color: #004080;
    margin-bottom: 15px;
  }
  label {
    display: block;
    margin: 8px 0 4px;
  }
  input[type=text], input[type=password], select, textarea {
    width: 100%;
    padding: 8px;
    border-radius: 4px;
    border: 1px solid #aaa;
    box-sizing: border-box;
  }
  button {
    margin-top: 15px;
    padding: 10px 20px;
    background: #004080;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
  }
  button:hover { background: #003060; }
  .hidden { display: none; }
  nav {
    margin-bottom: 20px;
  }
  nav button {
    margin-right: 10px;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
  }
  th, td {
    padding: 8px;
    border: 1px solid #ddd;
    word-break: break-word;
  }
  th {
    background: #004080;
    color: white;
  }
  .error { color: red; margin-top: 10px; }
</style>
</head>
<body>

<header>
  <h1>Sistema Polícia Federal (RP)</h1>
</header>

<!-- Dashboard público -->
<section id="dashboard-publico">
  <h2>Bem-vindo ao Painel Público</h2>
  <p>Este painel é de uso público a cidadãos do complexo. Aqui pode ser efetuado registro de Boletins de Ocorrência (B.O) e revisão das portarias de acesso público.</p>
  
  <button onclick="mostrarPainelPublico('painelBOPublico')">Registrar B.O Público</button>
  <button onclick="mostrarPainelPublico('painelPortariasPublicas')">Ver Portarias Públicas</button>
  <button onclick="mostrarLogin()">Iniciar Sessão (Usuários Registrados)</button>

  <div id="avisosPublicos" style="margin-top:20px; border:1px solid #004080; padding:10px; border-radius:5px; background:#e6f0ff;">
    <h3>Avisos Públicos</h3>
    <ul id="listaAvisosPublicos">
      <!-- Avisos dinâmicos aqui -->
    </ul>
  </div>

  <div id="painelBOPublico" class="hidden" style="margin-top:20px;">
    <h3>Registrar Boletim de Ocorrência (Público)</h3>
    <form id="formBOPublico">
      <label for="tituloBOPublico">Título do BO:</label>
      <input type="text" id="tituloBOPublico" required />
      <label for="descricaoBOPublico">Descrição:</label>
      <textarea id="descricaoBOPublico" rows="4" required></textarea>
      <label for="denunciadoBOPublico">Pessoa Denunciada (nome):</label>
      <input type="text" id="denunciadoBOPublico" required />
      <button type="submit">Registrar B.O</button>
    </form>
    <h3>Boletins Públicos Registrados</h3>
    <table id="tabelaBOPublico">
      <thead>
        <tr><th>Título</th><th>Descrição</th><th>Denunciado</th><th>Data</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <div id="painelPortariasPublicas" class="hidden" style="margin-top:20px;">
    <h3>Portarias Públicas</h3>
    <ul id="listaPortariasPublicas"></ul>
  </div>
</section>

<!-- Login -->
<section id="login-section" class="hidden">
  <h2>Login</h2>
  <form id="loginForm">
    <label for="username">Usuário:</label>
    <input type="text" id="username" required autocomplete="off" />
    <label for="password">Senha:</label>
    <input type="password" id="password" required autocomplete="off" />
    <button type="submit">Entrar</button>
  </form>
  <div id="login-error" class="error"></div>
  <button onclick="mostrarDashboardPublico()">Voltar ao Público</button>
</section>

<!-- Área restrita -->
<section id="app-section" class="hidden">
  <nav>
    <button onclick="mostrarPainel('painelPromocoes')">Painel Promoções</button>
    <button onclick="mostrarPainel('painelBancoCriminal')">Banco Criminal</button>
    <button onclick="mostrarPainel('painelPortariasInternas')">Portarias (Delegado+)</button>
    <button onclick="mostrarPainel('painelRegistroMembros')">Registrar Membros (Diretor+)</button>
    <button onclick="logout()">Sair</button>
  </nav>

  <!-- Painel Promoções -->
  <div id="painelPromocoes" class="painel">
    <h2>Painel de Promoção / Rebaixamento / Exoneração</h2>
    <table id="usuariosTable">
      <thead>
        <tr><th>Usuário</th><th>Cargo</th><th>Ações</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- Banco Criminal -->
  <div id="painelBancoCriminal" class="painel hidden">
    <h2>Registro Banco Criminal</h2>
    <form id="formBancoCriminal">
      <label for="nomeCriminoso">Nome do Criminoso:</label>
      <input type="text" id="nomeCriminoso" required />
      <label for="tipoCrime">Tipo do Crime:</label>
      <input type="text" id="tipoCrime" required />
      <label for="descricaoCrime">Descrição do Crime:</label>
      <textarea id="descricaoCrime" rows="4" required></textarea>
      <button type="submit">Registrar Crime</button>
    </form>
    <h3>Crimes Registrados</h3>
    <table id="tabelaBancoCriminal">
      <thead>
        <tr><th>Nome</th><th>Tipo</th><th>Descrição</th><th>Data</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- Portarias internas -->
  <div id="painelPortariasInternas" class="painel hidden">
    <h2>Gerenciar Portarias</h2>
    <form id="formPortaria">
      <label for="tituloPortaria">Título da Portaria:</label>
      <input type="text" id="tituloPortaria" required />
      <label for="conteudoPortaria">Conteúdo:</label>
      <textarea id="conteudoPortaria" rows="4" required></textarea>
      <button type="submit">Criar Portaria</button>
    </form>
    <h3>Portarias Internas Criadas</h3>
    <ul id="listaPortariasInternas"></ul>
  </div>

  <!-- Registro de membros -->
  <div id="painelRegistroMembros" class="painel hidden">
    <h2>Registrar Novo Membro (Diretor+)</h2>
    <form id="formRegistroMembros">
      <label for="novoUsuario">Usuário (login):</label>
      <input type="text" id="novoUsuario" required autocomplete="off" />
      <label for="novaSenha">Senha:</label>
      <input type="password" id="novaSenha" required />
      <label for="cargoInicial">Cargo Inicial:</label>
      <select id="cargoInicial" required>
        <option value="" disabled selected>Selecione um cargo</option>
        <option value="Agente">Agente</option>
        <option value="Escrivão">Escrivão</option>
        <option value="Investigador">Investigador</option>
        <option value="Delegado">Delegado</option>
        <option value="Diretor">Diretor</option>
      </select>
      <button type="submit">Registrar Membro</button>
    </form>
    <h3>Membros Registrados</h3>
    <table id="tabelaMembros">
      <thead>
        <tr><th>Usuário</th><th>Cargo</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>
</section>

<script>
  // Simulação banco de dados localStorage
  const storage = {
    get(key) {
      return JSON.parse(localStorage.getItem(key)) || [];
    },
    set(key, value) {
      localStorage.setItem(key, JSON.stringify(value));
    }
  };

  // Dados iniciais
  let usuarios = storage.get('usuarios');
  let boletinsPublicos = storage.get('boletinsPublicos');
  let portariasPublicas = storage.get('portariasPublicas');
  let portariasInternas = storage.get('portariasInternas');
  let bancoCriminal = storage.get('bancoCriminal');

  // Se não existir nenhum usuário, criar usuário admin padrão
  if(usuarios.length === 0) {
    usuarios.push({ username: 'admin', password: 'admin123', cargo: 'Diretor' });
    storage.set('usuarios', usuarios);
  }

  // Variável para usuário logado
  let usuarioLogado = null;

  // Funções para mostrar/ocultar seções
  function mostrarDashboardPublico() {
    document.getElementById('dashboard-publico').classList.remove('hidden');
    document.getElementById('login-section').classList.add('hidden');
    document.getElementById('app-section').classList.add('hidden');
    esconderTodosPainéisPublicos();
    carregarAvisosPublicos();
    carregarBOPublicoTabela();
    carregarPortariasPublicas();
  }

  function mostrarLogin() {
    document.getElementById('dashboard-publico').classList.add('hidden');
    document.getElementById('login-section').classList.remove('hidden');
    document.getElementById('app-section').classList.add('hidden');
    document.getElementById('login-error').textContent = '';
  }

  function mostrarApp() {
    document.getElementById('dashboard-publico').classList.add('hidden');
    document.getElementById('login-section').classList.add('hidden');
    document.getElementById('app-section').classList.remove('hidden');
    mostrarPainel('painelPromocoes');
    carregarUsuariosTabela();
    carregarBancoCriminalTabela();
    carregarPortariasInternasLista();
    carregarMembrosTabela();
  }

  function mostrarPainel(nomePainel) {
    const paineis = document.querySelectorAll('.painel');
    paineis.forEach(p => p.classList.add('hidden'));
    document.getElementById(nomePainel).classList.remove('hidden');
  }

  function mostrarPainelPublico(nomePainel) {
    esconderTodosPainéisPublicos();
    document.getElementById(nomePainel).classList.remove('hidden');
  }

  function esconderTodosPainéisPublicos() {
    document.getElementById('painelBOPublico').classList.add('hidden');
    document.getElementById('painelPortariasPublicas').classList.add('hidden');
  }

  // Login
  document.getElementById('loginForm').addEventListener('submit', e => {
    e.preventDefault();
    const username = document.getElementById('username').value.trim();
    const password = document.getElementById('password').value;
    const usuario = usuarios.find(u => u.username === username && u.password === password);
    if(usuario) {
      usuarioLogado = usuario;
      mostrarApp();
    } else {
      document.getElementById('login-error').textContent = 'Usuário ou senha incorretos.';
    }
  });

  // Logout
  function logout() {
    usuarioLogado = null;
    mostrarDashboardPublico();
  }

  // Registrar B.O Público
  document.getElementById('formBOPublico').addEventListener('submit', e => {
    e.preventDefault();
    const titulo = document.getElementById('tituloBOPublico').value.trim();
    const descricao = document.getElementById('descricaoBOPublico').value.trim();
    const denunciado = document.getElementById('denunciadoBOPublico').value.trim();
    if(titulo && descricao && denunciado) {
      boletinsPublicos.push({
        titulo,
        descricao,
        denunciado,
        data: new Date().toLocaleString()
      });
      storage.set('boletinsPublicos', boletinsPublicos);
      carregarBOPublicoTabela();
      e.target.reset();
      alert('Boletim registrado com sucesso!');
    }
  });

  // Carregar B.O Público tabela
  function carregarBOPublicoTabela() {
    const tbody = document.querySelector('#tabelaBOPublico tbody');
    tbody.innerHTML = '';
    boletinsPublicos.forEach(bo => {
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${bo.titulo}</td><td>${bo.descricao}</td><td>${bo.denunciado}</td><td>${bo.data}</td>`;
      tbody.appendChild(tr);
    });
  }

  // Carregar avisos públicos (exemplo fixo)
  function carregarAvisosPublicos() {
    const lista = document.getElementById('listaAvisosPublicos');
    lista.innerHTML = '';
    const avisos = [
      'Atenção: O sistema está em manutenção aos sábados.',
      'Para dúvidas, contate o suporte pelo e-mail suporte@pf.gov.br.'
    ];
    avisos.forEach(aviso => {
      const li = document.createElement('li');
      li.textContent = aviso;
      lista.appendChild(li);
    });
  }

  // Portarias públicas
  function carregarPortariasPublicas() {
    const lista = document.getElementById('listaPortariasPublicas');
    lista.innerHTML = '';
    portariasPublicas.forEach(portaria => {
      const li = document.createElement('li');
      li.textContent = `${portaria.titulo} - ${portaria.conteudo}`;
      lista.appendChild(li);
    });
  }

  // Form Portaria Interna
  document.getElementById('formPortaria').addEventListener('submit', e => {
    e.preventDefault();
    if(!usuarioLogado) {
      alert('Acesso negado.');
      return;
    }
    if(['Delegado','Diretor'].indexOf(usuarioLogado.cargo) === -1) {
      alert('Apenas Delegados ou Diretores podem criar portarias.');
      return;
    }
    const titulo = document.getElementById('tituloPortaria').value.trim();
    const conteudo = document.getElementById('conteudoPortaria').value.trim();
    if(titulo && conteudo) {
      portariasInternas.push({
        titulo,
        conteudo,
        data: new Date().toLocaleString()
      });
      storage.set('portariasInternas', portariasInternas);
      carregarPortariasInternasLista();
      e.target.reset();
      alert('Portaria criada com sucesso!');
    }
  });

  function carregarPortariasInternasLista() {
    const lista = document.getElementById('listaPortariasInternas');
    lista.innerHTML = '';
    portariasInternas.forEach(p => {
      const li = document.createElement('li');
      li.textContent = `${p.titulo} - ${p.conteudo} (${p.data})`;
      lista.appendChild(li);
    });
  }

  // Banco Criminal - registrar crime
  document.getElementById('formBancoCriminal').addEventListener('submit', e => {
    e.preventDefault();
    if(!usuarioLogado) {
      alert('Acesso negado.');
      return;
    }
    const nome = document.getElementById('nomeCriminoso').value.trim();
    const tipo = document.getElementById('tipoCrime').value.trim();
    const descricao = document.getElementById('descricaoCrime').value.trim();
    if(nome && tipo && descricao) {
      bancoCriminal.push({
        nome,
        tipo,
        descricao,
        data: new Date().toLocaleString()
      });
      storage.set('bancoCriminal', bancoCriminal);
      carregarBancoCriminalTabela();
      e.target.reset();
      alert('Crime registrado com sucesso!');
    }
  });

  function carregarBancoCriminalTabela() {
    const tbody = document.querySelector('#tabelaBancoCriminal tbody');
    tbody.innerHTML = '';
    bancoCriminal.forEach(c => {
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${c.nome}</td><td>${c.tipo}</td><td>${c.descricao}</td><td>${c.data}</td>`;
      tbody.appendChild(tr);
    });
  }

  // Registrar membros - Diretor+
  document.getElementById('formRegistroMembros').addEventListener('submit', e => {
    e.preventDefault();
    if(!usuarioLogado || ['Diretor'].indexOf(usuarioLogado.cargo) === -1) {
      alert('Apenas Diretores podem registrar membros.');
      return;
    }
    const novoUsuario = document.getElementById('novoUsuario').value.trim();
    const novaSenha = document.getElementById('novaSenha').value;
    const cargoInicial = document.getElementById('cargoInicial').value;
    if(novoUsuario && novaSenha && cargoInicial) {
      if(usuarios.find(u => u.username === novoUsuario)) {
        alert('Usuário já existe!');
        return;
      }
      usuarios.push({ username: novoUsuario, password: novaSenha, cargo: cargoInicial });
      storage.set('usuarios', usuarios);
      carregarMembrosTabela();
      e.target.reset();
      alert('Membro registrado com sucesso!');
    }
  });

  // Carregar usuários para promoções/rebaixamentos
  function carregarUsuariosTabela() {
    const tbody = document.querySelector('#usuariosTable tbody');
    tbody.innerHTML = '';
    usuarios.forEach((u, index) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${u.username}</td><td>${u.cargo}</td>
        <td>
          <button onclick="alterarCargo(${index}, 'promover')">Promover</button>
          <button onclick="alterarCargo(${index}, 'rebaixar')">Rebaixar</button>
          <button onclick="alterarCargo(${index}, 'exonerar')">Exonerar</button>
        </td>`;
      tbody.appendChild(tr);
    });
  }

  // Alterar cargo usuário
  function alterarCargo(index, acao) {
    if(!usuarioLogado) {
      alert('Faça login para realizar essa ação.');
      return;
    }
    const cargos = ['Agente', 'Escrivão', 'Investigador', 'Delegado', 'Diretor'];
    const usuarioAlvo = usuarios[index];
    if(usuarioAlvo.username === usuarioLogado.username) {
      alert('Você não pode alterar seu próprio cargo.');
      return;
    }
    if(usuarioLogado.cargo !== 'Diretor') {
      alert('Apenas Diretores podem alterar cargos.');
      return;
    }
    const posAtual = cargos.indexOf(usuarioAlvo.cargo);
    if(acao === 'promover') {
      if(posAtual < cargos.length -1) {
        usuarioAlvo.cargo = cargos[posAtual + 1];
      } else {
        alert('Já está no cargo máximo.');
        return;
      }
    } else if(acao === 'rebaixar') {
      if(posAtual > 0) {
        usuarioAlvo.cargo = cargos[posAtual - 1];
      } else {
        alert('Já está no cargo mínimo.');
        return;
      }
    } else if(acao === 'exonerar') {
      usuarios.splice(index, 1);
      alert('Usuário exonerado.');
      storage.set('usuarios', usuarios);
      carregarUsuariosTabela();
      carregarMembrosTabela();
      return;
    }
    storage.set('usuarios', usuarios);
    carregarUsuariosTabela();
    carregarMembrosTabela();
    alert('Cargo alterado com sucesso!');
  }

  // Carregar membros registrados
  function carregarMembrosTabela() {
    const tbody = document.querySelector('#tabelaMembros tbody');
    tbody.innerHTML = '';
    usuarios.forEach(u => {
      const tr = document.createElement('tr');
      tr.innerHTML = `<td>${u.username}</td><td>${u.cargo}</td>`;
      tbody.appendChild(tr);
    });
  }

  // Iniciar mostrando o painel público
  mostrarDashboardPublico();
</script>

</body>
</html>
