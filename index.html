<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Polícia Federal - Sistema Interno</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
            color: #333;
        }

        header {
            background-color: #003366; /* Azul escuro da PF */
            color: white;
            padding: 1rem 0;
            text-align: center;
        }

        nav button {
            background-color: #0056b3;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            cursor: pointer;
            border-radius: 4px;
            margin-left: 10px;
        }

        nav button:hover {
            background-color: #004085;
        }

        main {
            padding: 20px;
            max-width: 900px;
            margin: 20px auto;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        section {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        h2, h3 {
            color: #003366;
        }

        form label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }

        form input[type="email"],
        form input[type="password"],
        form input[type="text"],
        form textarea {
            width: calc(100% - 20px);
            padding: 10px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        form button[type="submit"] {
            background-color: #28a745; /* Verde para ações de sucesso */
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }

        form button[type="submit"]:hover {
            background-color: #218838;
        }

        .dashboard-buttons button {
            background-color: #007bff; /* Azul padrão para botões */
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }

        .dashboard-buttons button:hover {
            background-color: #0056b3;
        }

        .user-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #eee;
        }

        .user-item:last-child {
            border-bottom: none;
        }

        .user-item button {
            margin-left: 5px;
            padding: 5px 10px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }

        .user-item .promote { background-color: #ffc107; color: #333; }
        .user-item .promote:hover { background-color: #e0a800; }
        .user-item .demote { background-color: #fd7e14; color: white; }
        .user-item .demote:hover { background-color: #e66b0d; }
        .user-item .exonerate { background-color: #dc3545; color: white; }
        .user-item .exonerate:hover { background-color: #c82333; }

        .record-item, .announcement-item, .ordinance-item, .criminal-item {
            background-color: #e9ecef;
            border-left: 5px solid #007bff;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 4px;
        }

        .record-item strong {
            color: #003366;
        }

        footer {
            text-align: center;
            padding: 1rem 0;
            margin-top: 20px;
            background-color: #003366;
            color: white;
        }
    </style>
</head>
<body>
    <header>
        <h1>Polícia Federal - Sistema Interno</h1>
        <nav>
            <button id="logoutBtn" style="display:none;">Sair</button>
        </nav>
    </header>

    <main>
        <section id="loginSection">
            <h2>Login</h2>
            <form id="loginForm">
                <label for="loginEmail">Email:</label>
                <input type="email" id="loginEmail" required>
                <label for="loginPassword">Senha:</label>
                <input type="password" id="loginPassword" required>
                <button type="submit">Entrar</button>
            </form>
        </section>

        <section id="loggedInContent" style="display:none;">
            <p>Bem-vindo, <span id="userNameDisplay"></span>!</p>

            <div class="dashboard-buttons">
                <button id="registerBoletimBtn">Registrar Boletim</button>
                <button id="viewAnnouncementsBtn">Ver Anúncios e Portarias</button>
                <button id="criminalBankBtn">Banco Criminal</button>
                <button id="registerMemberBtn" style="display:none;">Registrar Novo Membro</button>
                <button id="manageUsersBtn" style="display:none;">Gerenciar Membros</button>
                <button id="makeOrdinanceBtn" style="display:none;">Fazer Portaria</button>
                <button id="makeAnnouncementBtn" style="display:none;">Fazer Anúncio</button>
            </div>

            <hr>

            <section id="boletimSection" style="display:none;">
                <h2>Registrar Boletim</h2>
                <form id="boletimForm">
                    <label for="denunciante">Denunciante:</label>
                    <input type="text" id="denunciante" required>
                    <label for="denunciado">Denunciado:</label>
                    <input type="text" id="denunciado" required>
                    <label for="descricaoBoletim">Descrição:</label>
                    <textarea id="descricaoBoletim" rows="5" required></textarea>
                    <button type="submit">Registrar Boletim</button>
                </form>
            </section>

            <section id="announcementsOrdinancesSection" style="display:none;">
                <h2>Anúncios e Portarias</h2>
                <h3>Anúncios</h3>
                <div id="announcementsList"></div>
                <h3>Portarias</h3>
                <div id="ordinancesList"></div>
            </section>

            <section id="criminalBankSection" style="display:none;">
                <h2>Banco Criminal</h2>
                <form id="addCriminalForm">
                    <label for="criminalName">Nome do Indivíduo:</label>
                    <input type="text" id="criminalName" required>
                    <label for="criminalDescription">Detalhes:</label>
                    <textarea id="criminalDescription" rows="3" required></textarea>
                    <button type="submit">Adicionar ao Banco</button>
                </form>
                <h3>Registros Atuais</h3>
                <div id="criminalRecordsList"></div>
            </section>

            <section id="registerMemberSection" style="display:none;">
                <h2>Registrar Novo Membro</h2>
                <form id="registerMemberForm">
                    <label for="newMemberEmail">Email:</label>
                    <input type="email" id="newMemberEmail" required>
                    <label for="newMemberPassword">Senha:</label>
                    <input type="password" id="newMemberPassword" required>
                    <button type="submit">Registrar Agente</button>
                </form>
            </section>

            <section id="manageUsersSection" style="display:none;">
                <h2>Gerenciar Membros</h2>
                <div id="userList"></div>
            </section>

            <section id="makeOrdinanceSection" style="display:none;">
                <h2>Fazer Portaria</h2>
                <form id="ordinanceForm">
                    <label for="ordinanceTitle">Título:</label>
                    <input type="text" id="ordinanceTitle" required>
                    <label for="ordinanceContent">Conteúdo:</label>
                    <textarea id="ordinanceContent" rows="10" required></textarea>
                    <button type="submit">Publicar Portaria</button>
                </form>
            </section>

            <section id="makeAnnouncementSection" style="display:none;">
                <h2>Fazer Anúncio</h2>
                <form id="announcementForm">
                    <label for="announcementTitle">Título:</label>
                    <input type="text" id="announcementTitle" required>
                    <label for="announcementContent">Conteúdo:</label>
                    <textarea id="announcementContent" rows="10" required></textarea>
                    <button type="submit">Publicar Anúncio</button>
                </form>
            </section>

            <section id="recordsSection">
                <h2>Boletins Registrados</h2>
                <div id="boletinsList"></div>
            </section>

        </section>
    </main>

    <footer>
        <p>&copy; 2025 Polícia Federal Fictícia. Todos os direitos reservados.</p>
    </footer>

    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
    <script>
        // Sua configuração do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyBuaVeRTLVxpAyboRiWS6E4KYHWlYZgMEw",
            authDomain: "pfcpx-c0b9b.firebaseapp.com",
            projectId: "pfcpx-c0b9b",
            storageBucket: "pfcpx-c0b9b.firebasestorage.app",
            messagingSenderId: "322312831509",
            appId: "1:322312831509:web:e5fe68609d34db6345c41c",
            measurementId: "G-24QF5E8Q5E"
        };

        // Inicializar o Firebase
        firebase.initializeApp(firebaseConfig);

        const auth = firebase.auth();
        const db = firebase.firestore();

        // Elementos HTML
        const loginSection = document.getElementById('loginSection');
        const loggedInContent = document.getElementById('loggedInContent');
        const logoutBtn = document.getElementById('logoutBtn');
        const loginForm = document.getElementById('loginForm');
        const userNameDisplay = document.getElementById('userNameDisplay');

        // Botões do Dashboard
        const registerBoletimBtn = document.getElementById('registerBoletimBtn');
        const viewAnnouncementsBtn = document.getElementById('viewAnnouncementsBtn');
        const criminalBankBtn = document.getElementById('criminalBankBtn');
        const registerMemberBtn = document.getElementById('registerMemberBtn');
        const manageUsersBtn = document.getElementById('manageUsersBtn');
        const makeOrdinanceBtn = document.getElementById('makeOrdinanceBtn');
        const makeAnnouncementBtn = document.getElementById('makeAnnouncementBtn');

        // Seções
        const boletimSection = document.getElementById('boletimSection');
        const announcementsOrdinancesSection = document.getElementById('announcementsOrdinancesSection');
        const criminalBankSection = document.getElementById('criminalBankSection');
        const registerMemberSection = document.getElementById('registerMemberSection');
        const manageUsersSection = document.getElementById('manageUsersSection');
        const makeOrdinanceSection = document.getElementById('makeOrdinanceSection');
        const makeAnnouncementSection = document.getElementById('makeAnnouncementSection');
        const recordsSection = document.getElementById('recordsSection'); // Seção de boletins registrados

        // Formulários
        const boletimForm = document.getElementById('boletimForm');
        const addCriminalForm = document.getElementById('addCriminalForm');
        const registerMemberForm = document.getElementById('registerMemberForm');
        const ordinanceForm = document.getElementById('ordinanceForm');
        const announcementForm = document.getElementById('announcementForm');

        // Listas de conteúdo
        const announcementsList = document.getElementById('announcementsList');
        const ordinancesList = document.getElementById('ordinancesList');
        const criminalRecordsList = document.getElementById('criminalRecordsList');
        const userList = document.getElementById('userList');
        const boletinsList = document.getElementById('boletinsList');

        // Níveis de Hierarquia
        const HIERARCHY = {
            'Agente': 1,
            'Delegado': 2,
            'Delegado+': 3, // Pode registrar membros
            'Diretor': 4, // Pode gerenciar, fazer portaria
            'Diretor Executivo': 5, // Pode gerenciar, fazer portaria e anúncio
            'Diretor Geral': 6 // Pode gerenciar, fazer portaria e anúncio
        };

        // Função para exibir/ocultar seções
        function showSection(sectionToShow) {
            const sections = [
                boletimSection, announcementsOrdinancesSection, criminalBankSection,
                registerMemberSection, manageUsersSection, makeOrdinanceSection,
                makeAnnouncementSection, recordsSection
            ];
            sections.forEach(section => {
                if (section === sectionToShow) {
                    section.style.display = 'block';
                } else {
                    section.style.display = 'none';
                }
            });
        }

        // Atualizar visibilidade dos botões e conteúdo com base no cargo
        async function updateUIForUser(user) {
            if (user) {
                loginSection.style.display = 'none';
                loggedInContent.style.display = 'block';
                logoutBtn.style.display = 'inline-block';

                const userDoc = await db.collection('users').doc(user.uid).get();
                const userData = userDoc.data();
                const userCargo = userData ? userData.cargo : 'Agente'; // Padrão para 'Agente'
                userNameDisplay.textContent = ${user.email} (${userCargo});

                // Resetar visibilidade dos botões
                registerMemberBtn.style.display = 'none';
                manageUsersBtn.style.display = 'none';
                makeOrdinanceBtn.style.display = 'none';
                makeAnnouncementBtn.style.display = 'none';

                const userHierarchyLevel = HIERARCHY[userCargo];

                if (userHierarchyLevel >= HIERARCHY['Delegado+']) {
                    registerMemberBtn.style.display = 'inline-block';
                }
                if (userHierarchyLevel >= HIERARCHY['Diretor']) {
                    manageUsersBtn.style.display = 'inline-block';
                    makeOrdinanceBtn.style.display = 'inline-block';
                }
                if (userHierarchyLevel >= HIERARCHY['Diretor Executivo']) {
                    makeAnnouncementBtn.style.display = 'inline-block';
                }

                // Exibir automaticamente a área de boletins para todos os logados
                showSection(recordsSection);
                loadBoletins(); // Carregar boletins ao logar

            } else {
                loginSection.style.display = 'block';
                loggedInContent.style.display = 'none';
                logoutBtn.style.display = 'none';
                showSection(null); // Ocultar todas as seções de conteúdo
            }
        }

        // --- Autenticação ---
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = loginEmail.value;
            const password = loginPassword.value;

            try {
                await auth.signInWithEmailAndPassword(email, password);
                alert('Login bem-sucedido!');
                // UI será atualizada pelo onAuthStateChanged
            } catch (error) {
                alert(Erro de login: ${error.message});
            }
        });

        logoutBtn.addEventListener('click', async () => {
            try {
                await auth.signOut();
                alert('Logout bem-sucedido!');
                // UI será atualizada pelo onAuthStateChanged
            } catch (error) {
                alert(Erro ao fazer logout: ${error.message});
            }
        });

        // Monitorar o estado de autenticação
        auth.onAuthStateChanged((user) => {
            updateUIForUser(user);
        });

        // --- Funcionalidades do Site ---

        // Registrar Boletim
        registerBoletimBtn.addEventListener('click', () => showSection(boletimSection));
        boletimForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const denunciante = document.getElementById('denunciante').value;
            const denunciado = document.getElementById('denunciado').value;
            const descricao = document.getElementById('descricaoBoletim').value;
            const currentUser = auth.currentUser;

            if (currentUser) {
                const userDoc = await db.collection('users').doc(currentUser.uid).get();
                const userData = userDoc.data();
                const madeBy = userData ? userData.email : currentUser.email;

                try {
                    await db.collection('boletins').add({
                        denunciante,
                        denunciado,
                        descricao,
                        feitoPor: madeBy,
                        data: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    alert('Boletim registrado com sucesso!');
                    boletimForm.reset();
                    loadBoletins(); // Recarregar a lista de boletins
                    showSection(recordsSection); // Voltar para a área de registros
                } catch (error) {
                    alert(Erro ao registrar boletim: ${error.message});
                }
            } else {
                alert('Você precisa estar logado para registrar um boletim.');
            }
        });

        // Carregar Boletins
        async function loadBoletins() {
            boletinsList.innerHTML = '';
            const snapshot = await db.collection('boletins').orderBy('data', 'desc').get();
            snapshot.forEach(doc => {
                const data = doc.data();
                const boletimItem = document.createElement('div');
                boletimItem.classList.add('record-item');
                const date = data.data ? new Date(data.data.seconds * 1000).toLocaleString() : 'Data desconhecida';
                boletimItem.innerHTML = `
                    <p><strong>Feito por:</strong> ${data.feitoPor}</p>
                    <p><strong>Denunciante:</strong> ${data.denunciante}</p>
                    <p><strong>Denunciado:</strong> ${data.denunciado}</p>
                    <p><strong>Descrição:</strong> ${data.descricao}</p>
                    <p><small>Registrado em: ${date}</small></p>
                    <hr>
                `;
                boletinsList.appendChild(boletimItem);
            });
        }

        // Visualizar Anúncios e Portarias
        viewAnnouncementsBtn.addEventListener('click', async () => {
            showSection(announcementsOrdinancesSection);
            announcementsList.innerHTML = '';
            ordinancesList.innerHTML = '';

            // Carregar Anúncios
            const announcementsSnapshot = await db.collection('announcements').orderBy('data', 'desc').get();
            announcementsSnapshot.forEach(doc => {
                const data = doc.data();
                const announcementItem = document.createElement('div');
                announcementItem.classList.add('announcement-item');
                const date = data.data ? new Date(data.data.seconds * 1000).toLocaleString() : 'Data desconhecida';
                announcementItem.innerHTML = `
                    <h4>${data.title}</h4>
                    <p>${data.content}</p>
                    <p><small>Publicado por: ${data.publishedBy} em: ${date}</small></p>
                `;
                announcementsList.appendChild(announcementItem);
            });

            // Carregar Portarias
            const ordinancesSnapshot = await db.collection('ordinances').orderBy('data', 'desc').get();
            ordinancesSnapshot.forEach(doc => {
                const data = doc.data();
                const ordinanceItem = document.createElement('div');
                ordinanceItem.classList.add('ordinance-item');
                const date = data.data ? new Date(data.data.seconds * 1000).toLocaleString() : 'Data desconhecida';
                ordinanceItem.innerHTML = `
                    <h4>${data.title}</h4>
                    <p>${data.content}</p>
                    <p><small>Publicado por: ${data.publishedBy} em: ${date}</small></p>
                `;
                ordinancesList.appendChild(ordinanceItem);
            });
        });

        // Banco Criminal
        criminalBankBtn.addEventListener('click', () => {
            showSection(criminalBankSection);
            loadCriminalRecords();
        });

        addCriminalForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = document.getElementById('criminalName').value;
            const description = document.getElementById('criminalDescription').value;
            const currentUser = auth.currentUser;

            if (currentUser) {
                try {
                    await db.collection('criminalBank').add({
                        name,
                        description,
                        addedBy: currentUser.email,
                        data: firebase.firestore.FieldValue.serverTimestamp()
                    });
                    alert('Indivíduo adicionado ao Banco Criminal!');
                    addCriminalForm.reset();
                    loadCriminalRecords();
                } catch (error) {
                    alert(Erro ao adicionar ao banco criminal: ${error.message});
                }
            } else {
                alert('Você precisa estar logado para adicionar ao banco criminal.');
            }
        });

        async function loadCriminalRecords() {
            criminalRecordsList.innerHTML = '';
            const snapshot = await db.collection('criminalBank').orderBy('data', 'desc').get();
            snapshot.forEach(doc => {
                const data = doc.data();
                const criminalItem = document.createElement('div');
                criminalItem.classList.add('criminal-item');
                const date = data.data ? new Date(data.data.seconds * 1000).toLocaleString() : 'Data desconhecida';
                criminalItem.innerHTML = `
                    <p><strong>Nome:</strong> ${data.name}</p>
                    <p><strong>Detalhes:</strong> ${data.description}</p>
                    <p><small>Adicionado por: ${data.addedBy} em: ${date}</small></p>
                    <hr>
                `;
                criminalRecordsList.appendChild(criminalItem);
            });
        }

        // Registrar Novo Membro (Apenas Delegado+)
        registerMemberBtn.addEventListener('click', () => showSection(registerMemberSection));
        registerMemberForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('newMemberEmail').value;
            const password = document.getElementById('newMemberPassword').value;

            const currentUser = auth.currentUser;
            if (currentUser) {
                const userDoc = await db.collection('users').doc(currentUser.uid).get();
                const userData = userDoc.data();
                const userCargo = userData ? userData.cargo : 'Agente';

                if (HIERARCHY[userCargo] >= HIERARCHY['Delegado+']) {
                    try {
                        // Firebase Auth para criar o usuário
                        const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                        const newUserUid = userCredential.user.uid;

                        // Salvar o cargo no Firestore
                        await db.collection('users').doc(newUserUid).set({
                            email: email,
                            cargo: 'Agente', // Cargo padrão ao registrar
                            registeredBy: currentUser.email,
                            registeredAt: firebase.firestore.FieldValue.serverTimestamp()
                        });
                        alert(Membro ${email} registrado como Agente com sucesso!);
                        registerMemberForm.reset();
                    } catch (error) {
                        alert(Erro ao registrar membro: ${error.message});
                    }
                } else {
                    alert('Você não tem permissão para registrar novos membros.');
                }
            } else {
                alert('Você precisa estar logado para registrar membros.');
            }
        });

        // Gerenciar Membros (Apenas Diretor, Diretor Executivo, Diretor Geral)
        manageUsersBtn.addEventListener('click', () => {
            showSection(manageUsersSection);
            loadUsersToManage();
        });

        async function loadUsersToManage() {
            userList.innerHTML = '';
            const currentUser = auth.currentUser;
            if (!currentUser) {
                alert('Você precisa estar logado para gerenciar membros.');
                return;
            }

            const currentUserDoc = await db.collection('users').doc(currentUser.uid).get();
            const currentUserData = currentUserDoc.data();
            const currentUserCargo = currentUserData ? currentUserData.cargo : 'Agente';
            const currentUserHierarchyLevel = HIERARCHY[currentUserCargo];

            if (currentUserHierarchyLevel < HIERARCHY['Diretor']) {
                alert('Você não tem permissão para gerenciar membros.');
                return;
            }

            const snapshot = await db.collection('users').get();
            snapshot.forEach(doc => {
                const userData = doc.data();
                const userUid = doc.id;
                const userEmail = userData.email;
                const userCargo = userData.cargo;
                const userHierarchyLevel = HIERARCHY[userCargo];

                if (userUid === currentUser.uid) { // Não pode gerenciar a si mesmo
                    return;
                }

                const userItem = document.createElement('div');
                userItem.classList.add('user-item');
                userItem.innerHTML = `
                    <span>${userEmail} - Cargo: ${userCargo}</span>
                    <div>
                        <button class="promote" data-uid="${userUid}" data-cargo="${userCargo}">Promover</button>
                        <button class="demote" data-uid="${userUid}" data-cargo="${userCargo}">Rebaixar</button>
                        <button class="exonerate" data-uid="${userUid}">Exonerar</button>
                    </div>
                `;
                userList.appendChild(userItem);
            });

            // Adicionar listeners para os botões de promoção/rebaixamento/exoneração
            userList.querySelectorAll('.promote').forEach(button => {
                button.addEventListener('click', (e) => handleUserAction(e, 'promote'));
            });
            userList.querySelectorAll('.demote').forEach(button => {
                button.addEventListener('click', (e) => handleUserAction(e, 'demote'));
            });
            userList.querySelectorAll('.exonerate').forEach(button => {
                button.addEventListener('click', (e) => handleUserAction(e, 'exonerate'));
            });
        }

        async function handleUserAction(e, action) {
            const targetUid = e.target.dataset.uid;
            const targetCargo = e.target.dataset.cargo;

            const currentUser = auth.currentUser;
            const currentUserDoc = await db.collection('users').doc(currentUser.uid).get();
            const currentUserData = currentUserDoc.data();
            const currentUserCargo = currentUserData ? currentUserData.cargo : 'Agente';
            const currentUserHierarchyLevel = HIERARCHY[currentUserCargo];

            const targetUserHierarchyLevel = HIERARCHY[targetCargo];

            if (currentUserHierarchyLevel <= targetUserHierarchyLevel && action !== 'exonerate') {
                alert('Você não pode promover ou rebaixar um membro de cargo igual ou superior ao seu.');
                return;
            }
            if (currentUserHierarchyLevel < targetUserHierarchyLevel && action === 'exonerate') {
                alert('Você não pode exonerar um membro de cargo superior ao seu.');
                return;
            }


            try {
                if (action === 'promote') {
                    const currentCargoIndex = Object.keys(HIERARCHY).indexOf(targetCargo);
                    const nextCargo = Object.keys(HIERARCHY)[currentCargoIndex + 1];
                    if (nextCargo) {
                        await db.collection('users').doc(targetUid).update({ cargo: nextCargo });
                        alert(Membro promovido para ${nextCargo}!);
                    } else {
                        alert('Este membro já está no cargo mais alto.');
                    }
                } else if (action === 'demote') {
                    const currentCargoIndex = Object.keys(HIERARCHY).indexOf(targetCargo);
                    const previousCargo = Object.keys(HIERARCHY)[currentCargoIndex - 1];
                    if (previousCargo) {
                        await db.collection('users').doc(targetUid).update({ cargo: previousCargo });
                        alert(Membro rebaixado para ${previousCargo}!);
                    } else {
                        alert('Este membro já está no cargo mais baixo.');
                    }
                } else if (action === 'exonerate') {
                    if (confirm(Tem certeza que deseja exonerar ${targetUid}? Esta ação é irreversível!)) {
                        // Excluir o usuário do Firestore primeiro
                        await db.collection('users').doc(targetUid).delete();
                        // O Firebase Auth não permite a exclusão de usuários por cliente diretamente
                        // Em um sistema real, isso seria feito por uma função de Cloud Functions (server-side)
                        // Para este exemplo, vamos apenas remover do Firestore.
                        alert('Membro exonerado (removido do registro do sistema).');
                    }
                }
                loadUsersToManage(); // Recarregar a lista
            } catch (error) {
                alert(Erro ao ${action} membro: ${error.message});
            }
        }

        // Fazer Portaria (Apenas Diretor, Diretor Executivo, Diretor Geral)
        makeOrdinanceBtn.addEventListener('click', () => showSection(makeOrdinanceSection));
        ordinanceForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const title = document.getElementById('ordinanceTitle').value;
            const content = document.getElementById('ordinanceContent').value;
            const currentUser = auth.currentUser;

            if (currentUser) {
                const userDoc = await db.collection('users').doc(currentUser.uid).get();
                const userData = userDoc.data();
                const userCargo = userData ? userData.cargo : 'Agente';

                if (HIERARCHY[userCargo] >= HIERARCHY['Diretor']) {
                    try {
                        await db.collection('ordinances').add({
                            title,
                            content,
                            publishedBy: currentUser.email,
                            data: firebase.firestore.FieldValue.serverTimestamp()
                        });
                        alert('Portaria publicada com sucesso!');
                        ordinanceForm.reset();
                        showSection(announcementsOrdinancesSection); // Voltar para a visualização
                        viewAnnouncementsBtn.click(); // Recarregar anúncios e portarias
                    } catch (error) {
                        alert(Erro ao publicar portaria: ${error.message});
                    }
                } else {
                    alert('Você não tem permissão para fazer portarias.');
                }
            } else {
                alert('Você precisa estar logado para fazer portarias.');
            }
        });

        // Fazer Anúncio (Apenas Diretor Executivo e Diretor Geral)
        makeAnnouncementBtn.addEventListener('click', () => showSection(makeAnnouncementSection));
        announcementForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const title = document.getElementById('announcementTitle').value;
            const content = document.getElementById('announcementContent').value;
            const currentUser = auth.currentUser;

            if (currentUser) {
                const userDoc = await db.collection('users').doc(currentUser.uid).get();
                const userData = userDoc.data();
                const userCargo = userData ? userData.cargo : 'Agente';

                if (HIERARCHY[userCargo] >= HIERARCHY['Diretor Executivo']) {
                    try {
                        await db.collection('announcements').add({
                            title,
                            content,
                            publishedBy: currentUser.email,
                            data: firebase.firestore.FieldValue.serverTimestamp()
                        });
                        alert('Anúncio publicado com sucesso!');
                        announcementForm.reset();
                        showSection(announcementsOrdinancesSection); // Voltar para a visualização
                        viewAnnouncementsBtn.click(); // Recarregar anúncios e portarias
                    } catch (error) {
                        alert(Erro ao publicar anúncio: ${error.message});
                    }
                } else {
                    alert('Você não tem permissão para fazer anúncios.');
                }
            } else {
                alert('Você precisa estar logado para fazer anúncios.');
            }
        });
    </script>
</body>
</html>
