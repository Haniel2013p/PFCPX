<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Painel de Controle SSP</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #222;
      color: #eee;
      padding: 40px;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
      margin: 0;
    }
    h1 {
      color: #00ccff;
      margin-bottom: 30px;
    }
    input[type="text"], input[type="password"] {
      padding: 10px;
      font-size: 1.1em;
      border-radius: 5px;
      border: none;
      width: 250px;
      margin: 5px 0;
    }
    button {
      padding: 10px 20px;
      font-size: 1.1em;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin: 5px;
      background-color: #00ccff;
      color: #222;
      transition: background-color 0.3s;
    }
    button:hover {
      background-color: #0099cc;
      color: white;
    }
    #resultado, #novo-jogador, #login {
      margin-top: 30px;
      background-color: #333;
      padding: 20px;
      border-radius: 8px;
      width: 350px;
      text-align: center;
    }
    #acoes button {
      width: 100px;
    }
    #btnToggleCadastro {
      font-size: 0.9em;
      color: #00ccff;
      background: none;
      border: none;
      cursor: pointer;
      margin-top: 10px;
      text-decoration: underline;
    }
    #user-info {
      position: fixed;
      top: 10px;
      right: 10px;
      background-color: #333;
      padding: 10px 20px;
      border-radius: 8px;
      display: none;
      color: #00ccff;
      font-weight: bold;
      user-select: none;
    }
    #pesquisa {
      margin-top: 30px;
      text-align: center;
    }
    #pesquisa input {
      padding: 10px;
      font-size: 1.1em;
      border-radius: 5px;
      border: none;
      width: 250px;
      margin-right: 10px;
    }
  </style>
</head>
<body>

  <h1>Painel de Controle SSP</h1>

  <!-- Login -->
  <div id="login">
    <input type="text" id="loginID" placeholder="Digite seu ID" />
    <input type="password" id="loginSenha" placeholder="Digite sua senha" />
    <button onclick="fazerLogin()">Entrar</button>

    <button id="btnToggleCadastro">Ou cadastre-se abaixo</button>
  </div>

  <!-- Cadastro -->
  <div id="novo-jogador" style="display:none;">
    <h2>Adicionar Novo Jogador</h2>
    <input type="text" id="novoID" placeholder="Digite o novo ID" />
    <input type="text" id="novoNome" placeholder="Digite o nome" />
    <input type="password" id="novaSenha" placeholder="Digite a senha" />
    <button onclick="adicionarJogador()">Adicionar Jogador</button>
  </div>

  <!-- Pesquisa jogador -->
  <div id="pesquisa" style="display:none;">
    <input type="text" id="inputID" placeholder="Digite o ID do jogador" />
    <button onclick="pesquisar()">Pesquisar</button>
  </div>

  <!-- Resultado -->
  <div id="resultado" style="display:none;">
    <p><strong>Nome:</strong> <span id="nome"></span></p>
    <p><strong>Cargo:</strong> <span id="cargo"></span></p>
    <div id="acoes">
      <button onclick="promover()">Promover</button>
      <button onclick="rebaixar()">Rebaixar</button>
      <button onclick="expulsar()">Expulsar</button>
    </div>
  </div>

  <!-- Info usuário logado no canto -->
  <div id="user-info"></div>

<script>
const cargos = [
  "Estagiário",
  "Investigador operacional",
  "Agente especializado",
  "Inspetor",
  "Inspetor chefe",
  "Chefe de inteligência",
  "Vice Secretario de segurança Pública",
  "Secretario de segurança pública"
];

// Dados iniciais com senha (para testes)
let jogadores = JSON.parse(localStorage.getItem('jogadores')) || {
  "1": { nome: "Rodrigo", cargo: "Inspetor chefe", senha: "RD" },
  "2": { nome: "Japa", cargo: "Inspetor", senha: "JP" },
  "3": { nome: "Haniel", cargo: "Vice Secretario de segurança Pública", senha: "Haniel" },
  "4": { nome: "Luis", cargo: "Estagiário", senha: "LS" }
};

let idAtual = null; // id do usuário logado
let idAtualSelecionado = null; // id do usuário selecionado na pesquisa

function salvarLocalStorage() {
  localStorage.setItem('jogadores', JSON.stringify(jogadores));
}

function fazerLogin() {
  const id = document.getElementById('loginID').value.trim();
  const senha = document.getElementById('loginSenha').value;

  if (!(id in jogadores)) {
    alert('ID não encontrado!');
    return;
  }
  if (jogadores[id].senha !== senha) {
    alert('Senha incorreta!');
    return;
  }

  idAtual = id;
  mostrarPainel();
}

function mostrarPainel() {
  // Oculta login e cadastro
  document.getElementById('login').style.display = 'none';
  document.getElementById('novo-jogador').style.display = 'none';

  // Exibe dados do usuário no canto
  const userInfo = document.getElementById('user-info');
  userInfo.innerText = `Nome: ${jogadores[idAtual].nome} | Cargo: ${jogadores[idAtual].cargo}`;
  userInfo.style.display = 'block';

  // Exibe painel de busca
  document.getElementById('inputID').value = '';
  document.getElementById('resultado').style.display = 'none';

  // Mostrar campo pesquisar
  document.getElementById('pesquisa').style.display = 'block';
}

function pesquisar() {
  if (!idAtual) {
    alert('Faça login primeiro!');
    return;
  }
  const id = document.getElementById('inputID').value.trim();
  const resultadoDiv = document.getElementById('resultado');

  if (!(id in jogadores)) {
    alert('Jogador não encontrado!');
    resultadoDiv.style.display = 'none';
    return;
  }

  // Permissão: só mostra se idAtual tiver cargo igual ou maior que o pesquisado
  if (!podeModificar(idAtual, id)) {
    // Exibir nome e cargo, mas sem botões
    atualizarExibicao(id);
    resultadoDiv.style.display = 'block';
    document.getElementById('acoes').style.display = 'none';
    return;
  }

  idAtualSelecionado = id;
  atualizarExibicao(id);
  resultadoDiv.style.display = 'block';
  document.getElementById('acoes').style.display = 'block';
}

function atualizarExibicao(id) {
  document.getElementById('nome').innerText = jogadores[id].nome;
  document.getElementById('cargo').innerText = jogadores[id].cargo;
}

function indiceCargo(cargo) {
  return cargos.indexOf(cargo);
}

// Checa se jogador com id1 pode modificar o id2
function podeModificar(id1, id2) {
  const ind1 = indiceCargo(jogadores[id1].cargo);
  const ind2 = indiceCargo(jogadores[id2].cargo);
  return ind1 > ind2; // alterei aqui para garantir que só quem tem cargo maior pode modificar
}

function promover() {
  if (!idAtualSelecionado) return;

  let cargoAtual = jogadores[idAtualSelecionado].cargo;
  let indice = indiceCargo(cargoAtual);
  let indiceCargoUsuario = indiceCargo(jogadores[idAtual].cargo);

  if (indice >= cargos.length - 1) {
    alert(`${jogadores[idAtualSelecionado].nome} já está no cargo máximo (${cargoAtual})!`);
    return;
  }

  // Não permite promover para um cargo igual ou maior ao do usuário atual
  if (indice + 1 >= indiceCargoUsuario) {
    alert('Você não pode promover este jogador para o seu próprio cargo ou acima.');
    return;
  }

  // Já checou se pode modificar antes, mas reforça só por segurança
  if (!podeModificar(idAtual, idAtualSelecionado)) {
    alert('Você não tem permissão para promover este jogador.');
    return;
  }

  jogadores[idAtualSelecionado].cargo = cargos[indice + 1];
  salvarLocalStorage();
  atualizarExibicao(idAtualSelecionado);
  alert(`${jogadores[idAtualSelecionado].nome} foi promovido para ${jogadores[idAtualSelecionado].cargo}!`);
}

function rebaixar() {
  if (!idAtualSelecionado) return;
  let cargoAtual = jogadores[idAtualSelecionado].cargo;
  let indice = indiceCargo(cargoAtual);

  if (indice <= 0) {
    alert(`${jogadores[idAtualSelecionado].nome} já está no cargo mínimo (${cargoAtual})!`);
    return;
  }

  // Permissão: só pode rebaixar se seu cargo for maior que o do alvo
  if (!podeModificar(idAtual, idAtualSelecionado) || indiceCargo(jogadores[idAtual].cargo) <= indice) {
    alert('Você não tem permissão para rebaixar este jogador.');
    return;
  }

  jogadores[idAtualSelecionado].cargo = cargos[indice - 1];
  salvarLocalStorage();
  atualizarExibicao(idAtualSelecionado);
  alert(`${jogadores[idAtualSelecionado].nome} foi rebaixado para ${jogadores[idAtualSelecionado].cargo}!`);
}

function expulsar() {
  if (!idAtualSelecionado) return;

  // Permissão: só pode expulsar se seu cargo for maior que o do alvo
  if (!podeModificar(idAtual, idAtualSelecionado) || indiceCargo(jogadores[idAtual].cargo) <= indiceCargo(jogadores[idAtualSelecionado].cargo)) {
    alert('Você não tem permissão para expulsar este jogador.');
    return;
  }

  let nome = jogadores[idAtualSelecionado].nome;
  delete jogadores[idAtualSelecionado];
  salvarLocalStorage();
  alert(`${nome} foi expulso da organização!`);
  document.getElementById('resultado').style.display = 'none';
  idAtualSelecionado = null;
  document.getElementById('inputID').value = '';
}

function adicionarJogador() {
  const novoID = document.getElementById('novoID').value.trim();
  const novoNome = document.getElementById('novoNome').value.trim();
  const novaSenha = document.getElementById('novaSenha').value;

  if (!novoID || !novoNome || !novaSenha) {
    alert('Por favor, preencha todos os campos!');
    return;
  }

  if (novoID in jogadores) {
    alert('Esse ID já existe!');
    return;
  }

  // O novo jogador sempre começa com o cargo mais baixo da lista
  const cargoInicial = cargos[0];

  jogadores[novoID] = { nome: novoNome, cargo: cargoInicial, senha: novaSenha };
  salvarLocalStorage();
  alert(`Jogador ${novoNome} adicionado com sucesso com o cargo ${cargoInicial}!`);

  // Limpa os campos
  document.getElementById('novoID').value = '';
  document.getElementById('novoNome').value = '';
  document.getElementById('novaSenha').value = '';
}

// Evento para alternar o formulário de cadastro
document.getElementById('btnToggleCadastro').addEventListener('click', () => {
  const cadastroDiv = document.getElementById('novo-jogador');
  cadastroDiv.style.display = cadastroDiv.style.display === 'none' ? 'block' : 'none';
});
</script>

</body>
</html>
