<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Sistema PF - RP</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0; padding: 0;
    background: #f0f2f5;
  }
  header {
    background: #004080;
    color: white;
    padding: 15px;
    text-align: center;
  }
  #dashboard-publico, #login-section, #app-section {
    max-width: 700px;
    margin: 30px auto;
    background: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 0 8px #ccc;
  }
  h2 {
    color: #004080;
    margin-bottom: 15px;
  }
  label {
    display: block;
    margin: 8px 0 4px;
  }
  input[type=text], input[type=password], select, textarea {
    width: 100%;
    padding: 8px;
    border-radius: 4px;
    border: 1px solid #aaa;
    box-sizing: border-box;
  }
  button {
    margin-top: 15px;
    padding: 10px 20px;
    background: #004080;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
  }
  button:hover { background: #003060; }
  .hidden { display: none; }
  nav {
    margin-bottom: 20px;
  }
  nav button {
    margin-right: 10px;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 10px;
  }
  th, td {
    padding: 8px;
    border: 1px solid #ddd;
    word-break: break-word;
  }
  th {
    background: #004080;
    color: white;
  }
  .error { color: red; margin-top: 10px; }
</style>
</head>
<body>

<header>
  <h1>Sistema Polícia Federal (RP)</h1>
</header>

<!-- Dashboard público -->
<section id="dashboard-publico">
  <h2>Bem-vindo ao Painel Público</h2>
  <p>Este painel é de uso público a cidadãos do complexo. Aqui pode ser efetuado registro de Boletins de Ocorrência (B.O) e revisão das portarias de acesso público.</p>
  
  <button onclick="mostrarPainelPublico('painelBOPublico')">Registrar B.O Público</button>
  <button onclick="mostrarPainelPublico('painelPortariasPublicas')">Ver Portarias Públicas</button>
  <button onclick="mostrarLogin()">Iniciar Sessão (Usuários Registrados)</button>

  <div id="avisosPublicos" style="margin-top:20px; border:1px solid #004080; padding:10px; border-radius:5px; background:#e6f0ff;">
    <h3>Avisos Públicos</h3>
    <ul id="listaAvisosPublicos">
      <!-- Avisos dinâmicos aqui -->
    </ul>
  </div>

  <div id="painelBOPublico" class="hidden" style="margin-top:20px;">
    <h3>Registrar Boletim de Ocorrência (Público)</h3>
    <form id="formBOPublico">
      <label for="tituloBOPublico">Título do BO:</label>
      <input type="text" id="tituloBOPublico" required />
      <label for="descricaoBOPublico">Descrição:</label>
      <textarea id="descricaoBOPublico" rows="4" required></textarea>
      <label for="denunciadoBOPublico">Pessoa Denunciada (nome):</label>
      <input type="text" id="denunciadoBOPublico" required />
      <button type="submit">Registrar B.O</button>
    </form>
    <h3>Boletins Públicos Registrados</h3>
    <table id="tabelaBOPublico">
      <thead>
        <tr><th>Título</th><th>Descrição</th><th>Denunciado</th><th>Data</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <div id="painelPortariasPublicas" class="hidden" style="margin-top:20px;">
    <h3>Portarias Públicas</h3>
    <ul id="listaPortariasPublicas"></ul>
  </div>
</section>

<!-- Login -->
<section id="login-section" class="hidden">
  <h2>Login</h2>
  <form id="loginForm">
    <label for="username">Usuário:</label>
    <input type="text" id="username" required autocomplete="off" />
    <label for="password">Senha:</label>
    <input type="password" id="password" required autocomplete="off" />
    <button type="submit">Entrar</button>
  </form>
  <div id="login-error" class="error"></div>
  <button onclick="mostrarDashboardPublico()">Voltar ao Público</button>
</section>

<!-- Área restrita -->
<section id="app-section" class="hidden">
  <nav>
    <button onclick="mostrarPainel('painelPromocoes')">Painel Promoções</button>
    <button onclick="mostrarPainel('painelBancoCriminal')">Banco Criminal</button>
    <button onclick="mostrarPainel('painelPortariasInternas')">Portarias (Delegado+)</button>
    <button onclick="mostrarPainel('painelRegistroMembros')">Registrar Membros (Diretor+)</button>
    <button onclick="logout()">Sair</button>
  </nav>

  <!-- Painel Promoções -->
  <div id="painelPromocoes" class="painel">
    <h2>Painel de Promoção / Rebaixamento / Exoneração</h2>
    <table id="usuariosTable">
      <thead>
        <tr><th>Usuário</th><th>Cargo</th><th>Ações</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- Banco Criminal -->
  <div id="painelBancoCriminal" class="painel hidden">
    <h2>Registro Banco Criminal</h2>
    <form id="formBancoCriminal">
      <label for="nomeCriminoso">Nome do Criminoso:</label>
      <input type="text" id="nomeCriminoso" required />
      <label for="tipoCrime">Tipo do Crime:</label>
      <input type="text" id="tipoCrime" required />
      <label for="descricaoCrime">Descrição do Crime:</label>
      <textarea id="descricaoCrime" rows="4" required></textarea>
      <button type="submit">Registrar Crime</button>
    </form>
    <h3>Crimes Registrados</h3>
    <table id="tabelaBancoCriminal">
      <thead>
        <tr><th>Nome</th><th>Tipo</th><th>Descrição</th><th>Data</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

  <!-- Portarias internas -->
  <div id="painelPortariasInternas" class="painel hidden">
    <h2>Gerenciar Portarias</h2>
    <form id="formPortaria">
      <label for="tituloPortaria">Título da Portaria:</label>
      <input type="text" id="tituloPortaria" required />
      <label for="conteudoPortaria">Conteúdo:</label>
      <textarea id="conteudoPortaria" rows="4" required></textarea>
      <button type="submit">Criar Portaria</button>
    </form>
    <h3>Portarias Internas Criadas</h3>
    <ul id="listaPortariasInternas"></ul>
  </div>

  <!-- Registro de membros -->
  <div id="painelRegistroMembros" class="painel hidden">
    <h2>Registrar Novo Membro (Diretor+)</h2>
    <form id="formRegistroMembros">
      <label for="novoUsuario">Usuário (login):</label>
      <input type="text" id="novoUsuario" required autocomplete="off" />
      <label for="novaSenha">Senha:</label>
      <input type="password" id="novaSenha" required />
      <label for="cargoInicial">Cargo Inicial:</label>
      <select id="cargoInicial" required>
        <option value="" disabled selected>Selecione um cargo</option>
        <option value="Agente">Agente</option>
        <option value="Escrivão">Escrivão</option>
        <option value="Investigador">Investigador</option>
        <option value="Delegado">Delegado</option>
        <option value="Diretor">Diretor</option>
      </select>
      <button type="submit">Registrar Membro</button>
    </form>
  </div>
</section>

<script>
  // Dados simulados / banco local
  let usuarios = [
    { usuario: 'admin', senha: 'admin123', cargo: 'Diretor' },
    { usuario: 'delegado1', senha: 'senha123', cargo: 'Delegado' },
    { usuario: 'agente1', senha: 'senha123', cargo: 'Agente' },
  ];

  let boletinsPublicos = [];
  let portariasPublicas = [
    "Portaria 001: Uso obrigatório de crachá nas dependências.",
    "Portaria 002: Restrição de acesso após as 22h.",
  ];
  let portariasInternas = [];
  let bancoCriminal = [];

  let usuarioLogado = null;

  // Funções para mostrar/ocultar painéis
  function mostrarDashboardPublico() {
    document.getElementById('dashboard-publico').classList.remove('hidden');
    document.getElementById('login-section').classList.add('hidden');
    document.getElementById('app-section').classList.add('hidden');
    limparMensagensLogin();
    esconderTodosPainéisPublicos();
  }

  function mostrarLogin() {
    document.getElementById('dashboard-publico').classList.add('hidden');
    document.getElementById('login-section').classList.remove('hidden');
    document.getElementById('app-section').classList.add('hidden');
    limparMensagensLogin();
  }

  function limparMensagensLogin() {
    document.getElementById('login-error').textContent = '';
  }

  function mostrarApp() {
    document.getElementById('dashboard-publico').classList.add('hidden');
    document.getElementById('login-section').classList.add('hidden');
    document.getElementById('app-section').classList.remove('hidden');
    mostrarPainel('painelPromocoes');
    atualizarTabelaUsuarios();
    atualizarPortariasPublicas();
    atualizarTabelaBOPublico();
    atualizarTabelaBancoCriminal();
    atualizarListaPortariasInternas();
  }

  // Painéis públicos
  function mostrarPainelPublico(painel) {
    esconderTodosPainéisPublicos();
    document.getElementById(painel).classList.remove('hidden');
  }
  function esconderTodosPainéisPublicos() {
    ['painelBOPublico', 'painelPortariasPublicas'].forEach(id => {
      document.getElementById(id).classList.add('hidden');
    });
  }

  // Painéis da área restrita
  function mostrarPainel(painelId) {
    document.querySelectorAll('.painel').forEach(painel => {
      painel.classList.add('hidden');
    });
    document.getElementById(painelId).classList.remove('hidden');
  }

  // Login
  document.getElementById('loginForm').addEventListener('submit', function(event){
    event.preventDefault();
    const usuarioInput = document.getElementById('username').value.trim();
    const senhaInput = document.getElementById('password').value.trim();
    const usuarioEncontrado = usuarios.find(u => u.usuario === usuarioInput && u.senha === senhaInput);
    if(usuarioEncontrado) {
      usuarioLogado = usuarioEncontrado;
      mostrarApp();
    } else {
      document.getElementById('login-error').textContent = 'Usuário ou senha incorretos.';
    }
  });

  // Logout
  function logout() {
    usuarioLogado = null;
    mostrarDashboardPublico();
  }

  // Atualizar tabela de usuários para promoções/rebaixamentos
  function atualizarTabelaUsuarios() {
    const tbody = document.querySelector('#usuariosTable tbody');
    tbody.innerHTML = '';
    usuarios.forEach((u, idx) => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${u.usuario}</td>
        <td>${u.cargo}</td>
        <td>
          ${renderizarAcoesCargo(u, idx)}
        </td>
      `;
      tbody.appendChild(tr);
    });
  }

  // Renderizar botões de ação dependendo do cargo do usuário logado e do alvo
  function renderizarAcoesCargo(usuarioAlvo, idx) {
    if(!usuarioLogado) return '';
    const cargosOrdem = ['Agente', 'Escrivão', 'Investigador', 'Delegado', 'Diretor'];
    const cargoAtualIndex = cargosOrdem.indexOf(usuarioLogado.cargo);
    const cargoAlvoIndex = cargosOrdem.indexOf(usuarioAlvo.cargo);
    // Só pode mexer em cargos abaixo do seu e não pode mexer em si mesmo
    if(cargoAtualIndex <= cargoAlvoIndex || usuarioLogado.usuario === usuarioAlvo.usuario) return 'Sem permissão';
    
    let botoes = '';
    // Pode promover se cargoAlvo não for Diretor
    if(cargoAlvoIndex < cargosOrdem.length - 1) {
      botoes += `<button onclick="promoverUsuario(${idx})">Promover</button> `;
    }
    // Pode rebaixar se cargoAlvo não for Agente
    if(cargoAlvoIndex > 0) {
      botoes += `<button onclick="rebaixarUsuario(${idx})">Rebaixar</button> `;
    }
    // Pode exonerar (remover)
    botoes += `<button onclick="exonerarUsuario(${idx})">Exonerar</button>`;
    return botoes;
  }

  function promoverUsuario(idx) {
    const cargosOrdem = ['Agente', 'Escrivão', 'Investigador', 'Delegado', 'Diretor'];
    let u = usuarios[idx];
    let cargoIndex = cargosOrdem.indexOf(u.cargo);
    if(cargoIndex < cargosOrdem.length -1) {
      // só promove se logado tiver cargo maior que o próximo cargo do alvo
      const cargoLogadoIndex = cargosOrdem.indexOf(usuarioLogado.cargo);
      if(cargoLogadoIndex > cargoIndex + 1) {
        u.cargo = cargosOrdem[cargoIndex + 1];
        atualizarTabelaUsuarios();
        alert(`Usuário ${u.usuario} promovido para ${u.cargo}.`);
      } else {
        alert('Você não tem permissão para promover para esse cargo.');
      }
    }
  }

  function rebaixarUsuario(idx) {
    const cargosOrdem = ['Agente', 'Escrivão', 'Investigador', 'Delegado', 'Diretor'];
    let u = usuarios[idx];
    let cargoIndex = cargosOrdem.indexOf(u.cargo);
    if(cargoIndex > 0) {
      const cargoLogadoIndex = cargosOrdem.indexOf(usuarioLogado.cargo);
      if(cargoLogadoIndex > cargoIndex - 1) {
        u.cargo = cargosOrdem[cargoIndex - 1];
        atualizarTabelaUsuarios();
        alert(`Usuário ${u.usuario} rebaixado para ${u.cargo}.`);
      } else {
        alert('Você não tem permissão para rebaixar para esse cargo.');
      }
    }
  }

  function exonerarUsuario(idx) {
    if(confirm(`Deseja realmente exonerar o usuário ${usuarios[idx].usuario}?`)) {
      usuarios.splice(idx,1);
      atualizarTabelaUsuarios();
      alert('Usuário exonerado.');
    }
  }

  // Registrar membros (diretor+)
  document.getElementById('formRegistroMembros').addEventListener('submit', function(event){
    event.preventDefault();
    if(!usuarioLogado) return alert('Faça login.');
    if(['Diretor'].indexOf(usuarioLogado.cargo) === -1) return alert('Apenas Diretores podem registrar membros.');

    const novoUsuario = document.getElementById('novoUsuario').value.trim();
    const novaSenha = document.getElementById('novaSenha').value.trim();
    const cargoInicial = document.getElementById('cargoInicial').value;

    if(usuarios.find(u => u.usuario === novoUsuario)) {
      return alert('Usuário já existe.');
    }

    usuarios.push({
      usuario: novoUsuario,
      senha: novaSenha,
      cargo: cargoInicial
    });
    alert('Membro registrado com sucesso.');
    document.getElementById('formRegistroMembros').reset();
    atualizarTabelaUsuarios();
  });

  // Registro B.O público
  document.getElementById('formBOPublico').addEventListener('submit', function(event){
    event.preventDefault();
    const titulo = document.getElementById('tituloBOPublico').value.trim();
    const descricao = document.getElementById('descricaoBOPublico').value.trim();
    const denunciado = document.getElementById('denunciadoBOPublico').value.trim();

    if(!titulo || !descricao || !denunciado) return alert('Preencha todos os campos.');

    boletinsPublicos.push({
      titulo,
      descricao,
      denunciado,
      data: new Date().toLocaleString()
    });

    alert('Boletim registrado com sucesso!');
    document.getElementById('formBOPublico').reset();
    atualizarTabelaBOPublico();
  });

  function atualizarTabelaBOPublico() {
    const tbody = document.querySelector('#tabelaBOPublico tbody');
    tbody.innerHTML = '';
    boletinsPublicos.forEach(bo => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${bo.titulo}</td>
        <td>${bo.descricao}</td>
        <td>${bo.denunciado}</td>
        <td>${bo.data}</td>
      `;
      tbody.appendChild(tr);
    });
  }

  // Atualizar portarias públicas
  function atualizarPortariasPublicas() {
    const ul = document.getElementById('listaPortariasPublicas');
    ul.innerHTML = '';
    portariasPublicas.forEach((portaria, i) => {
      const li = document.createElement('li');
      li.textContent = portaria;
      ul.appendChild(li);
    });
  }

  // Registrar portarias internas (delegado+)
  document.getElementById('formPortaria').addEventListener('submit', function(event){
    event.preventDefault();
    if(!usuarioLogado) return alert('Faça login.');
    if(['Delegado','Diretor'].indexOf(usuarioLogado.cargo) === -1) return alert('Apenas Delegados e Diretores podem criar portarias.');

    const titulo = document.getElementById('tituloPortaria').value.trim();
    const conteudo = document.getElementById('conteudoPortaria').value.trim();

    if(!titulo || !conteudo) return alert('Preencha todos os campos.');

    portariasInternas.push(`${titulo}: ${conteudo}`);
    alert('Portaria criada com sucesso!');
    document.getElementById('formPortaria').reset();
    atualizarListaPortariasInternas();
  });

  function atualizarListaPortariasInternas() {
    const ul = document.getElementById('listaPortariasInternas');
    ul.innerHTML = '';
    portariasInternas.forEach(portaria => {
      const li = document.createElement('li');
      li.textContent = portaria;
      ul.appendChild(li);
    });
  }

  // Banco criminal
  document.getElementById('formBancoCriminal').addEventListener('submit', function(event){
    event.preventDefault();
    if(!usuarioLogado) return alert('Faça login.');

    const nome = document.getElementById('nomeCriminoso').value.trim();
    const tipo = document.getElementById('tipoCrime').value.trim();
    const descricao = document.getElementById('descricaoCrime').value.trim();

    if(!nome || !tipo || !descricao) return alert('Preencha todos os campos.');

    bancoCriminal.push({
      nome,
      tipo,
      descricao,
      data: new Date().toLocaleString()
    });

    alert('Crime registrado com sucesso!');
    document.getElementById('formBancoCriminal').reset();
    atualizarTabelaBancoCriminal();
  });

  function atualizarTabelaBancoCriminal() {
    const tbody = document.querySelector('#tabelaBancoCriminal tbody');
    tbody.innerHTML = '';
    bancoCriminal.forEach(c => {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>${c.nome}</td>
        <td>${c.tipo}</td>
        <td>${c.descricao}</td>
        <td>${c.data}</td>
      `;
      tbody.appendChild(tr);
    });
  }

  // Inicialização
  mostrarDashboardPublico();
  atualizarPortariasPublicas();

</script>
</body>
</html>
