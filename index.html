<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Painel Serviço Secreto Municipal</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0; padding: 0;
    background: #222;
    color: #eee;
    display: flex;
    justify-content: center;
    align-items: flex-start;
    min-height: 100vh;
  }
  #container {
    background: #333;
    width: 360px;
    margin: 20px;
    border-radius: 8px;
    box-shadow: 0 0 15px #000;
    padding: 20px;
    display: flex;
    flex-direction: column;
    position: relative;
    min-height: 600px;
  }
  h1 {
    text-align: center;
    margin-bottom: 15px;
    color: #aaf;
  }
  input[type=text], input[type=password] {
    width: 100%;
    padding: 8px 6px;
    margin: 6px 0 12px 0;
    border: none;
    border-radius: 4px;
    font-size: 1rem;
  }
  button {
    background: #5588ee;
    color: white;
    padding: 10px;
    width: 100%;
    border: none;
    border-radius: 4px;
    font-weight: bold;
    cursor: pointer;
    font-size: 1rem;
    margin-bottom: 10px;
  }
  button:hover:not(:disabled) {
    background: #4477dd;
  }
  button:disabled {
    background: #444;
    cursor: default;
  }

  /* Menu topo: alinhado canto superior esquerdo e botões retangulares, texto branco, sem borda azul */
  #menuTopo {
    display: flex;
    gap: 10px;
    margin-bottom: 15px;
    justify-content: flex-start;
  }
  #menuTopo button {
    flex: none;
    padding: 8px 14px;
    font-size: 0.95rem;
    background: transparent;
    border: none;
    color: white;
    border-radius: 0;
    box-shadow: none;
    text-align: center;
    cursor: pointer;
    font-weight: normal;
  }
  #menuTopo button:hover {
    background: #3366cc;
  }

  /* Botão sair menor e no canto inferior direito */
  #btnLogout {
    position: absolute;
    bottom: 20px;
    right: 20px;
    width: auto;
    padding: 6px 12px;
    font-size: 0.9rem;
    background: #d44;
    border-radius: 4px;
    font-weight: bold;
  }
  #btnLogout:hover {
    background: #b33;
  }

  #lista-registros {
    max-height: 200px;
    overflow-y: auto;
    background: #444;
    padding: 10px;
    border-radius: 6px;
    margin-bottom: 15px;
  }
  #lista-registros table {
    width: 100%;
    border-collapse: collapse;
  }
  #lista-registros th, #lista-registros td {
    border: 1px solid #666;
    padding: 6px 4px;
    font-size: 0.9rem;
  }
  #sobre-ss {
    text-align: center;
    margin-bottom: 20px;
  }
  #resultado {
    background: #444;
    padding: 15px;
    border-radius: 6px;
    margin-top: 10px;
  }
  #resultado p {
    margin: 8px 0;
    font-size: 1rem;
  }
  #inputID {
    font-size: 1rem;
    padding: 6px;
  }
  .link-btn {
    background: none;
    border: none;
    color: #88aaff;
    cursor: pointer;
    padding: 0;
    font-size: 0.95rem;
    text-decoration: underline;
    margin-top: 10px;
  }
  .link-btn:hover {
    color: #bbd;
  }
</style>
</head>
<body>
  <div id="container">
    <h1>Serviço Secreto Municipal</h1>

    <!-- Login -->
    <div id="login">
      <input type="text" id="loginID" placeholder="Digite seu ID" autocomplete="off" />
      <input type="password" id="loginSenha" placeholder="Digite sua senha" autocomplete="off" />
      <button id="btnLogin">Entrar</button>
      <button class="link-btn" id="btnToggleCadastro">Cadastrar novo membro</button>
    </div>

    <!-- Cadastro -->
    <div id="novo-jogador" style="display:none;">
      <input type="text" id="novoID" placeholder="Novo ID (único)" autocomplete="off" />
      <input type="text" id="novoNome" placeholder="Nome completo" autocomplete="off" />
      <input type="password" id="novaSenha" placeholder="Senha" autocomplete="off" />
      <button id="btnCadastrar">Cadastrar</button>
      <button class="link-btn" id="btnVoltarLogin">Voltar ao login</button>
    </div>

    <!-- Área logado -->
    <div id="painel" style="display:none; flex:1; position: relative;">
      <div id="menuTopo">
        <button id="btnSobre">Sobre o Serviço Secreto</button>
        <button id="btnListaRegistros">Lista de registros</button>
        <button id="btnPainel">Painel de controle</button>
      </div>
      <button id="btnLogout">Sair</button>

      <!-- Texto explicativo sobre o Serviço Secreto -->
      <div id="sobre-ss" style="display:none;">
        <p>Bem-vindo ao Serviço Secreto Municipal, onde protegemos a integridade da prefeitura e a segurança dos cidadãos. Aqui você pode pesquisar membros, promover, rebaixar ou expulsar agentes com base nas necessidades da equipe.</p>
      </div>

      <!-- Lista de registros -->
      <div id="lista-registros" style="display:none;">
        <table>
          <thead><tr><th>ID</th><th>Nome</th><th>Cargo</th></tr></thead>
          <tbody id="listaTabela"></tbody>
        </table>
      </div>

      <!-- Painel de pesquisa e ações -->
      <div id="painel-pesquisa" style="display:none;">
        <input type="text" id="inputID" placeholder="Digite ID do agente" autocomplete="off" />
        <button id="btnPesquisar">Pesquisar</button>

        <div id="resultado" style="display:none;">
          <p><strong>Nome:</strong> <span id="nome"></span></p>
          <p><strong>Cargo:</strong> <span id="cargo"></span></p>
          <button id="btnPromover">Promover</button>
          <button id="btnRebaixar">Rebaixar</button>
          <button id="btnExpulsar" style="background:#d44;">Expulsar</button>
        </div>
      </div>
    </div>

  <script>
    const webhookURL = "https://discord.com/api/webhooks/1390011117778112723/KWkdPpdOmtRkgLlUH7QLUwx3sqxnHX-qhA0EkZFwjRiMPTJL8bLmbL1l3P-LZWRJBKeb";

    const cargos = [
      "Estagiário",
      "Agente",
      "Investigador",
      "Detetive",
      "Chefe de Seção",
      "Diretor",
      "VSSP",
      "SSP"
    ];

    let jogadores = JSON.parse(localStorage.getItem('jogadoresSS')) || {};

    // Cria jogador fixo ID 5 Gabriel VSSP se não existir
    if (!jogadores["5"]) {
      jogadores["5"] = {
        nome: "Gabriel",
        senha: "VSSP-HANIEL",
        cargo: "VSSP"
      };
      localStorage.setItem('jogadoresSS', JSON.stringify(jogadores));
    }

    let idAtual = null;
    let idSelecionado = null;

    const loginDiv = document.getElementById('login');
    const cadastroDiv = document.getElementById('novo-jogador');
    const painelDiv = document.getElementById('painel');
    const sobreDiv = document.getElementById('sobre-ss');
    const listaRegistrosDiv = document.getElementById('lista-registros');
    const painelPesquisaDiv = document.getElementById('painel-pesquisa');
    const resultadoDiv = document.getElementById('resultado');

    function salvarLocalStorage() {
      localStorage.setItem('jogadoresSS', JSON.stringify(jogadores));
    }

    function mostrarListaRegistros() {
      const tbody = document.getElementById('listaTabela');
      tbody.innerHTML = '';
      for (const id in jogadores) {
        const jog = jogadores[id];
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${id}</td><td>${jog.nome}</td><td>${jog.cargo}</td>`;
        tbody.appendChild(tr);
      }
    }

    function mostrarDadosJogador(id) {
      const jogador = jogadores[id];
      if (!jogador) return;
      document.getElementById('nome').textContent = jogador.nome;
      document.getElementById('cargo').textContent = jogador.cargo;
      resultadoDiv.style.display = 'block';

      const disabled = (id === idAtual);
      document.getElementById('btnPromover').disabled = disabled;
      document.getElementById('btnRebaixar').disabled = disabled;
      document.getElementById('btnExpulsar').disabled = disabled;
    }

    async function enviarLogDiscord(acao, jogadorAlvo, cargoAntes, cargoDepois) {
      const userAtual = jogadores[idAtual];
      const data = {
        embeds: [{
          title: `Ação: ${acao}`,
          description:
            `**Responsável:** ${userAtual.nome} (ID: ${idAtual})\n` +
            `**Alvo:** ${jogadorAlvo.nome} (ID: ${idSelecionado})\n` +
            `**Cargo antes:** ${cargoAntes}\n` +
            (cargoDepois ? `**Cargo depois:** ${cargoDepois}\n` : '') +
            `**Data:** ${new Date().toLocaleString()}`,
          color: 3447003
        }]
      };
      try {
        await fetch(webhookURL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
      } catch(e) {
        console.error('Erro ao enviar log para Discord:', e);
      }
    }

    function atualizarTela(estado) {
      // Oculta tudo
      loginDiv.style.display = 'none';
      cadastroDiv.style.display = 'none';
      painelDiv.style.display = 'none';
      sobreDiv.style.display = 'none';
      listaRegistrosDiv.style.display = 'none';
      painelPesquisaDiv.style.display = 'none';
      resultadoDiv.style.display = 'none';

      if (estado === 'login') {
        loginDiv.style.display = 'block';
      } else if (estado === 'cadastro') {
        cadastroDiv.style.display = 'block';
      } else if (estado === 'sobre') {
        painelDiv.style.display = 'flex';
        sobreDiv.style.display = 'block';
      } else if (estado === 'lista') {
        painelDiv.style.display = 'flex';
        listaRegistrosDiv.style.display = 'block';
        mostrarListaRegistros();
      } else if (estado === 'painel') {
        painelDiv.style.display = 'flex';
        painelPesquisaDiv.style.display = 'block';
      }
    }

    document.getElementById('btnToggleCadastro').onclick = () => {
      atualizarTela('cadastro');
    };
    document.getElementById('btnVoltarLogin').onclick = () => {
      atualizarTela('login');
    };

    document.getElementById('btnLogin').onclick = () => {
      const id = document.getElementById('loginID').value.trim();
      const senha = document.getElementById('loginSenha').value;
      if (!jogadores[id]) {
        alert('ID não encontrado.');
        return;
      }
      if (jogadores[id].senha !== senha) {
        alert('Senha incorreta.');
        return;
      }
      idAtual = id;
      atualizarTela('sobre');
    };

    document.getElementById('btnLogout').onclick = () => {
      idAtual = null;
      idSelecionado = null;
      document.getElementById('loginID').value = '';
      document.getElementById('loginSenha').value = '';
      atualizarTela('login');
    };

    document.getElementById('btnCadastrar').onclick = () => {
      const id = document.getElementById('novoID').value.trim();
      const nome = document.getElementById('novoNome').value.trim();
      const senha = document.getElementById('novaSenha').value;

      if (!id || !nome || !senha) {
        alert('Preencha todos os campos.');
        return;
      }
      if (jogadores[id]) {
        alert('ID já cadastrado.');
        return;
      }
      jogadores[id] = { nome, senha, cargo: 'Estagiário' };
      salvarLocalStorage();
      alert(`Membro ${nome} cadastrado com cargo Estagiário.`);
      atualizarTela('login');
    };

    document.getElementById('btnSobre').onclick = () => {
      atualizarTela('sobre');
    };

    document.getElementById('btnListaRegistros').onclick = () => {
      atualizarTela('lista');
    };

    document.getElementById('btnPainel').onclick = () => {
      atualizarTela('painel');
    };

    document.getElementById('btnPesquisar').onclick = () => {
      const id = document.getElementById('inputID').value.trim();
      if (!jogadores[id]) {
        alert('ID não encontrado.');
        resultadoDiv.style.display = 'none';
        return;
      }
      idSelecionado = id;
      mostrarDadosJogador(id);
    };

    document.getElementById('btnPromover').onclick = () => {
      const jogador = jogadores[idSelecionado];
      let idx = cargos.indexOf(jogador.cargo);
      if (idx < cargos.length - 1) {
        const cargoAntes = jogador.cargo;
        jogador.cargo = cargos[idx + 1];
        salvarLocalStorage();
        mostrarDadosJogador(idSelecionado);
        enviarLogDiscord('Promoção', jogador, cargoAntes, jogador.cargo);
        alert(`Promovido para ${jogador.cargo}`);
      } else {
        alert('Já está no cargo máximo.');
      }
    };

    document.getElementById('btnRebaixar').onclick = () => {
      const jogador = jogadores[idSelecionado];
      let idx = cargos.indexOf(jogador.cargo);
      if (idx > 0) {
        const cargoAntes = jogador.cargo;
        jogador.cargo = cargos[idx - 1];
        salvarLocalStorage();
        mostrarDadosJogador(idSelecionado);
        enviarLogDiscord('Rebaixamento', jogador, cargoAntes, jogador.cargo);
        alert(`Rebaixado para ${jogador.cargo}`);
      } else {
        alert('Já está no cargo mínimo.');
      }
    };

    document.getElementById('btnExpulsar').onclick = () => {
      if (!confirm('Confirma expulsar este agente?')) return;
      const jogador = jogadores[idSelecionado];
      enviarLogDiscord('Expulsão', jogador, jogador.cargo, null);
      delete jogadores[idSelecionado];
      salvarLocalStorage();
      alert(`Agente ${jogador.nome} expulso.`);
      resultadoDiv.style.display = 'none';
      idSelecionado = null;
    };

    // Inicializa com tela login
    atualizarTela('login');
  </script>
  </div>
</body>
</html>
